# 程式功能規格書

## 1. 程式基本資訊

| 項目 | 內容 |
|------|------|
| 程式編號 | WEB020 |
| 程式名稱 | Web 化財務報表系統 |
| 系統分類 | 網路財務管理系統 |
| 開發語言 | RPG IV / HTML / JavaScript |
| 資料庫   | DB2 for IBM i |
| 執行平台 | AS/400 與網頁前端 |
| 版本     | 1.0 |

## 2. 程式概述

WEB020 是一個 Web 化財務報表系統，將傳統 AS/400 綠屏的財務報表功能轉換為網頁介面，提供更直覺、更互動的財務資訊呈現方式。該程式負責生成、顯示和管理各類財務報表，包括資產負債表、損益表、現金流量表、預算報表等，支援多種報表格式、多層級資料鑽取和視覺化圖表展示。系統整合了財務會計、成本會計、預算管理等模組的資料，提供全面的財務分析功能，協助管理者做出更明智的決策。

## 3. 功能需求

### 3.1 基本功能

#### 3.1.1 標準財務報表生成
- 資產負債表生成
- 損益表生成
- 現金流量表生成
- 權益變動表生成
- 財務比率分析報表

#### 3.1.2 報表參數設定
- 報表期間設定
- 報表格式設定
- 報表層級設定
- 比較期間設定
- 報表幣別設定

#### 3.1.3 報表顯示功能
- 報表資料顯示
- 報表格式化顯示
- 報表分頁顯示
- 報表縮放顯示
- 報表列印預覽

#### 3.1.4 報表匯出功能
- 匯出 Excel 格式
- 匯出 PDF 格式
- 匯出 CSV 格式
- 匯出 XML 格式
- 匯出 HTML 格式

#### 3.1.5 報表管理功能
- 報表儲存與命名
- 報表版本管理
- 報表分享設定
- 報表排程設定
- 報表歷史記錄

### 3.2 進階功能

#### 3.2.1 資料分析功能
- 多維度資料分析
- 趨勢分析
- 差異分析
- 財務比率分析
- 預測分析

#### 3.2.2 視覺化功能
- 圖表展示
- 儀表板設計
- 互動式圖表
- 資料視覺化
- 自定義視覺主題

#### 3.2.3 資料鑽取功能
- 科目明細鑽取
- 交易明細鑽取
- 時間維度鑽取
- 組織維度鑽取
- 專案維度鑽取

#### 3.2.4 自定義報表功能
- 報表模板設計
- 報表欄位自定義
- 報表計算公式設定
- 報表條件過濾
- 報表排序設定

## 4. 資料結構

### 4.1 主要檔案

#### 4.1.1 報表定義檔 (WEBRPTDF)
| 欄位名稱 | 資料類型 | 長度 | 說明 |
|---------|---------|------|------|
| REPORT_ID | CHAR | 10 | 報表編號 (主鍵) |
| REPORT_NAME | VARCHAR | 100 | 報表名稱 |
| REPORT_TYPE | CHAR | 5 | 報表類型代碼 |
| REPORT_DESC | VARCHAR | 500 | 報表描述 |
| TEMPLATE_ID | CHAR | 10 | 模板編號 |
| DEFAULT_FORMAT | CHAR | 5 | 預設格式 |
| OWNER_ID | CHAR | 10 | 擁有者代碼 |
| IS_PUBLIC | CHAR | 1 | 是否公開 (Y/N) |
| STATUS | CHAR | 1 | 狀態 (A=啟用, D=停用) |
| CREATE_USER | CHAR | 10 | 建立人員 |
| CREATE_DATE | DATE | - | 建立日期 |
| CREATE_TIME | TIME | - | 建立時間 |
| UPDATE_USER | CHAR | 10 | 更新人員 |
| UPDATE_DATE | DATE | - | 更新日期 |
| UPDATE_TIME | TIME | - | 更新時間 |

#### 4.1.2 報表參數檔 (WEBRPTPF)
| 欄位名稱 | 資料類型 | 長度 | 說明 |
|---------|---------|------|------|
| REPORT_ID | CHAR | 10 | 報表編號 (主鍵) |
| PARAM_SEQ | SMALLINT | - | 參數序號 (主鍵) |
| PARAM_NAME | VARCHAR | 50 | 參數名稱 |
| PARAM_DESC | VARCHAR | 200 | 參數描述 |
| PARAM_TYPE | CHAR | 5 | 參數類型 |
| DEFAULT_VALUE | VARCHAR | 100 | 預設值 |
| IS_REQUIRED | CHAR | 1 | 是否必填 (Y/N) |
| DISPLAY_ORDER | SMALLINT | - | 顯示順序 |
| VALIDATION_RULE | VARCHAR | 500 | 驗證規則 |

#### 4.1.3 報表欄位檔 (WEBRPTCF)
| 欄位名稱 | 資料類型 | 長度 | 說明 |
|---------|---------|------|------|
| REPORT_ID | CHAR | 10 | 報表編號 (主鍵) |
| COLUMN_SEQ | SMALLINT | - | 欄位序號 (主鍵) |
| COLUMN_ID | CHAR | 20 | 欄位代碼 |
| COLUMN_NAME | VARCHAR | 50 | 欄位名稱 |
| COLUMN_DESC | VARCHAR | 200 | 欄位描述 |
| DATA_TYPE | CHAR | 5 | 資料類型 |
| DATA_SOURCE | VARCHAR | 200 | 資料來源 |
| FORMULA | VARCHAR | 500 | 計算公式 |
| FORMAT_MASK | VARCHAR | 50 | 格式遮罩 |
| DISPLAY_WIDTH | SMALLINT | - | 顯示寬度 |
| DISPLAY_ORDER | SMALLINT | - | 顯示順序 |
| IS_VISIBLE | CHAR | 1 | 是否顯示 (Y/N) |
| IS_DRILLABLE | CHAR | 1 | 是否可鑽取 (Y/N) |
| DRILL_TARGET | VARCHAR | 200 | 鑽取目標 |

#### 4.1.4 報表執行記錄檔 (WEBRPTEF)
| 欄位名稱 | 資料類型 | 長度 | 說明 |
|---------|---------|------|------|
| EXECUTION_ID | CHAR | 20 | 執行編號 (主鍵) |
| REPORT_ID | CHAR | 10 | 報表編號 |
| USER_ID | CHAR | 10 | 使用者代碼 |
| EXECUTION_DATE | DATE | - | 執行日期 |
| EXECUTION_TIME | TIME | - | 執行時間 |
| PARAM_VALUES | VARCHAR | 2000 | 參數值 (JSON格式) |
| EXECUTION_STATUS | CHAR | 2 | 執行狀態 |
| COMPLETION_TIME | TIME | - | 完成時間 |
| DURATION_SEC | INTEGER | - | 執行時間(秒) |
| OUTPUT_FORMAT | CHAR | 5 | 輸出格式 |
| OUTPUT_SIZE | INTEGER | - | 輸出大小(KB) |
| OUTPUT_PATH | VARCHAR | 200 | 輸出路徑 |
| ERROR_MESSAGE | VARCHAR | 500 | 錯誤訊息 |

#### 4.1.5 報表排程檔 (WEBRPTSF)
| 欄位名稱 | 資料類型 | 長度 | 說明 |
|---------|---------|------|------|
| SCHEDULE_ID | CHAR | 15 | 排程編號 (主鍵) |
| REPORT_ID | CHAR | 10 | 報表編號 |
| SCHEDULE_NAME | VARCHAR | 100 | 排程名稱 |
| SCHEDULE_TYPE | CHAR | 5 | 排程類型 |
| FREQUENCY | VARCHAR | 50 | 頻率設定 |
| START_DATE | DATE | - | 開始日期 |
| END_DATE | DATE | - | 結束日期 |
| PARAM_VALUES | VARCHAR | 2000 | 參數值 (JSON格式) |
| OUTPUT_FORMAT | CHAR | 5 | 輸出格式 |
| DELIVERY_TYPE | CHAR | 5 | 交付類型 |
| DELIVERY_TARGET | VARCHAR | 200 | 交付目標 |
| STATUS | CHAR | 1 | 狀態 (A=啟用, D=停用) |
| LAST_RUN_DATE | DATE | - | 最後執行日期 |
| LAST_RUN_STATUS | CHAR | 2 | 最後執行狀態 |
| CREATE_USER | CHAR | 10 | 建立人員 |
| CREATE_DATE | DATE | - | 建立日期 |

### 4.2 參考檔案

#### 4.2.1 會計科目檔 (MDACCTF)
#### 4.2.2 會計期間檔 (MDPERIDF)
#### 4.2.3 組織結構檔 (MDORGF)
#### 4.2.4 幣別主檔 (MDCURF)
#### 4.2.5 使用者主檔 (SYSUSRF)

## 5. 處理流程

### 5.1 標準報表生成流程
1. 使用者登入系統
2. 使用者選擇標準報表類型
3. 系統顯示報表參數設定畫面
4. 使用者設定報表參數
5. 系統驗證參數有效性
6. 系統執行報表生成
7. 系統從財務資料庫擷取資料
8. 系統處理和計算報表資料
9. 系統格式化報表輸出
10. 系統顯示報表結果
11. 使用者可查看、列印或匯出報表

### 5.2 自定義報表設計流程
1. 使用者選擇自定義報表功能
2. 使用者選擇新建報表或修改現有報表
3. 系統顯示報表設計介面
4. 使用者設定報表基本資訊
5. 使用者定義報表欄位和資料來源
6. 使用者設定計算公式和格式
7. 使用者設定報表排序和分組
8. 使用者設定報表過濾條件
9. 使用者預覽報表效果
10. 使用者儲存報表定義
11. 系統更新報表定義檔

### 5.3 報表排程設定流程
1. 使用者選擇報表排程功能
2. 使用者選擇要排程的報表
3. 系統顯示排程設定介面
4. 使用者設定排程名稱和描述
5. 使用者設定執行頻率和時間
6. 使用者設定報表參數
7. 使用者設定輸出格式和交付方式
8. 使用者設定通知選項
9. 使用者儲存排程設定
10. 系統更新報表排程檔
11. 系統根據排程自動執行報表

### 5.4 資料鑽取流程
1. 使用者查看報表結果
2. 使用者點擊可鑽取的資料項目
3. 系統識別鑽取目標和參數
4. 系統執行鑽取查詢
5. 系統擷取詳細資料
6. 系統顯示鑽取結果
7. 使用者可繼續鑽取或返回上層
8. 使用者可匯出鑽取結果

## 6. 使用者介面

### 6.1 網頁前端介面

#### 6.1.1 報表選擇頁面
- 報表類別導航
- 標準報表列表
- 自定義報表列表
- 最近使用報表
- 收藏報表
- 報表搜尋功能
- 新建報表按鈕

#### 6.1.2 報表參數設定頁面
- 報表基本資訊顯示
- 參數輸入區域
- 日期選擇控制
- 組織選擇控制
- 幣別選擇控制
- 參數驗證提示
- 執行與取消按鈕

#### 6.1.3 報表顯示頁面
- 報表標題與摘要
- 報表資料表格
- 分頁控制
- 縮放控制
- 排序與篩選控制
- 資料鑽取連結
- 功能按鈕區域

#### 6.1.4 報表設計頁面
- 報表基本設定區域
- 欄位定義區域
- 資料來源設定
- 計算公式編輯器
- 格式設定控制
- 排序與分組設定
- 預覽與儲存按鈕

#### 6.1.5 視覺化設計頁面
- 圖表類型選擇
- 資料系列設定
- 軸與標籤設定
- 圖表樣式設定
- 互動選項設定
- 圖表預覽區域
- 儲存與套用按鈕

### 6.2 報表輸出介面

#### 6.2.1 資產負債表
- 報表標題與期間
- 資產區域
- 負債區域
- 權益區域
- 合計與小計
- 比較欄位
- 註腳與說明

#### 6.2.2 損益表
- 報表標題與期間
- 收入區域
- 成本區域
- 費用區域
- 稅前利潤
- 稅金
- 淨利
- 每股盈餘

#### 6.2.3 現金流量表
- 報表標題與期間
- 營業活動現金流量
- 投資活動現金流量
- 融資活動現金流量
- 匯率影響
- 現金增減變動
- 期初與期末現金餘額

#### 6.2.4 財務比率分析報表
- 報表標題與期間
- 流動性比率
- 償債能力比率
- 獲利能力比率
- 營運效率比率
- 成長性比率
- 比較數據
- 趨勢圖表

## 7. 系統整合

### 7.1 與總帳系統整合
- 擷取會計科目餘額
- 擷取會計分錄資料
- 同步會計期間設定
- 同步會計科目結構
- 同步組織結構資料

### 7.2 與成本會計系統整合
- 擷取成本中心資料
- 擷取成本分攤資料
- 擷取產品成本資料
- 同步成本計算規則
- 同步成本分析維度

### 7.3 與預算系統整合
- 擷取預算資料
- 擷取預算差異分析
- 同步預算版本管理
- 同步預算調整資料
- 同步預算控制參數

### 7.4 與資料倉儲整合
- 擷取歷史財務資料
- 擷取多維度分析資料
- 同步資料模型定義
- 同步資料轉換規則
- 同步資料更新排程

## 8. 安全性需求

### 8.1 資料安全
- 財務資料存取控制
- 敏感財務資料加密
- 資料傳輸加密
- 定期資料備份
- 資料存取稽核記錄

### 8.2 使用者認證與授權
- 使用者身份驗證
- 角色基礎存取控制
- 報表權限管理
- 資料權限管理
- 功能權限管理

### 8.3 系統安全
- 網路安全防護
- 系統漏洞定期檢測
- 安全更新管理
- 防毒與惡意軟體防護
- 系統安全稽核

## 9. 效能需求

### 9.1 回應時間
- 標準報表生成時間不超過 10 秒
- 複雜報表生成時間不超過 30 秒
- 資料鑽取回應時間不超過 5 秒
- 報表參數設定回應時間不超過 2 秒
- 報表匯出時間不超過 15 秒

### 9.2 處理能力
- 支援同時 30 位使用者在線
- 每日處理 500 次報表請求
- 支援處理 5 年財務資料
- 支援 100 個自定義報表
- 系統可用性達 99.5%

### 9.3 擴展性
- 支援水平擴展
- 模組化設計
- 可配置的報表處理流程
- 彈性的報表定義結構
- 支援未來功能擴展

## 10. 測試需求

### 10.1 功能測試
- 標準報表生成測試
- 自定義報表設計測試
- 報表參數設定測試
- 報表匯出功能測試
- 資料鑽取功能測試

### 10.2 效能測試
- 報表生成效能測試
- 大量資料處理測試
- 並發使用者測試
- 長時間運行穩定性測試
- 資料庫查詢效能測試

### 10.3 安全測試
- 使用者認證測試
- 權限控制測試
- 資料存取控制測試
- 資料加密測試
- 安全漏洞掃描

### 10.4 整合測試
- 與總帳系統整合測試
- 與成本會計系統整合測試
- 與預算系統整合測試
- 與資料倉儲整合測試
- 與使用者管理系統整合測試

## 11. 實施計劃

### 11.1 開發階段
1. 需求分析與設計 (3週)
2. 資料庫設計與建置 (2週)
3. 後端程式開發 (4週)
4. 前端介面開發 (4週)
5. 報表模板開發 (3週)
6. 系統整合 (3週)
7. 測試與除錯 (3週)
8. 文件編寫 (2週)

### 11.2 測試階段
1. 單元測試 (2週)
2. 整合測試 (2週)
3. 系統測試 (2週)
4. 使用者接受度測試 (2週)
5. 效能測試 (1週)
6. 安全測試 (1週)

### 11.3 部署階段
1. 環境準備 (1週)
2. 系統部署 (1週)
3. 資料遷移 (2週)
4. 使用者培訓 (2週)
5. 上線準備 (1週)
6. 正式上線 (1天)
7. 上線後支援 (4週)

## 12. 維護計劃

### 12.1 日常維護
- 系統監控與警報
- 資料庫維護與優化
- 報表效能調整
- 安全更新與修補
- 問題追蹤與解決

### 12.2 定期維護
- 每週系統備份
- 每月系統效能評估
- 每季安全稽核
- 每半年系統升級評估
- 每年系統全面檢修

### 12.3 問題處理流程
1. 問題報告接收
2. 問題分類與優先級評估
3. 問題分派與處理
4. 解決方案測試與驗證
5. 解決方案部署
6. 問題解決確認與記錄

## 13. 文件需求

### 13.1 技術文件
- 系統架構文件
- 資料庫設計文件
- 程式設計文件
- API 文件
- 測試文件

### 13.2 使用者文件
- 使用者手冊
- 管理員手冊
- 報表設計指南
- 常見問題解答
- 故障排除指南

### 13.3 培訓文件
- 使用者培訓教材
- 管理員培訓教材
- 報表設計培訓教材
- 系統功能介紹
- 實際操作案例

## 14. 附錄

### 14.1 術語表
- **WEB020**: Web 化財務報表系統程式編號
- **Web 化**: 將傳統 AS/400 綠屏介面轉換為網頁介面的過程
- **資料鑽取**: 從摘要資料深入查看詳細資料的功能
- **報表參數**: 控制報表生成範圍和內容的設定
- **視覺化**: 使用圖表和圖形展示財務資料的方式

### 14.2 參考資料
- AS/400 系統技術文件
- RPG IV 程式設計指南
- Web 應用程式開發標準
- 財務報表設計最佳實踐
- 系統整合設計指南

### 14.3 變更歷史
| 版本 | 日期 | 變更說明 | 變更人 |
|------|------|----------|--------|
| 0.1 | 2023/02/01 | 初稿 | 系統分析師 |
| 0.2 | 2023/02/15 | 新增視覺化需求 | 使用者體驗設計師 |
| 0.3 | 2023/03/01 | 修訂報表功能需求 | 財務顧問 |
| 0.4 | 2023/03/15 | 完善安全需求 | 安全專家 |
| 1.0 | 2023/04/01 | 正式版本 | 專案經理 |
