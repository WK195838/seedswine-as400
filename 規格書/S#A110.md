# S#A110 用戶基本資料維護程式詳細規格說明書

## 一、基本信息

- **程式ID**: S#A110
- **程式名稱**: 用戶基本資料維護程式
- **作者**: A1062 JEANNY LIN
- **建立日期**: 79/06/26
- **更新日期**: 98/10/28 (Y2K修改)
- **系統**: 系統管理子系統
- **功能**: 用戶基本資料維護

## 二、程式概述

S#A110是西祺企業管理信息系統中的用戶基本資料維護程式，負責管理系統用戶的基本資料，包括用戶帳號、用戶名稱、權限設定等。該程式提供完整的CRUD（新增、查詢、修改、刪除）功能，確保系統用戶資料的正確性和完整性。作為系統管理模塊的核心組件，它為整個系統的用戶管理提供基礎支持。

## 三、系統架構

### 相關文件

1. **S#SUPF** - 用戶主檔案（物理文件）
   - 用於存儲用戶基本資料
   - 使用方式：更新（UF）
   - 主鍵：SU01（用戶編號）

2. **S#A110D** - 顯示文件
   - 用於用戶界面顯示和資料輸入
   - 包含兩個記錄格式：DSPC1（主畫面）和DSPC2（資料維護畫面）

3. **S#RF** - 參考文件
   - 定義系統中使用的標準欄位格式和屬性

4. **S#S110** - 用戶權限檢查程式
   - 被S#A110調用，用於檢查用戶操作權限

### 資料結構

用戶主檔案(S#SUPF)主要欄位：
- **SU01**: 用戶編號（主鍵，10字元）- 用於唯一識別系統用戶
- **SU02**: 用戶名稱（10字元）- 用戶的顯示名稱
- **SU03**: 授權者編號（10字元）- 創建此用戶的管理員編號
- **SU04**: 部門（10字元）- 用戶所屬部門
- **SU05**: 職稱（10字元）- 用戶的職位名稱
- **SU06**: 備註（10字元）- 其他相關信息
- **SU07**: 權限代碼（10字元）- 用戶的系統權限級別
- **SU97**: 建立日期（6位數字，格式：YYMMDD）- 記錄創建日期
- **SU98**: 建立時間（6位數字，格式：HHMMSS）- 記錄創建時間
- **SU99**: 建立者ID（10字元）- 記錄創建者的用戶ID

## 四、程式流程

### 主要流程

1. **初始化（RTN010）**
   - 設定初始值和環境變數
   - 獲取當前用戶資訊（USER）
   - 設定初始畫面ID為'SC01'
   - 設定初始操作選項為'1'（新增）

2. **主畫面處理（RTN100）**
   - 顯示SC01畫面（用戶列表和操作選項）
   - 接收用戶輸入（用戶編號和操作選項）
   - 處理功能鍵（F3=返回，F18=系統查詢）
   - 執行畫面檢查（RTN110）
   - 根據檢查結果轉到SC02畫面或繼續處理

3. **資料維護畫面處理（RTN200）**
   - 根據操作選項執行相應功能：
     - 1=新增（RTN210）
     - 2=修改（RTN220）
     - 4=刪除（RTN230）
     - 5=查詢（RTN240）
   - 處理功能鍵（F3=返回主選單，F12=返回主畫面）

### 詳細流程

1. **新增用戶資料（RTN210）**
   - 設定畫面欄位可輸入（*IN31=ON）
   - 獲取當前用戶資訊作為授權者
   - 顯示SC02畫面
   - 接收用戶輸入
   - 驗證資料（RTN250）
   - 將畫面資料轉換為檔案格式（RTN270）
   - 寫入資料庫（WRITE SU0）
   - 返回主畫面

2. **修改用戶資料（RTN220）**
   - 讀取現有資料（RTN260）
   - 設定畫面欄位可輸入（*IN31=ON）
   - 顯示SC02畫面
   - 接收用戶修改
   - 驗證資料（RTN250）
   - 將畫面資料轉換為檔案格式（RTN270）
   - 更新資料庫（UPDATE SU0）
   - 返回主畫面

3. **刪除用戶資料（RTN230）**
   - 讀取現有資料（RTN260）
   - 設定畫面欄位為唯讀（*IN31=OFF）
   - 顯示確認畫面
   - 確認後刪除資料（DELETE SU0）
   - 返回主畫面

4. **查詢用戶資料（RTN240）**
   - 讀取現有資料（RTN260）
   - 設定畫面欄位為唯讀（*IN31=OFF）
   - 顯示資料
   - 返回主畫面

5. **畫面檢查（RTN110）**
   - 檢查用戶是否存在
   - 檢查操作權限
   - 檢查資料存在性
   - 設定相應的錯誤指示器

6. **檔案到畫面轉換（RTN260）**
   - 讀取檔案資料（CHAIN SU0）
   - 將檔案資料轉換為畫面格式
   - 處理日期和時間格式
   - 獲取授權者名稱

7. **畫面到檔案轉換（RTN270）**
   - 獲取畫面資料
   - 將畫面資料轉換為檔案格式
   - 設定建立/修改日期、時間和用戶

## 五、權限控制機制

程式包含嚴格的權限控制機制：

1. **中心用戶檢查**
   - 中心用戶(CENTER='REPGMR')擁有最高權限
   - 中心用戶可以維護所有用戶資料
   - 非中心用戶受到以下限制：

2. **授權檢查**
   - 用戶只能修改由自己創建的用戶資料（SU03=USER）
   - 用戶不能修改中心用戶資料（DSU01=CENTER）
   - 管理員（SU03='REPGMR'）可以修改所有用戶資料

3. **操作權限檢查**
   - 新增操作（DOPT='1'）：檢查用戶是否已存在
   - 修改/刪除/查詢操作：檢查用戶是否存在
   - 修改/刪除操作：檢查操作權限

4. **特殊限制**
   - 非授權用戶無法刪除或修改管理員資料
   - 用戶無法修改自己的授權者編號（顯示為唯讀）

## 六、畫面設計

### SC01畫面（主畫面）
- 顯示系統標題和日期
- 顯示當前用戶名稱
- 用戶編號輸入欄位
- 操作選項（1=新增、2=修改、4=刪除、5=查詢）
- 功能鍵：F3(返回主選單)、F18(系統查詢)
- 錯誤訊息顯示區域

### SC02畫面（資料維護）
- 顯示系統標題和日期
- 顯示當前用戶名稱和操作類型
- 用戶編號（唯讀）
- 用戶名稱（可編輯/唯讀，根據操作類型）
- 授權者編號（唯讀）
- 授權者名稱（唯讀）
- 權限代碼（可編輯/唯讀）
- 部門（可編輯/唯讀）
- 職稱（可編輯/唯讀）
- 備註（可編輯/唯讀）
- 建立日期、時間和用戶（唯讀）
- 功能鍵：F3(返回主選單)、F12(返回上一畫面)
- 錯誤訊息顯示區域

## 七、錯誤處理

程式包含完整的錯誤處理機制：

1. **輸入驗證**
   - 用戶編號不能為空（錯誤代碼60/98）
   - 用戶名稱不能為空（錯誤代碼60/98）

2. **權限檢查**
   - 非中心用戶無法修改中心用戶資料（錯誤代碼60/95）
   - 非授權用戶無法修改其他用戶資料（錯誤代碼60/94）

3. **資料存在性檢查**
   - 新增時，用戶不能已存在（錯誤代碼60/97）
   - 修改/刪除/查詢時，用戶必須存在（錯誤代碼60/96）

4. **系統錯誤**
   - 檔案訪問錯誤（錯誤代碼93）

5. **錯誤訊息顯示**
   - 使用指示器控制錯誤訊息顯示
   - 錯誤訊息從訊息文件中獲取（PTMF和S#MF）

## 八、程式調用關係

### 被調用程式
1. **S#S110** - 用戶權限檢查程式
   - 參數：DSU01（用戶編號）
   - 返回：*IN03（操作結果）

### 調用方式
1. **從系統主選單進入**
   - 通過S#M000程式調用
   - 參數：無

2. **從其他程式通過功能鍵調用**
   - 通過F18功能鍵調用
   - 參數：無

3. **通過命令行直接調用**
   - 命令：CALL S#A110
   - 參數：無

## 九、安全與效能考量

### 安全考量
1. **權限控制**
   - 嚴格的用戶權限檢查機制
   - 中心用戶和普通用戶權限分離
   - 授權機制確保資料安全

2. **資料保護**
   - 敏感操作需要確認
   - 資料修改記錄（日期、時間、用戶）
   - 防止未授權修改

3. **審計追蹤**
   - 記錄資料建立和修改資訊
   - 可追蹤用戶操作歷史

### 效能考量
1. **資料庫訪問優化**
   - 使用鍵值訪問提高效率（CHAIN操作）
   - 最小化資料庫讀寫操作

2. **畫面處理**
   - 使用指示器控制畫面顯示
   - 減少不必要的畫面重繪

3. **錯誤處理**
   - 及時檢查和報告錯誤
   - 防止無效操作消耗系統資源

## 十、程式修改歷史

1. **初始版本**
   - 日期：79/06/26
   - 作者：A1062 JEANNY LIN
   - 描述：程式初始開發

2. **Y2K修改**
   - 日期：98/10/28
   - 作者：MICHELLE
   - 描述：為應對Y2K問題進行修改
   - 修改內容：日期格式處理和顯示

## 十一、使用說明

### 操作流程
1. **進入程式**
   - 從系統主選單選擇用戶管理選項
   - 或直接輸入命令CALL S#A110

2. **主畫面操作**
   - 輸入用戶編號
   - 選擇操作類型（1=新增、2=修改、4=刪除、5=查詢）
   - 按Enter繼續

3. **資料維護**
   - 根據操作類型，輸入或修改相關資料
   - 按Enter保存
   - 按F12返回主畫面
   - 按F3返回主選單

### 常見問題處理
1. **權限不足**
   - 確認用戶是否有足夠權限
   - 聯繫系統管理員獲取權限

2. **資料不存在**
   - 確認用戶編號是否正確
   - 使用查詢功能確認用戶存在

3. **無法修改特定欄位**
   - 某些欄位可能受到權限限制
   - 某些欄位在特定操作下為唯讀

## 十二、系統整合

1. **與其他模塊的關係**
   - 作為系統管理模塊的核心組件
   - 為其他業務模塊提供用戶認證和授權支持
   - 與S#S01（權限檢查）程式密切配合

2. **資料共享**
   - S#SUPF檔案被多個程式共享使用
   - 用戶資料被整個系統引用

3. **系統依賴**
   - 系統登錄和權限控制依賴於此程式
   - 系統安全性很大程度上取決於此程式的正確運行

## 十三、總結

S#A110是西祺企業管理信息系統中的核心用戶管理程式，提供完整的用戶資料維護功能。通過嚴格的權限控制和完善的錯誤處理，確保系統用戶資料的安全性和完整性。該程式是系統安全管理的重要組成部分，為其他業務模塊提供用戶認證和授權支持。

程式設計遵循結構化編程原則，具有良好的模塊化和可維護性。通過清晰的流程控制和完善的錯誤處理，確保程式運行的穩定性和可靠性。同時，程式也考慮了效能和安全性，為系統提供高效、安全的用戶管理功能。

作為系統管理的基礎，S#A110程式的穩定運行對整個系統的安全性和可用性至關重要。因此，在系統維護和升級過程中，應特別注意保持此程式的完整性和正確性。