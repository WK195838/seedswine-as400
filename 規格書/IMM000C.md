# IMM000C 程式規格書

## 1. 基本資訊

- **程式名稱**：IMM000C
- **程式類型**：CL程式（控制語言程式）
- **程式庫**：REPLIB
- **功能描述**：庫存管理系統主選單控制程式
- **相關檔案**：IMM000D（顯示檔案）
- **系統名稱**：西祺企業經營管理資訊系統
- **子系統**：庫存管理系統
- **作者**：ROGER CHIEN
- **建立日期**：80/11/15
- **最後修改日期**：根據檔案時間戳記為19940406（從IMM000D的時間戳記推斷）
- **程式說明**：庫存管理系統主選單

## 2. 程式概述

IMM000C是西祺企業經營管理資訊系統中庫存管理系統的主選單控制程式。此程式負責顯示庫存管理系統的主選單介面，處理使用者的選擇，檢查使用者權限，並呼叫相應的庫存管理功能模組程式。它是庫存管理系統的中央控制點，提供了一個統一的入口點來訪問所有庫存管理相關功能。

庫存管理系統是企業資訊系統的核心組成部分，負責追蹤和管理企業的庫存資產，包括原材料、在製品和成品。它涵蓋了從進貨、出貨、調撥、盤點到庫存分析等全面的庫存管理功能，確保企業能夠有效地控制庫存水平，降低庫存成本，同時滿足生產和銷售需求。

IMM000C作為庫存管理系統的入口，其設計遵循了AS/400系統的標準程式設計規範，採用模組化結構，確保系統的可維護性和擴展性。

## 3. 程式流程詳解

```
開始
  |
  ↓
宣告變數和檔案
  | - 宣告日期變數&WDATE (6字元)
  | - 宣告使用者ID變數&$USER (10字元)
  | - 宣告權限檢查參數變數&S0101I, &S0102I, &S0101O
  | - 宣告IMM000D顯示檔案
  ↓
初始化系統環境
  | - 從LDA獲取使用者ID (位置101-110)
  | - 從LDA獲取系統日期 (位置119-124)
  | - 設定顯示日期變數$EGMDY
  | - 設定權限檢查使用者ID參數&S0101I
  ↓
START: 顯示主選單
  | - 發送/接收顯示檔案DSPC1格式
  | - 重設錯誤指示器IN98和IN97
  | - 檢查F3鍵是否按下 (返回上層選單)
  ↓
處理使用者選擇
  | - 檢查選項代碼DOPID
  | - 根據選項設定對應程式名稱到&S0102I
  | - 如果選項為空，返回START
  | - 特殊處理選項48（執行查詢並返回主選單）
  ↓
CHKAUT: 檢查使用者權限
  | - 呼叫S#S01程式檢查權限
  | - 傳遞參數：使用者ID、目標程式、權限結果
  ↓
根據權限結果處理
  | - 如果有權限(S0101O='Y')，呼叫目標程式
  | - 如果無權限，設定錯誤指示器顯示錯誤訊息
  ↓
返回主選單 (GOTO START)
  |
  ↓
結束
```

## 4. 程式碼詳細分析

### 4.1 變數宣告與初始化

```
PGM
DCL VAR(&WDATE) TYPE(*CHAR) LEN(6)
DCL VAR(&$USER) TYPE(*CHAR) LEN(10)
DCL VAR(&S0101I) TYPE(*CHAR) LEN(10)
DCL VAR(&S0102I) TYPE(*CHAR) LEN(10)
DCL VAR(&S0101O) TYPE(*CHAR) LEN(1)
DCLF FILE(*LIBL/IMM000D) RCDFMT(DSPC1)
```

- **PGM**：程式開始標記
- **&WDATE**：字元變數，長度為6，用於儲存系統日期（格式為YYMMDD）
- **&$USER**：字元變數，長度為10，用於儲存當前使用者ID
- **&S0101I**：字元變數，長度為10，用於傳遞使用者ID到權限檢查程式
- **&S0102I**：字元變數，長度為10，用於傳遞目標程式名稱到權限檢查程式
- **&S0101O**：字元變數，長度為1，用於接收權限檢查結果（'Y'表示有權限）
- **DCLF**：宣告顯示檔案IMM000D，使用DSPC1記錄格式

### 4.2 系統初始化與環境設定

```
RTVDTAARA DTAARA(*LDA (101 10)) RTNVAR(&$USER)
RTVDTAARA DTAARA(*LDA (119 6)) RTNVAR(&WDATE)
CHGVAR VAR(&$EGMDY) VALUE(&WDATE)
CHGVAR VAR(&S0101I) VALUE(&$USER)
```

- **RTVDTAARA**：從本地資料區(LDA)檢索資料
  - 從位置101開始的10個字元檢索使用者ID到&$USER
  - 從位置119開始的6個字元檢索系統日期到&WDATE
  - LDA是AS/400系統中的一個特殊資料區，用於在程式之間傳遞資訊
- **CHGVAR**：變更變數值
  - 將&WDATE的值設定到顯示變數$EGMDY，用於在主選單上顯示日期
  - 將&$USER的值設定到權限檢查參數&S0101I

### 4.3 主選單顯示與使用者輸入處理

```
START:
SNDRCVF DEV(*FILE) RCDFMT(DSPC1)
CHGVAR VAR(&IN98) VALUE('0')
CHGVAR VAR(&IN97) VALUE('0')
IF COND(&IN03 *EQ '1') THEN(RETURN)
```

- **START**：程式標籤，用於循環顯示主選單
- **SNDRCVF**：發送/接收顯示檔案
  - DEV(*FILE)指定使用宣告的顯示檔案
  - RCDFMT(DSPC1)指定使用DSPC1記錄格式
  - 此命令顯示主選單並等待使用者輸入
- **CHGVAR**：重設錯誤指示器
  - IN98為'0'，清除之前可能的權限錯誤狀態
  - IN97為'0'，清除之前可能的查詢訊息狀態
- **IF COND(&IN03 *EQ '1') THEN(RETURN)**：
  - 檢查是否按下F3功能鍵（由CA03關鍵字在顯示檔案中定義）
  - 如果按下F3，則返回上層程式（可能是REM000C系統主選單）

### 4.4 選項處理（詳細分析）

```
IF COND(&DOPID *EQ '01') THEN(DO)
   CHGVAR VAR(&S0102I) VALUE('IMA001')
ENDDO
...
IF COND(&DOPID *EQ '48') THEN(DO)
RUNQRY QRY(REPLIB/CHKIMR044F) RCDSLT(*YES)
RUNQRY QRY(REPLIB/CHKIMR0442)
CHGVAR VAR(&IN97) VALUE('1')
GOTO START
ENDDO
IF COND(&DOPID *EQ '  ') THEN(GOTO START)
GOTO CHKAUT
```

- **選項處理結構**：使用一系列IF-THEN-ENDDO結構處理不同的選項
  - 每個IF語句檢查DOPID（使用者輸入的選項）是否等於特定值
  - 如果匹配，則將相應的程式名稱設定到&S0102I變數
  - 這種結構雖然冗長，但清晰明確，便於維護
- **程式命名規則**：
  - IMA系列：庫存管理資料維護程式（如IMA001、IMA002）
  - IMI系列：庫存查詢程式（如IMI021、IMI022）
  - IMR系列：庫存報表程式（如IMR042C、IMR041C）
  - DPA/DPI系列：可能是其他相關系統的程式
  - PYZ系列：可能是特殊功能程式
- **特殊處理選項48**：
  - 直接執行兩個查詢（RUNQRY命令）
  - 設定指示器IN97為'1'，可能用於顯示查詢完成訊息
  - 執行完查詢後直接返回START標籤，不進行權限檢查
- **空選項處理**：如果DOPID為空（'  '），則返回START標籤重新顯示選單
- **處理完成後**：無條件跳轉到CHKAUT標籤進行權限檢查

### 4.5 權限檢查與程式呼叫

```
CHKAUT: CALL PGM(S#S01) PARM(&S0101I &S0102I &S0101O)
IF COND(&S0101O = 'Y') THEN(CALL PGM(&S0102I))
ELSE CMD(CHGVAR VAR(&IN98) VALUE('1'))
GOTO START
```

- **CHKAUT**：權限檢查標籤
- **CALL PGM(S#S01)**：呼叫權限檢查程式S#S01
  - 傳遞三個參數：
    - &S0101I：使用者ID
    - &S0102I：目標程式名稱
    - &S0101O：權限檢查結果（輸出參數）
  - S#S01可能是一個通用的權限檢查程式，用於整個系統
- **IF COND(&S0101O = 'Y')**：檢查權限結果
  - 如果&S0101O為'Y'，表示使用者有權限執行所選程式
  - 則呼叫目標程式：CALL PGM(&S0102I)
  - 否則，設定錯誤指示器IN98為'1'，這將在下一次顯示主選單時顯示錯誤訊息
- **GOTO START**：無論權限檢查結果如何，都返回START標籤重新顯示主選單

### 4.6 程式結束

```
ENDPGM
```

- **ENDPGM**：標記程式結束
- 注意：由於程式的循環結構，正常情況下只有當使用者按下F3鍵時，程式才會通過RETURN命令結束

## 5. 功能模組對應表（詳細版）

| 選項 | 程式名稱 | 功能描述 | 類別 |
|------|----------|----------|------|
| 01 | IMA001 | 進貨驗收作業處理 | 資料操作 |
| 02 | IMA002 | 退貨驗收作業處理 | 資料操作 |
| 03 | IMA003 | 開業盤點作業處理 | 資料操作 |
| 04 | IMA004 | 領料處理 | 資料操作 |
| 05 | IMA005 | 調撥處理 | 資料操作 |
| 06 | IMA006 | 製程領料轉換處理 | 資料操作 |
| 07 | IMA010 | 盤盈盤虧作業處理 | 資料操作 |
| 08 | IMA008 | 進貨單號資料輸入 | 資料操作 |
| 09 | IMA009C | 盤點處理 | 資料操作 |
| 10 | DPA002 | 產品條碼列印 | 資料操作 |
| 11 | IMA013 | 半成品調撥作業 | 資料操作 |
| 1A | DPA005 | 查詢半成品調撥作業 | 資料操作 |
| 2A | PYZ999 | 進貨單列印 | 資料操作 |
| 21 | IMI021 | 料件庫存查詢 | 查詢作業 |
| 22 | IMI022 | 料倉別庫存查詢 | 查詢作業 |
| 23 | IMI023 | 料倉別進出貨查詢 | 查詢作業 |
| 24 | IMI024 | 庫存異常查詢 | 查詢作業 |
| 25 | IMI025 | 料件異常查詢 | 查詢作業 |
| 26 | DPI021 | 半成品調撥查詢 | 查詢作業 |
| 27 | POI021 | 異常查詢請購料件 | 查詢作業 |
| 28 | IMI027 | 半成品異常查詢 | 查詢作業 |
| 41 | IMR042C | 庫存總帳報表 | 報表列印 |
| 42 | IMR041C | 進貨統計月報表 | 報表列印 |
| 43 | IMR043C | 庫存進貨月報表 | 報表列印 |
| 44 | IMR044C | 進貨單 | 報表列印 |
| 45 | IMR045C | 領料單列印 | 報表列印 |
| 46 | IMR077C | 轉換列印作 | 報表列印 |
| 47 | IMR083C | 異常料件列印作 | 報表列印 |
| 48 | (查詢) | 檢查進貨單資料 | 特殊查詢 |

## 6. IMM000D顯示檔案詳細分析

### 6.1 檔案頭部資訊

```
A*%%TS  SD  19940406  091535  D910121     REL-V2R2M0  5738-PW1
A*  80/11/15  13:46:08    REPGMR      REL-R03M00  5728-PW1
A****************************************************************
A*   西祺資訊系統開發顧問有限公司    TEL:7313250    *
A*--------------------------------------------------------------*
A*    DSPF NAME    : IMM000D                                    *
A*    AUTHOR       : A1005   ROGER CHIEN                        *
A*    CREATE DATE  : 80/11/15                                   *
A*    UPDATE DATE  :                                            *
A*    PROGRAM NAME : IMM000C                                    *
A*    SYSTEM       :企業經營管理庫存管理系統                    *
A*    SUBSYSTEM    :                                            *
A*    REMARK       :主畫面                                    *
A****************************************************************
```

- **時間戳記**：顯示檔案最後修改時間為19940406（1994年4月6日）
- **作者資訊**：ROGER CHIEN（員工編號A1005）
- **建立日期**：80/11/15（1980年11月15日）
- **系統資訊**：企業經營管理庫存管理系統
- **備註**：主畫面

### 6.2 顯示檔案屬性

```
A                                      DSPSIZ(24 80 *DS3)
A                                      MSGLOC(24)
A                                      PRINT
A                                      CA03(03)
```

- **DSPSIZ(24 80 *DS3)**：設定顯示大小為24行80列，使用DS3顯示站
- **MSGLOC(24)**：設定訊息顯示位置在第24行
- **PRINT**：允許列印顯示畫面
- **CA03(03)**：定義F3功能鍵為條件指示器03，用於返回上層選單

### 6.3 畫面布局分析

主選單畫面分為四個主要區域：

1. **標題區域**（第1-3行）：
   - 顯示程式ID、系統名稱、日期、時間和使用者ID
   - 使用高亮和底線強調系統標題

2. **資料操作區域**（左上區域）：
   - 包含進貨、退貨、盤點等基本庫存操作功能
   - 選項編號從01到11，以及特殊選項1A和2A

3. **查詢作業區域**（右上區域）：
   - 包含各種庫存查詢功能
   - 選項編號從21到28

4. **報表列印區域**（右下區域）：
   - 包含各種庫存報表生成功能
   - 選項編號從41到48

### 6.4 選項輸入和功能鍵說明

```
A                                 22 30'請輸入選擇代號:'
A            DOPID          2A  B 22 48DSPATR(UL)
A                                      VALUES('  ' '01' '02' '03' '04' '05+
A                                      ' '06' '07' '08' '09' '10' '11' '21+
A                                      ' '22' '23' '24' '25' '28' '41' '42+
A                                      ' '43' '44' '45' '26' '27' '46' '1A+
                                        ' '47' '48' '2A')
A                                 23  2'功能'
A                                 23 10'F3 =回主畫面'
```

- **輸入欄位**：
  - DOPID：2字元輸入欄位，用於接收使用者選擇
  - DSPATR(UL)：底線顯示，強調輸入區域
  - VALUES：定義有效的輸入值，包括空白和所有可用的選項編號
- **功能鍵說明**：顯示F3功能鍵的用途（返回主畫面）

### 6.5 錯誤訊息區域

```
A  98        ERR1          60A  O 24  2MSGID(UPT 2023 PTMF)
A                                      DSPATR(HI)
A  97        ERR2          60A  O 24  2MSGID(UPT 2142 PTMF)
A                                      DSPATR(HI)
A                                 24 66MSGCON(014 UPT9999 *LIBL/PTMF)
A                                      DSPATR(HI)
```

- **錯誤訊息欄位**：
  - ERR1：60字元輸出欄位，由指示器98控制，顯示權限錯誤訊息
  - ERR2：60字元輸出欄位，由指示器97控制，顯示查詢完成訊息
  - 兩個訊息欄位使用不同的訊息ID，但顯示在相同位置
  - DSPATR(HI)：高亮顯示錯誤訊息
- **固定訊息**：在錯誤訊息區域右側顯示固定訊息(MSGCON)

### 6.6 修改記錄

```
M001MA                                 13 15'* 09.盤點處理'
...
M001MA*                                 8 57'24.庫存異常查詢'
M001MA                                  8 57'24.異常庫存查詢'
```

- **修改標記**：M001M表示這是一個修改記錄
- **修改內容**：
  - 選項09的描述前添加了星號(*)，可能表示特別注意或重要功能
  - 選項24的描述從"庫存異常查詢"改為"異常庫存查詢"
- **修改原因**：可能是為了更準確地描述功能或標記重要功能

## 7. 庫存管理系統的業務價值

### 7.1 庫存控制與優化

1. **庫存水平控制**：
   - 通過進貨、出貨、調撥等功能維持適當的庫存水平
   - 避免過剩庫存和缺貨風險
   - 降低庫存持有成本

2. **庫存準確性**：
   - 通過盤點功能確保實際庫存與系統記錄一致
   - 及時發現並處理庫存異常
   - 提高庫存資料的可靠性

3. **庫存分析**：
   - 通過各種查詢和報表功能分析庫存狀況
   - 識別滯銷和快銷品項
   - 支援庫存優化決策

### 7.2 營運效益

1. **生產支援**：
   - 確保生產所需材料的可用性
   - 通過領料和調撥功能支援生產流程
   - 減少因材料短缺導致的生產中斷

2. **成本控制**：
   - 追蹤和分析庫存成本
   - 識別成本異常和浪費
   - 支援成本優化策略

3. **資產管理**：
   - 有效管理企業的庫存資產
   - 減少資產損失和浪費
   - 提高資產利用率

4. **流程效率**：
   - 標準化庫存管理流程
   - 減少手動操作和錯誤
   - 提高庫存管理效率

### 7.3 決策支援

1. **報表分析**：
   - 提供各種庫存報表和統計資料
   - 支援庫存趨勢分析和預測
   - 輔助管理決策

2. **異常管理**：
   - 識別和報告庫存異常
   - 支援問題診斷和解決
   - 改進庫存管理流程

3. **資源規劃**：
   - 支援物料需求規劃
   - 輔助採購決策
   - 優化資源分配

## 8. 系統架構關係

### 8.1 垂直架構關係

```
REM000C (系統主選單)
   |
   ↓
IMM000C (庫存管理系統主選單) ←→ IMM000D (顯示檔案)
   |
   ↓
功能模組層
   |
   ├── 資料操作模組 (IMA系列程式)
   |    |
   |    ├── 進出貨管理 (IMA001, IMA002, IMA008)
   |    |
   |    ├── 庫存調整 (IMA003, IMA005, IMA010)
   |    |
   |    ├── 領料管理 (IMA004, IMA006)
   |    |
   |    └── 特殊功能 (IMA009C, IMA013, DPA系列, PYZ系列)
   |
   ├── 查詢作業模組 (IMI系列程式)
   |    |
   |    ├── 庫存查詢 (IMI021, IMI022)
   |    |
   |    ├── 進出貨查詢 (IMI023)
   |    |
   |    ├── 異常查詢 (IMI024, IMI025, IMI027)
   |    |
   |    └── 特殊查詢 (DPI021, POI021)
   |
   └── 報表列印模組 (IMR系列程式)
        |
        ├── 庫存報表 (IMR042C)
        |
        ├── 進貨報表 (IMR041C, IMR043C, IMR044C)
        |
        ├── 領料報表 (IMR045C)
        |
        └── 特殊報表 (IMR077C, IMR083C)
```

### 8.2 水平架構關係

```
                  ┌─── 主檔系統 (MTM000C)
                  │
                  ├─── 採購系統 (PAM000C)
                  │
REM000C ──────────┼─── 銷售訂單系統 (SOM000C)
(系統主選單)      │
                  ├─── 庫存管理系統 (IMM000C) ←── 本程式
                  │
                  ├─── 生產系統 (POM000C)
                  │
                  └─── 其他子系統...
```

### 8.3 資料流關係

```
採購系統 ───────┐
                │
                ↓
              進貨驗收 ─────┐
                            │
主檔系統 ─────→ 庫存管理系統 ───→ 庫存報表
                            │
生產系統 ─────→ 領料/調撥 ───┘
                │
                ↓
銷售訂單系統 ───┘
```

## 9. 技術實現細節

### 9.1 AS/400系統特性應用

1. **CL程式特性**：
   - 使用CL(Control Language)程式實現選單控制邏輯
   - 利用CL的程式呼叫和變數處理能力
   - 使用CL的條件判斷和流程控制結構

2. **顯示檔案技術**：
   - 使用DDS(Data Description Specifications)定義顯示格式
   - 利用指示器控制顯示元素的條件顯示
   - 使用DSPATR關鍵字控制顯示屬性（高亮、底線、反向圖像等）

3. **查詢功能**：
   - 使用RUNQRY命令執行預定義的查詢
   - 支援互動式查詢（RCDSLT參數）
   - 整合查詢結果到系統流程

### 9.2 程式碼結構分析

1. **變數命名規則**：
   - 系統變數：以&開頭（如&WDATE, &$USER）
   - 顯示變數：以$開頭（如$EGMDY, $USER）
   - 參數變數：使用功能代碼和序號（如&S0101I, &S0102I）

2. **程式流程控制**：
   - 使用標籤(START, CHKAUT)定義程式區塊
   - 使用GOTO語句實現非線性流程控制
   - 使用IF-THEN-ENDDO結構實現條件邏輯

3. **特殊處理機制**：
   - 選項48的特殊處理（直接執行查詢）
   - 使用兩個不同的錯誤指示器（IN98和IN97）處理不同類型的訊息
   - 權限檢查與程式呼叫的分離處理

4. **錯誤處理機制**：
   - 使用指示器98控制權限錯誤訊息顯示
   - 使用指示器97控制查詢完成訊息顯示
   - 集中式權限檢查和錯誤處理
   - 錯誤後返回主選單，允許使用者重新選擇

### 9.3 顯示檔案設計技術

1. **畫面布局技術**：
   - 使用固定位置坐標定義顯示元素
   - 使用視覺分隔和分組組織畫面內容
   - 使用顯示屬性增強視覺效果

2. **功能分類技術**：
   - 將功能按類型分為三大類：資料操作、查詢作業、報表列印
   - 使用反向圖像(DSPATR(RI))創建視覺分隔
   - 使用底線(DSPATR(UL))強調選項描述

3. **特殊標記技術**：
   - 使用星號(*)標記特別注意的功能（如選項09）
   - 使用顏色屬性(COLOR(BLU))強調特定選項（如選項2A）
   - 使用修改記錄(M001M)追蹤顯示檔案的變更

## 10. 庫存管理系統功能模組詳解

### 10.1 進出貨管理模組

1. **進貨驗收作業(IMA001)**：
   - 功能：處理供應商送達的貨品驗收流程
   - 業務流程：記錄進貨資訊、檢查數量和品質、更新庫存記錄
   - 資料處理：增加庫存數量、記錄進貨歷史、關聯採購訂單

2. **退貨驗收作業(IMA002)**：
   - 功能：處理退回供應商的貨品流程
   - 業務流程：記錄退貨原因、確認退貨數量、更新庫存記錄
   - 資料處理：減少庫存數量、記錄退貨歷史、可能關聯原進貨記錄

3. **進貨單號資料輸入(IMA008)**：
   - 功能：輸入和維護進貨單資訊
   - 業務流程：記錄進貨單號、供應商、日期等基本資訊
   - 資料處理：建立進貨單記錄，可能作為IMA001的前置作業

4. **進貨單列印(PYZ999)**：
   - 功能：列印進貨單文件
   - 業務流程：選擇進貨單、格式化資料、生成列印輸出
   - 資料處理：讀取進貨記錄、格式化為列印格式

### 10.2 庫存調整模組

1. **開業盤點作業(IMA003)**：
   - 功能：處理系統初始化或新財年開始時的庫存盤點
   - 業務流程：記錄實際庫存數量、設定初始庫存值
   - 資料處理：建立或重設庫存記錄、記錄盤點歷史

2. **調撥處理(IMA005)**：
   - 功能：處理不同倉庫或儲位間的庫存移動
   - 業務流程：記錄調出和調入位置、數量、原因等
   - 資料處理：減少來源位置庫存、增加目標位置庫存、記錄調撥歷史

3. **盤盈盤虧作業(IMA010)**：
   - 功能：處理盤點後發現的庫存差異
   - 業務流程：記錄實際數量與系統記錄的差異、調整庫存記錄
   - 資料處理：更新庫存數量、記錄盤盈盤虧原因和金額

4. **盤點處理(IMA009C)**：
   - 功能：執行定期或不定期的庫存盤點
   - 業務流程：生成盤點清單、記錄實際數量、比對差異
   - 資料處理：記錄盤點結果、可能觸發盤盈盤虧處理

### 10.3 領料管理模組

1. **領料處理(IMA004)**：
   - 功能：處理生產或其他部門領用庫存物料的流程
   - 業務流程：記錄領料部門、數量、用途等資訊
   - 資料處理：減少庫存數量、記錄領料歷史、可能關聯生產訂單

2. **製程領料轉換處理(IMA006)**：
   - 功能：處理生產過程中的物料轉換（如原料轉為半成品）
   - 業務流程：記錄投入物料和產出物料的對應關係
   - 資料處理：減少原料庫存、增加半成品或成品庫存、記錄轉換歷史

3. **半成品調撥作業(IMA013)**：
   - 功能：處理半成品在不同生產階段或倉庫間的移動
   - 業務流程：記錄半成品的調出和調入位置、數量等
   - 資料處理：更新半成品庫存位置、記錄調撥歷史

4. **查詢半成品調撥作業(DPA005)**：
   - 功能：查詢半成品調撥的歷史記錄和當前狀態
   - 業務流程：提供查詢條件、顯示調撥記錄
   - 資料處理：讀取調撥歷史資料、格式化顯示結果

### 10.4 查詢作業模組

1. **料件庫存查詢(IMI021)**：
   - 功能：查詢特定料件的庫存狀態
   - 業務流程：提供料件代碼、顯示庫存數量和位置
   - 資料處理：讀取庫存記錄、彙總多個位置的庫存

2. **料倉別庫存查詢(IMI022)**：
   - 功能：查詢特定倉庫的庫存狀態
   - 業務流程：提供倉庫代碼、顯示該倉庫的所有料件庫存
   - 資料處理：讀取特定倉庫的庫存記錄、格式化顯示結果

3. **料倉別進出貨查詢(IMI023)**：
   - 功能：查詢特定倉庫的進出貨歷史
   - 業務流程：提供倉庫代碼和日期範圍、顯示進出貨記錄
   - 資料處理：讀取進出貨歷史資料、按倉庫篩選、格式化顯示結果

4. **異常庫存查詢(IMI024)**：
   - 功能：查詢庫存異常情況（如負庫存、超過安全庫存等）
   - 業務流程：設定異常條件、顯示符合條件的庫存記錄
   - 資料處理：讀取庫存記錄、應用異常條件篩選、格式化顯示結果

### 10.5 報表列印模組

1. **庫存總帳報表(IMR042C)**：
   - 功能：生成庫存總帳報表，顯示所有料件的庫存狀態
   - 業務流程：設定報表參數、生成報表、列印或顯示
   - 資料處理：讀取庫存記錄、彙總計算、格式化為報表格式

2. **進貨統計月報表(IMR041C)**：
   - 功能：生成月度進貨統計報表
   - 業務流程：設定報表月份、彙總進貨資料、生成報表
   - 資料處理：讀取進貨記錄、按月彙總、計算統計值

3. **庫存進貨月報表(IMR043C)**：
   - 功能：生成月度庫存和進貨綜合報表
   - 業務流程：設定報表月份、彙總庫存和進貨資料、生成報表
   - 資料處理：讀取庫存和進貨記錄、計算月初月末庫存、彙總進貨量

4. **進貨單(IMR044C)**：
   - 功能：列印正式進貨單文件
   - 業務流程：選擇進貨記錄、格式化為正式文件、列印
   - 資料處理：讀取進貨記錄、格式化為正式文件格式

5. **領料單列印(IMR045C)**：
   - 功能：列印領料單文件
   - 業務流程：選擇領料記錄、格式化為正式文件、列印
   - 資料處理：讀取領料記錄、格式化為正式文件格式

## 11. 系統整合與相依性

### 11.1 與其他系統的整合

1. **與採購系統的整合**：
   - 採購訂單資訊流向庫存管理系統，支援進貨驗收
   - 庫存異常資訊流向採購系統，觸發採購需求
   - 共享供應商和料件主檔資料

2. **與生產系統的整合**：
   - 生產計劃資訊流向庫存管理系統，支援領料規劃
   - 庫存可用性資訊流向生產系統，影響生產排程
   - 共享生產BOM（物料清單）和工藝路線資料

3. **與銷售系統的整合**：
   - 銷售訂單資訊影響庫存分配和調撥
   - 庫存可用性資訊影響銷售承諾和交期
   - 共享客戶和產品主檔資料

4. **與財務系統的整合**：
   - 庫存價值資訊流向財務系統，影響資產評估
   - 庫存成本資訊影響產品成本計算
   - 共享會計科目和成本中心資料

### 11.2 資料相依性

1. **主檔資料相依性**：
   - 料件主檔：定義庫存品項的基本屬性
   - 倉庫主檔：定義庫存位置和儲存條件
   - 供應商主檔：關聯進貨和退貨記錄
   - 單位主檔：定義庫存計量單位

2. **交易資料相依性**：
   - 進貨記錄：記錄庫存增加的來源和數量
   - 領料記錄：記錄庫存減少的去向和數量
   - 調撥記錄：記錄庫存位置變更的歷史
   - 盤點記錄：記錄實際庫存與系統記錄的比對結果

3. **參數資料相依性**：
   - 庫存參數：定義安全庫存、經濟訂購量等控制參數
   - 權限參數：定義使用者對庫存功能的訪問權限
   - 系統參數：定義系統行為和預設值

### 11.3 程式相依性

1. **直接相依程式**：
   - S#S01：權限檢查程式，IMM000C直接呼叫此程式
   - IMM000D：顯示檔案，IMM000C直接使用此檔案
   - 功能模組程式：IMA系列、IMI系列、IMR系列等，由IMM000C呼叫

2. **間接相依程式**：
   - REM000C：系統主選單程式，呼叫IMM000C
   - 初始化程式：可能負責設定LDA資料
   - 報表生成程式：支援各種庫存報表的生成

3. **查詢相依性**：
   - CHKIMR044F：檢查進貨單資料的查詢
   - CHKIMR0442：可能是進貨單資料的補充查詢
   - 這些查詢直接在IMM000C中執行，而不是通過獨立程式

## 12. 維護與擴展建議

### 12.1 程式碼優化建議

1. **結構優化**：
   - 使用SELECT-WHEN-ENDSELECT結構替代多個IF-THEN-ENDDO，簡化選項處理
   - 使用子程式結構替代GOTO語句，提高程式可讀性
   - 使用參數化設計減少硬編碼依賴

2. **錯誤處理增強**：
   - 增加更詳細的錯誤處理和日誌記錄
   - 實現結構化錯誤處理機制
   - 增加錯誤恢復和重試機制

3. **特殊處理優化**：
   - 將選項48的特殊處理（直接執行查詢）改為標準模式
   - 統一錯誤訊息處理機制
   - 增加程式執行狀態監控

### 12.2 功能擴展建議

1. **庫存管理功能擴展**：
   - 增加批次管理和效期管理功能
   - 實現先進先出(FIFO)或後進先出(LIFO)庫存管理
   - 增加庫存預警和自動補貨功能

2. **報表和分析功能擴展**：
   - 增加庫存周轉率分析報表
   - 實現庫存ABC分類分析
   - 增加庫存趨勢預測功能

3. **整合功能擴展**：
   - 增強與條碼系統的整合
   - 實現與電子資料交換(EDI)系統的整合
   - 支援移動設備庫存操作

### 12.3 使用者介面改進

1. **選單結構改進**：
   - 實現多層次選單結構，減少主選單的複雜度
   - 增加常用功能快速訪問機制
   - 實現個人化選單配置

2. **操作便利性改進**：
   - 增加批量處理功能
   - 實現資料輸入自動完成和驗證
   - 增加操作指引和幫助功能

3. **視覺效果改進**：
   - 使用更現代的視覺設計
   - 增加圖形化庫存狀態顯示
   - 實現資料可視化展示

## 13. 結論與總結

IMM000C作為西祺企業經營管理資訊系統中庫存管理系統的主選單控制程式，扮演著連接使用者和各種庫存管理功能的橋樑角色。它通過標準化的選單介面，提供了對庫存資料操作、查詢和報表功能的訪問，涵蓋了從進出貨管理、庫存調整到庫存分析的全面功能。

程式採用了AS/400系統標準的CL程式設計方法，使用顯示檔案技術實現使用者介面，通過本地資料區共享系統資訊，並使用集中式權限檢查機制確保資料安全。雖然程式結構相對簡單，但它有效地實現了功能模組化和系統整合，為使用者提供了一個統一的庫存管理系統入口。

庫存管理系統作為企業資訊系統的核心組成部分，對於企業的營運效率和成本控制至關重要。它通過精確追蹤和管理庫存資產，幫助企業維持適當的庫存水平，減少資金佔用，同時確保生產和銷售的物料需求得到滿足。系統提供的各種查詢和報表功能，為管理層提供了庫存狀況的即時視圖和分析工具，支援庫存優化和資源規劃決策。

雖然IMM000C使用的技術相對傳統，但它的設計理念和功能結構仍然具有參考價值。隨著技術的發展和業務需求的變化，可以考慮使用更現代的技術重構程式，增強其功能和使用者體驗，同時保留其核心業務邏輯和系統整合能力。

總之，IMM000C是一個典型的AS/400系統選單控制程式，它通過簡單而有效的設計，實現了庫存管理系統的功能整合和使用者訪問控制，為企業的庫存管理和決策支援提供了重要工具。它與其他系統模組共同構成了一個完整的企業資源規劃(ERP)系統，支援企業的整體營運和管理。