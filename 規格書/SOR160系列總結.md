# SOR160系列 - 銷售訂單入庫報表程式系列總結

## 系列概述
SOR160系列是西祺企業經營管理資訊系統中的銷售訂單入庫報表程式系列，負責生成銷售訂單入庫報表，幫助用戶查詢、分析和管理銷售訂單數據。該系列程式包括主程式、控制程式、查詢程式、報表生成程式和PC匯出程式等多個組件，形成了一個完整的報表生成系統。

SOR160系列程式的設計遵循模塊化和可維護性原則，各個組件之間職責明確，協同工作，為用戶提供全面、準確的銷售訂單入庫資訊，幫助用戶有效地分析和管理銷售訂單數據。

## 系列組件

### 1. SOR160 - 主程式
- **功能**：提供用戶界面，接收用戶輸入的查詢條件，調用控制程式執行報表生成
- **類型**：RPG程式
- **關鍵特點**：用戶界面、參數傳遞、錯誤處理

### 2. SOR160C - 控制程式
- **功能**：協調整個報表生成流程，調用查詢程式和報表生成程式
- **類型**：CL程式
- **關鍵特點**：流程控制、參數傳遞、錯誤處理

### 3. SOR160C1 - 查詢程式
- **功能**：根據用戶指定的查詢條件從銷售訂單相關檔案中查詢數據
- **類型**：RPG程式
- **關鍵特點**：數據查詢、條件過濾、工作檔生成

### 4. SOR1602 - 報表格式1生成程式
- **功能**：生成按客戶分組的銷售訂單入庫報表
- **類型**：RPG程式
- **關鍵特點**：報表生成、數據分組、小計和合計計算

### 5. SOR1603 - 報表格式2生成程式
- **功能**：生成按商品分組的銷售訂單入庫報表
- **類型**：RPG程式
- **關鍵特點**：報表生成、數據分組、小計和合計計算

### 6. SOR160C2 - PC匯出程式
- **功能**：將銷售訂單入庫報表數據匯出到PC
- **類型**：CL程式
- **關鍵特點**：數據匯出、格式轉換、文件傳輸

### 7. SOR160D - 顯示檔
- **功能**：定義銷售訂單入庫報表查詢條件輸入畫面
- **類型**：DSPF（顯示檔）
- **關鍵特點**：用戶界面、字段定義、功能鍵定義

### 8. SOR160P - 打印檔
- **功能**：定義銷售訂單入庫報表的打印格式
- **類型**：PRTF（打印檔）
- **關鍵特點**：報表格式、字段定義、頁面布局

## 數據流程

### 1. 查詢條件輸入
用戶通過SOR160主程式的界面（使用SOR160D顯示檔）輸入查詢條件，包括交易類型、客戶代碼、商品代碼、業務員代碼、日期範圍、報表格式等。

### 2. 數據查詢
SOR160C控制程式接收查詢條件，調用SOR160C1查詢程式從銷售訂單相關檔案（SOVMPF、SOVDPF、PA#HPF、PTMAPF、MTMELF等）中查詢符合條件的數據，並將結果寫入工作檔REWF2。

### 3. 報表生成
根據用戶選擇的報表格式，SOR160C控制程式調用相應的報表生成程式：
- 如果選擇報表格式1（按客戶分組），調用SOR1602生成報表
- 如果選擇報表格式2（按商品分組），調用SOR1603生成報表
報表生成程式從工作檔REWF2讀取數據，按照指定的格式生成報表，並使用SOR160P打印檔定義的格式輸出報表。

### 4. PC匯出（可選）
如果用戶選擇PC匯出功能，SOR160C控制程式調用SOR160C2 PC匯出程式，將報表數據匯出到PC，支持多種匯出格式（CSV、TXT、XLS等）。

## 功能特點

### 1. 多種查詢條件
- **交易類型**：支持按出貨、退貨、調撥或全部查詢
- **客戶代碼**：支持按特定客戶或全部客戶查詢
- **客戶群組**：支持按客戶群組查詢
- **商品代碼**：支持按特定商品或全部商品查詢
- **商品群組**：支持按商品群組查詢
- **業務員代碼**：支持按特定業務員或全部業務員查詢
- **日期範圍**：支持按日期範圍查詢

### 2. 多種報表格式
- **按客戶分組**：報表按客戶分組，顯示每個客戶的訂單明細
- **按商品分組**：報表按商品分組，顯示每個商品的訂單明細

### 3. 數據分析功能
- **小計和合計**：報表包含小計和合計資訊，便於數據分析
- **多級分組**：支持多級分組，提供更詳細的數據分析

### 4. PC匯出功能
- **多種匯出格式**：支持CSV、TXT、XLS等多種匯出格式
- **自定義匯出路徑**：允許用戶指定PC上的匯出路徑和文件名

## 使用說明

### 1. 報表生成
1. 啟動SOR160主程式
2. 在查詢條件畫面輸入查詢條件
3. 選擇報表格式（1=按客戶分組，2=按商品分組）
4. 按Enter鍵生成報表
5. 查看生成的報表

### 2. PC匯出
1. 在查詢條件畫面輸入查詢條件
2. 選擇報表格式
3. 選擇PC匯出選項
4. 指定PC匯出路徑、文件名和格式
5. 確認匯出
6. 在PC上查看匯出的文件

## 系統整合
SOR160系列程式與以下系統整合：
1. **客戶管理系統**：使用客戶主檔（PA#HPF）獲取客戶資訊
2. **商品管理系統**：使用商品主檔（PTMAPF）獲取商品資訊
3. **業務員管理系統**：使用業務員主檔（MTMELF）獲取業務員資訊
4. **銷售訂單管理系統**：使用銷售訂單主檔（SOVMPF）和明細檔（SOVDPF）獲取訂單資訊

## 維護歷史
- **初始版本**：96/09/06，由EASON建立
- **Y2K修改**：98.10.21，由MICHELLE進行Y2K修改
- **客戶群組**：99.11.08，增加客戶群組選項
- **商品群組**：00.11.08，增加商品群組選項和大盤商品功能

## 效能考量
1. **查詢優化**：優化查詢條件，提高數據查詢效率
2. **索引使用**：合理使用檔案索引，加快查詢速度
3. **記憶體使用**：合理管理記憶體使用，避免佔用過多系統資源
4. **打印優化**：優化打印格式，減少打印時間
5. **文件傳輸優化**：優化文件傳輸過程，減少傳輸時間

## 安全考量
1. **參數驗證**：驗證輸入參數的有效性，防止非法輸入
2. **數據訪問控制**：確保只處理用戶有權訪問的數據
3. **報表訪問控制**：確保只有授權用戶才能生成報表
4. **數據保護**：確保報表中不包含敏感資訊
5. **打印控制**：控制報表的打印權限

## 未來擴展建議
1. **增加更多報表格式**：支持更多類型的報表格式
2. **增強查詢條件**：提供更多的查詢條件選項
3. **增加圖表功能**：在報表中添加圖表，提高數據可視化效果
4. **增加電子報表格式**：支持生成PDF、HTML等格式的電子報表
5. **增加批處理功能**：支持批量生成報表
6. **增加報表預覽功能**：在生成報表前提供預覽功能
7. **增加自動化功能**：支持定時自動生成報表

## 結論
SOR160系列程式作為西祺企業經營管理資訊系統中的銷售訂單入庫報表程式系列，提供了全面、準確的銷售訂單入庫資訊，幫助用戶有效地查詢、分析和管理銷售訂單數據。該系列程式的設計遵循模塊化和可維護性原則，各個組件之間職責明確，協同工作，為用戶提供了強大的報表生成和數據分析功能。

通過SOR160系列程式，用戶可以方便地查詢銷售訂單數據，生成按客戶或商品分組的報表，進行數據分析，並將報表數據匯出到PC進行進一步處理，極大地提高了工作效率和數據分析能力。 