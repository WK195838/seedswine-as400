# 程式功能規格書

## 1. 程式基本資訊

| 項目 | 內容 |
|------|------|
| 程式編號 | WEB001 |
| 程式名稱 | Web 化系統登入與權限管理模組 |
| 系統分類 | 網路應用基礎架構 |
| 開發語言 | RPG IV / HTML / JavaScript |
| 資料庫   | DB2 for IBM i |
| 執行平台 | AS/400 與網頁前端 |
| 版本     | 1.0 |

## 2. 程式概述

WEB001 是 Web 化系統的基礎模組，主要負責使用者登入認證、權限管理和安全控制。作為整個 Web 化系統的入口點，該程式提供統一的使用者身份驗證機制，實現單點登入功能，並根據使用者權限控制對各功能模組的存取。此模組是所有其他 Web 化模組的前置依賴，確保系統安全性和使用者身份的有效管理。

## 3. 功能需求

### 3.1 基本功能

#### 3.1.1 使用者登入功能
- 提供使用者名稱和密碼登入
- 支援多重身份驗證
- 登入嘗試失敗處理
- 帳號鎖定機制
- 登入活動記錄

#### 3.1.2 使用者權限管理
- 基於角色的權限控制
- 功能模組權限設定
- 資料存取權限設定
- 特殊權限管理
- 臨時權限授予

#### 3.1.3 使用者會話管理
- 會話建立與維護
- 會話超時處理
- 會話安全控制
- 多重會話管理
- 會話活動記錄

#### 3.1.4 密碼管理
- 密碼複雜度要求
- 密碼過期管理
- 密碼重設功能
- 密碼歷史管理
- 安全問題驗證

#### 3.1.5 系統選單管理
- 動態選單生成
- 基於權限的選單顯示
- 選單自定義設定
- 常用功能快速存取
- 選單使用記錄

### 3.2 進階功能

#### 3.2.1 單點登入功能
- 跨模組單點登入
- 身份令牌管理
- 統一登出機制
- 身份驗證狀態同步
- 外部系統整合

#### 3.2.2 安全審計功能
- 使用者活動記錄
- 權限變更審計
- 安全事件記錄
- 審計日誌查詢
- 安全報表生成

#### 3.2.3 使用者自助服務
- 個人資料管理
- 密碼自助重設
- 安全設定管理
- 登入歷史查詢
- 個人偏好設定

#### 3.2.4 管理員功能
- 使用者帳號管理
- 角色與權限管理
- 系統參數設定
- 安全政策管理
- 系統監控儀表板

## 4. 資料結構

### 4.1 主要檔案

#### 4.1.1 使用者主檔 (WEBUSRF)
| 欄位名稱 | 資料類型 | 長度 | 說明 |
|---------|---------|------|------|
| USER_ID | CHAR | 10 | 使用者代碼 (主鍵) |
| USER_NAME | VARCHAR | 50 | 使用者名稱 |
| PASSWORD | VARCHAR | 100 | 加密密碼 |
| EMAIL | VARCHAR | 100 | 電子郵件 |
| PHONE | VARCHAR | 20 | 電話號碼 |
| DEPARTMENT | CHAR | 10 | 部門代碼 |
| POSITION | CHAR | 10 | 職位代碼 |
| STATUS | CHAR | 1 | 狀態 (A=啟用, D=停用, L=鎖定) |
| LAST_LOGIN_DATE | DATE | - | 最後登入日期 |
| LAST_LOGIN_TIME | TIME | - | 最後登入時間 |
| LAST_LOGIN_IP | VARCHAR | 50 | 最後登入IP |
| PWD_CHANGE_DATE | DATE | - | 密碼變更日期 |
| PWD_EXPIRE_DATE | DATE | - | 密碼到期日期 |
| FAILED_ATTEMPTS | SMALLINT | - | 失敗嘗試次數 |
| LOCK_DATE | DATE | - | 鎖定日期 |
| CREATE_USER | CHAR | 10 | 建立人員 |
| CREATE_DATE | DATE | - | 建立日期 |
| UPDATE_USER | CHAR | 10 | 更新人員 |
| UPDATE_DATE | DATE | - | 更新日期 |

#### 4.1.2 角色主檔 (WEBROLEF)
| 欄位名稱 | 資料類型 | 長度 | 說明 |
|---------|---------|------|------|
| ROLE_ID | CHAR | 10 | 角色代碼 (主鍵) |
| ROLE_NAME | VARCHAR | 50 | 角色名稱 |
| ROLE_DESC | VARCHAR | 200 | 角色描述 |
| STATUS | CHAR | 1 | 狀態 (A=啟用, D=停用) |
| CREATE_USER | CHAR | 10 | 建立人員 |
| CREATE_DATE | DATE | - | 建立日期 |
| UPDATE_USER | CHAR | 10 | 更新人員 |
| UPDATE_DATE | DATE | - | 更新日期 |

#### 4.1.3 使用者角色關聯檔 (WEBUSERF)
| 欄位名稱 | 資料類型 | 長度 | 說明 |
|---------|---------|------|------|
| USER_ID | CHAR | 10 | 使用者代碼 (主鍵) |
| ROLE_ID | CHAR | 10 | 角色代碼 (主鍵) |
| ASSIGN_DATE | DATE | - | 指派日期 |
| EXPIRE_DATE | DATE | - | 到期日期 |
| ASSIGN_USER | CHAR | 10 | 指派人員 |
| STATUS | CHAR | 1 | 狀態 (A=啟用, D=停用) |

#### 4.1.4 功能選單檔 (WEBMENUF)
| 欄位名稱 | 資料類型 | 長度 | 說明 |
|---------|---------|------|------|
| MENU_ID | CHAR | 10 | 選單代碼 (主鍵) |
| PARENT_ID | CHAR | 10 | 父選單代碼 |
| MENU_NAME | VARCHAR | 50 | 選單名稱 |
| MENU_DESC | VARCHAR | 200 | 選單描述 |
| MENU_URL | VARCHAR | 200 | 選單URL |
| MENU_ICON | VARCHAR | 50 | 選單圖示 |
| MENU_ORDER | SMALLINT | - | 顯示順序 |
| PROGRAM_ID | CHAR | 10 | 程式代碼 |
| STATUS | CHAR | 1 | 狀態 (A=啟用, D=停用) |
| CREATE_USER | CHAR | 10 | 建立人員 |
| CREATE_DATE | DATE | - | 建立日期 |
| UPDATE_USER | CHAR | 10 | 更新人員 |
| UPDATE_DATE | DATE | - | 更新日期 |

#### 4.1.5 角色權限檔 (WEBROLAF)
| 欄位名稱 | 資料類型 | 長度 | 說明 |
|---------|---------|------|------|
| ROLE_ID | CHAR | 10 | 角色代碼 (主鍵) |
| MENU_ID | CHAR | 10 | 選單代碼 (主鍵) |
| AUTH_TYPE | CHAR | 1 | 權限類型 (R=讀取, W=寫入, A=全部) |
| ASSIGN_DATE | DATE | - | 指派日期 |
| ASSIGN_USER | CHAR | 10 | 指派人員 |
| STATUS | CHAR | 1 | 狀態 (A=啟用, D=停用) |

#### 4.1.6 使用者會話檔 (WEBSESF)
| 欄位名稱 | 資料類型 | 長度 | 說明 |
|---------|---------|------|------|
| SESSION_ID | CHAR | 32 | 會話ID (主鍵) |
| USER_ID | CHAR | 10 | 使用者代碼 |
| LOGIN_DATE | DATE | - | 登入日期 |
| LOGIN_TIME | TIME | - | 登入時間 |
| EXPIRE_TIME | TIMESTAMP | - | 過期時間 |
| CLIENT_IP | VARCHAR | 50 | 客戶端IP |
| USER_AGENT | VARCHAR | 200 | 使用者代理 |
| LAST_ACCESS_TIME | TIMESTAMP | - | 最後存取時間 |
| STATUS | CHAR | 1 | 狀態 (A=啟用, E=過期, T=終止) |

#### 4.1.7 登入日誌檔 (WEBLOGF)
| 欄位名稱 | 資料類型 | 長度 | 說明 |
|---------|---------|------|------|
| LOG_ID | INTEGER | - | 日誌ID (主鍵) |
| USER_ID | CHAR | 10 | 使用者代碼 |
| LOG_DATE | DATE | - | 日誌日期 |
| LOG_TIME | TIME | - | 日誌時間 |
| LOG_TYPE | CHAR | 2 | 日誌類型 |
| LOG_STATUS | CHAR | 1 | 狀態 (S=成功, F=失敗) |
| CLIENT_IP | VARCHAR | 50 | 客戶端IP |
| USER_AGENT | VARCHAR | 200 | 使用者代理 |
| LOG_MESSAGE | VARCHAR | 500 | 日誌訊息 |

### 4.2 參考檔案

#### 4.2.1 部門主檔 (MDDEPTF)
#### 4.2.2 職位主檔 (MDPOSF)
#### 4.2.3 系統參數檔 (SYSPARAF)
#### 4.2.4 程式主檔 (SYSPROGF)
#### 4.2.5 代碼主檔 (SYSCODEF)

## 5. 處理流程

### 5.1 使用者登入流程
1. 使用者存取系統登入頁面
2. 使用者輸入使用者名稱和密碼
3. 系統驗證使用者名稱和密碼
4. 系統檢查使用者狀態和密碼有效性
5. 系統檢查是否需要多重身份驗證
6. 系統建立使用者會話
7. 系統記錄登入活動
8. 系統導向主頁或指定頁面

### 5.2 權限驗證流程
1. 使用者請求存取特定功能
2. 系統檢查使用者會話有效性
3. 系統檢索使用者角色
4. 系統檢索角色權限
5. 系統驗證使用者是否有權限存取該功能
6. 系統記錄權限驗證結果
7. 系統允許或拒絕存取請求

### 5.3 密碼重設流程
1. 使用者請求重設密碼
2. 系統驗證使用者身份
3. 系統生成密碼重設令牌
4. 系統發送重設連結至使用者電子郵件
5. 使用者點擊重設連結
6. 系統驗證重設令牌有效性
7. 使用者設定新密碼
8. 系統更新密碼並記錄變更

### 5.4 選單生成流程
1. 使用者成功登入系統
2. 系統檢索使用者角色
3. 系統檢索角色權限
4. 系統檢索功能選單
5. 系統根據使用者權限過濾選單項目
6. 系統生成動態選單
7. 系統顯示選單給使用者

## 6. 使用者介面

### 6.1 網頁前端介面

#### 6.1.1 登入頁面
- 使用者名稱輸入欄位
- 密碼輸入欄位
- 記住我選項
- 登入按鈕
- 忘記密碼連結
- 系統公告區域
- 錯誤訊息顯示區域

#### 6.1.2 主頁面
- 頂部導航欄
- 側邊選單
- 使用者資訊區域
- 快速功能區域
- 系統公告區域
- 最近活動區域
- 登出按鈕

#### 6.1.3 密碼重設頁面
- 使用者名稱或電子郵件輸入欄位
- 安全問題驗證區域
- 新密碼輸入欄位
- 確認密碼輸入欄位
- 密碼複雜度指示器
- 提交按鈕
- 返回登入頁面連結

#### 6.1.4 個人設定頁面
- 個人資料顯示與編輯區域
- 密碼變更區域
- 安全設定區域
- 通知設定區域
- 介面偏好設定區域
- 登入歷史顯示區域

### 6.2 管理員介面

#### 6.2.1 使用者管理頁面
- 使用者搜尋功能
- 使用者列表顯示
- 使用者詳細資料顯示
- 使用者新增/編輯/停用功能
- 使用者角色指派功能
- 使用者密碼重設功能
- 使用者活動查詢功能

#### 6.2.2 角色管理頁面
- 角色搜尋功能
- 角色列表顯示
- 角色詳細資料顯示
- 角色新增/編輯/停用功能
- 角色權限設定功能
- 角色使用者查詢功能

#### 6.2.3 選單管理頁面
- 選單結構樹狀顯示
- 選單詳細資料顯示
- 選單新增/編輯/停用功能
- 選單排序功能
- 選單權限設定功能

#### 6.2.4 系統監控頁面
- 活動使用者顯示
- 系統資源使用情況
- 登入失敗記錄
- 安全事件警示
- 系統效能指標
- 審計日誌查詢

## 7. 系統整合

### 7.1 與其他 Web 模組整合
- 提供統一的登入介面
- 提供統一的權限控制機制
- 提供統一的選單管理
- 提供統一的使用者會話管理
- 提供統一的安全審計功能

### 7.2 與 AS/400 系統整合
- 與 AS/400 使用者管理整合
- 與 AS/400 安全機制整合
- 與 AS/400 程式呼叫整合
- 與 AS/400 資料存取整合
- 與 AS/400 作業管理整合

### 7.3 與電子郵件系統整合
- 密碼重設通知
- 帳號鎖定通知
- 安全警示通知
- 系統公告通知
- 登入異常通知

### 7.4 與目錄服務整合
- LDAP 整合
- Active Directory 整合
- 單點登入整合
- 使用者同步機制
- 群組同步機制

## 8. 安全性需求

### 8.1 認證安全
- 密碼複雜度要求
- 密碼加密儲存
- 多重身份驗證
- 登入失敗處理
- 帳號鎖定機制

### 8.2 授權安全
- 最小權限原則
- 角色基礎存取控制
- 功能級權限控制
- 資料級權限控制
- 權限分離機制

### 8.3 會話安全
- 會話超時控制
- 會話劫持防護
- 會話固定防護
- 並發會話控制
- 安全會話管理

### 8.4 資料安全
- 敏感資料加密
- 資料傳輸加密
- 資料存取控制
- 資料完整性保護
- 資料洩露防護

## 9. 效能需求

### 9.1 回應時間
- 登入處理時間不超過 2 秒
- 權限驗證時間不超過 0.5 秒
- 選單生成時間不超過 1 秒
- 頁面載入時間不超過 3 秒
- 密碼重設處理時間不超過 2 秒

### 9.2 處理能力
- 支援同時 200 位使用者在線
- 每分鐘處理 100 次登入請求
- 每秒處理 500 次權限驗證
- 每日處理 10,000 次選單請求
- 系統可用性達 99.9%

### 9.3 擴展性
- 支援水平擴展
- 模組化設計
- 可配置的認證流程
- 彈性的權限模型
- 支援未來功能擴展

## 10. 測試需求

### 10.1 功能測試
- 登入功能測試
- 權限控制測試
- 密碼管理測試
- 選單管理測試
- 使用者管理測試

### 10.2 效能測試
- 登入效能測試
- 權限驗證效能測試
- 選單生成效能測試
- 並發使用者測試
- 長時間運行穩定性測試

### 10.3 安全測試
- 密碼強度測試
- 認證機制測試
- 權限控制測試
- 會話安全測試
- 安全漏洞掃描

### 10.4 整合測試
- 與其他 Web 模組整合測試
- 與 AS/400 系統整合測試
- 與電子郵件系統整合測試
- 與目錄服務整合測試
- 瀏覽器兼容性測試

## 11. 實施計劃

### 11.1 開發階段
1. 需求分析與設計 (2週)
2. 資料庫設計與建置 (1週)
3. 後端程式開發 (3週)
4. 前端介面開發 (2週)
5. 系統整合 (2週)
6. 測試與除錯 (2週)
7. 文件編寫 (1週)

### 11.2 測試階段
1. 單元測試 (1週)
2. 整合測試 (1週)
3. 系統測試 (1週)
4. 使用者接受度測試 (1週)
5. 效能測試 (1週)
6. 安全測試 (1週)

### 11.3 部署階段
1. 環境準備 (1週)
2. 系統部署 (1週)
3. 資料遷移 (1週)
4. 使用者培訓 (1週)
5. 上線準備 (1週)
6. 正式上線 (1天)
7. 上線後支援 (4週)

## 12. 維護計劃

### 12.1 日常維護
- 系統監控與警報
- 使用者帳號管理
- 權限變更處理
- 安全更新與修補
- 問題追蹤與解決

### 12.2 定期維護
- 每週系統備份
- 每月安全審計
- 每季系統效能評估
- 每半年使用者權限審核
- 每年系統全面檢修

### 12.3 問題處理流程
1. 問題報告接收
2. 問題分類與優先級評估
3. 問題分派與處理
4. 解決方案測試與驗證
5. 解決方案部署
6. 問題解決確認與記錄

## 13. 文件需求

### 13.1 技術文件
- 系統架構文件
- 資料庫設計文件
- 程式設計文件
- API 文件
- 測試文件

### 13.2 使用者文件
- 使用者手冊
- 管理員手冊
- 操作指南
- 常見問題解答
- 故障排除指南

### 13.3 培訓文件
- 使用者培訓教材
- 管理員培訓教材
- 操作流程指南
- 系統功能介紹
- 實際操作案例

## 14. 附錄

### 14.1 術語表
- **WEB001**: Web 化系統登入與權限管理模組程式編號
- **Web 化**: 將傳統 AS/400 綠屏介面轉換為網頁介面的過程
- **角色基礎存取控制**: 基於使用者角色分配權限的安全模型
- **單點登入**: 使用者只需登入一次即可存取多個系統的機制
- **會話管理**: 追蹤和維護使用者與系統互動狀態的過程

### 14.2 參考資料
- AS/400 系統技術文件
- RPG IV 程式設計指南
- Web 應用程式開發標準
- 安全認證與授權最佳實踐
- 系統整合設計指南

### 14.3 變更歷史
| 版本 | 日期 | 變更說明 | 變更人 |
|------|------|----------|--------|
| 0.1 | 2023/01/05 | 初稿 | 系統分析師 |
| 0.2 | 2023/01/15 | 新增安全需求 | 安全專家 |
| 0.3 | 2023/01/25 | 修訂整合需求 | 系統架構師 |
| 0.4 | 2023/02/05 | 完善效能需求 | 效能工程師 |
| 1.0 | 2023/02/15 | 正式版本 | 專案經理 |
