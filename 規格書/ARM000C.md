# ARM000C 程序規格說明書

## 1. 基本信息
- **程序ID**: ARM000C
- **程序名稱**: 應收帳款系統主菜單
- **系統歸屬**: 西祺企業管理資訊系統
- **子系統**: 應收帳款管理
- **開發者**: 未知
- **創建日期**: 未知
- **最後更新**: 未知
- **程序類型**: CL程序
- **程序語言**: CL (Control Language)
- **程序位置**: QCLSRC_REPLIB/ARM000C.txt

## 2. 程序概述
ARM000C是西祺企業管理資訊系統中應收帳款模塊的主菜單程序。該程序作為應收帳款系統的入口點，提供了對各種應收帳款功能的訪問，包括客戶資料維護、應收帳款處理、報表生成等功能。程序通過顯示菜單界面，接收用戶選擇，並根據用戶的選擇調用相應的子程序。

## 3. 系統架構
### 3.1 程序架構
ARM000C程序是一個CL程序，主要負責顯示應收帳款系統的主菜單界面，並根據用戶的選擇調用相應的子程序。程序使用了以下文件：
- **ARM000D**: 顯示文件，用於顯示主菜單界面
- **LDA**: 本地數據區，用於存儲用戶信息和日期信息

### 3.2 系統關係圖
```
                    +-------------+
                    |   ARM000C   |
                    | (主菜單程序) |
                    +------+------+
                           |
                           v
          +----------------+----------------+
          |                                 |
+---------v----------+            +---------v----------+
|     S#S01          |            |    子程序調用       |
| (權限檢查程序)      |            | (ARA001-ARA016等)  |
+--------------------+            +--------------------+
```

### 3.3 相關程序
- **ARM000C**: 應收帳款系統主菜單
- **ARM001C**: 應收帳款系統子菜單
- **S#S01**: 權限檢查程序
- **ARA001-ARA016**: 應收帳款基本功能程序
- **ARB001C**: 應收帳款批次處理程序
- **ARI021-ARI029**: 應收帳款查詢報表程序
- **ARR043-ARR090**: 應收帳款報表程序

## 4. 程序流程
### 4.1 主要流程圖
```
+----------------+
|    開始程序    |
+-------+--------+
        |
+-------v--------+
|  變量聲明與初始化 |
+-------+--------+
        |
+-------v--------+
|  從LDA獲取用戶  |
|  信息和日期信息  |
+-------+--------+
        |
+-------v--------+
|  顯示主菜單界面  |
+-------+--------+
        |
+-------v--------+
|  等待用戶輸入   |
+-------+--------+
        |
+-------v--------+
|  處理用戶選擇   |
+-------+--------+
        |
+-------v--------+
|  權限檢查      |
+-------+--------+
        |
+-------v--------+
|  調用相應程序   |
+-------+--------+
        |
+-------v--------+
|  返回主菜單     |
+-------+--------+
```

### 4.2 詳細流程說明
1. **初始化**:
   - 聲明變量（&WDATE, &$USER, &S0101I, &S0102I, &S0101O）
   - 從本地數據區獲取用戶信息和日期信息
   - 設置初始值

2. **主菜單顯示**:
   - 顯示ARM000D顯示文件
   - 等待用戶輸入

3. **選項處理**:
   - 根據用戶選擇的選項（&DOPID）設置要調用的程序名稱
   - 選項01: 調用ARA001（客戶資料維護）
   - 選項02: 調用CKA1D0（支票處理）
   - 選項03: 調用ARA003（應收帳款處理）
   - 選項04: 調用ARA004（應收帳款查詢）
   - 選項05: 調用ARA005（應收帳款報表）
   - 選項07: 調用ARA007（應收帳款分析）
   - 選項08: 調用ARA008（應收帳款調整）
   - 選項10: 調用ARA010C（系統維護）
   - 選項12: 調用ARA013C（應收帳款統計）
   - 選項13: 調用ARA013X（特殊功能）
   - 選項14: 調用ARA014C（應收帳款對帳）
   - 選項15: 調用ARA015C（應收帳款結算）
   - 選項16: 調用ARA016（應收帳款沖銷）
   - 選項17: 調用ARB001C（批次處理）
   - 選項21-29: 調用ARI021-ARI029（各種查詢報表）

4. **程序調用**:
   - 使用S#S01程序進行權限檢查
   - 如果權限檢查通過（&S0101O = 'Y'），則調用相應的程序
   - 如果權限檢查失敗，則返回主菜單

5. **結束處理**:
   - 如果用戶按下F3鍵（&IN03 = '1'），則結束程序
   - 否則返回主菜單繼續處理

## 5. 數據結構
### 5.1 程序變量
| 變量名 | 類型 | 長度 | 說明 |
|--------|------|------|------|
| &WDATE | CHAR | 6 | 工作日期 |
| &$USER | CHAR | 10 | 用戶ID |
| &S0101I | CHAR | 10 | 權限檢查輸入參數1（用戶ID） |
| &S0102I | CHAR | 10 | 權限檢查輸入參數2（程序名） |
| &S0101O | CHAR | 1 | 權限檢查輸出參數（Y/N） |
| &IN03 | - | - | 功能鍵F3標誌 |
| &IN98 | - | - | 錯誤標誌 |
| &DOPID | - | - | 用戶選擇的選項 |

### 5.2 數據文件
根據搜索結果，應收帳款系統使用了以下主要數據文件：

| 文件名 | 說明 | 用途 |
|--------|------|------|
| ARACPF | 應收帳款客戶主檔 | 存儲客戶基本信息和應收帳款餘額 |
| ARADPF | 應收帳款明細檔 | 存儲應收帳款交易明細 |
| ARAFPF | 應收帳款發票檔 | 存儲發票信息 |
| ARAGPF | 應收帳款總帳檔 | 存儲應收帳款總帳信息 |
| ARAKPF | 應收帳款參數檔 | 存儲系統參數 |
| ARACLF01-08 | 應收帳款分類檔 | 存儲不同類型的分類信息 |
| ARADLF01-07 | 應收帳款明細分類檔 | 存儲不同類型的明細分類信息 |
| ARAHLF | 應收帳款歷史檔 | 存儲歷史交易記錄 |
| ARAALF01 | 應收帳款分析檔 | 存儲分析數據 |
| ARAGLF | 應收帳款分組檔 | 存儲分組信息 |

## 6. 界面設計
### 6.1 主菜單界面
ARM000C使用ARM000D顯示文件來顯示主菜單界面。界面包含以下元素：
- 程序標題（ARM000）
- 畫面標識（SCR001）
- 用戶信息顯示
- 日期時間顯示
- 功能選項列表
- 功能鍵說明

### 6.2 功能選項
主菜單提供以下功能選項：
1. 客戶資料維護 (ARA001)
2. 支票處理 (CKA1D0)
3. 應收帳款處理 (ARA003)
4. 應收帳款查詢 (ARA004)
5. 應收帳款報表 (ARA005)
7. 應收帳款分析 (ARA007)
8. 應收帳款調整 (ARA008)
10. 系統維護 (ARA010C)
12. 應收帳款統計 (ARA013C)
13. 特殊功能 (ARA013X)
14. 應收帳款對帳 (ARA014C)
15. 應收帳款結算 (ARA015C)
16. 應收帳款沖銷 (ARA016)
17. 批次處理 (ARB001C)
21-29. 各種查詢報表 (ARI021-ARI029)

### 6.3 功能鍵
- F3: 結束程序
- 其他功能鍵根據具體子程序定義

## 7. 程序代碼分析
### 7.1 主要代碼結構
```
PGM
DCL        VAR(&WDATE) TYPE(*CHAR) LEN(6)
DCL        VAR(&$USER)  TYPE(*CHAR) LEN(10)
DCL        VAR(&S0101I) TYPE(*CHAR) LEN(10)
DCL        VAR(&S0102I) TYPE(*CHAR) LEN(10)
DCL        VAR(&S0101O) TYPE(*CHAR) LEN(1)
DCLF       FILE(*LIBL/ARM000D) RCDFMT(DSPC1)
RTVDTAARA  DTAARA(*LDA (101 10)) RTNVAR(&$USER)
RTVDTAARA  DTAARA(*LDA (119 6)) RTNVAR(&WDATE)
CHGVAR     VAR(&$EGMDY) VALUE(&WDATE)
CHGVAR     VAR(&S0101I) VALUE(&$USER)
START:
SNDRCVF    DEV(*FILE) RCDFMT(DSPC1)
CHGVAR     VAR(&IN98) VALUE('0')
IF         COND(&IN03 *EQ '1') THEN(RETURN)

IF         COND(&DOPID *EQ '01') THEN(DO)
   CHGVAR VAR(&S0102I) VALUE('ARA001')
ENDDO
...
CHKAUT:    CALL       PGM(S#S01) PARM(&S0101I &S0102I &S0101O)
IF         COND(&S0101O = 'Y') THEN(CALL PGM(&S0102I))
GOTO       START
ENDPGM
```

### 7.2 關鍵代碼分析
1. **變量聲明與初始化**:
   - 程序開始時聲明了所需的變量
   - 從本地數據區獲取用戶信息和日期信息

2. **菜單顯示與用戶輸入**:
   - 使用SNDRCVF命令顯示菜單並接收用戶輸入
   - 檢查F3鍵是否被按下，如果是則結束程序

3. **選項處理**:
   - 使用一系列IF語句檢查用戶選擇的選項
   - 根據選項設置要調用的程序名稱

4. **權限檢查與程序調用**:
   - 調用S#S01程序進行權限檢查
   - 如果權限檢查通過，則調用相應的程序
   - 返回主菜單繼續處理

## 8. 安全與權限
### 8.1 權限控制
程序使用S#S01進行權限檢查，確保只有授權用戶才能訪問特定功能。權限檢查的參數包括：
- &S0101I: 用戶ID
- &S0102I: 程序名稱
- &S0101O: 權限檢查結果（Y/N）

### 8.2 用戶驗證
用戶信息從本地數據區獲取，用於權限驗證和操作記錄。系統會記錄用戶的操作，確保系統安全性和可追溯性。

### 8.3 數據安全
應收帳款系統涉及敏感的財務數據，因此實施了嚴格的權限控制和數據保護措施，確保數據的安全性和完整性。

## 9. 錯誤處理
### 9.1 錯誤檢測
程序使用&IN98變量來標記錯誤狀態。在每次菜單顯示前，將&IN98設置為'0'，表示無錯誤。

### 9.2 錯誤處理流程
如果在程序執行過程中發生錯誤，系統會設置相應的錯誤標誌，並顯示錯誤信息。用戶可以根據錯誤信息採取相應的操作。

## 10. 性能考慮
### 10.1 響應時間
ARM000C程序主要是一個菜單程序，其本身的處理邏輯相對簡單，因此響應時間通常很快。主要的性能考慮在於被調用的子程序。

### 10.2 資源使用
程序使用的資源相對較少，主要包括：
- 顯示文件（ARM000D）
- 本地數據區（LDA）
- 少量的變量和邏輯處理

## 11. 維護建議
### 11.1 代碼維護
- 保持代碼結構清晰，避免過度修改
- 在修改前進行充分的測試
- 記錄所有的修改，包括修改原因、修改內容和修改日期

### 11.2 功能擴展
如果需要添加新的功能選項，可以按照以下步驟進行：
1. 在ARM000D顯示文件中添加新的選項
2. 在ARM000C程序中添加相應的IF語句和程序調用
3. 開發新的子程序
4. 在權限系統中添加相應的權限設置

## 12. 測試要點
### 12.1 功能測試
- 測試所有菜單選項是否能正確顯示
- 測試所有功能選項是否能正確調用相應的程序
- 測試權限檢查是否正常工作
- 測試功能鍵（如F3）是否正常工作

### 12.2 安全測試
- 測試未授權用戶是否能訪問受限功能
- 測試權限檢查是否能正確識別用戶權限
- 測試系統是否能正確記錄用戶操作

## 13. 相關文檔
- ARM000D: 應收帳款系統主菜單顯示文件
- S#S01: 權限檢查程序說明
- ARA001-ARA016: 應收帳款基本功能程序說明
- ARB001C: 應收帳款批次處理程序說明
- ARI021-ARI029: 應收帳款查詢報表程序說明

## 14. 版本歷史
| 版本 | 日期 | 修改者 | 修改內容 |
|------|------|--------|----------|
| 1.0 | 未知 | 未知 | 初始版本 |

## 15. 附錄
### 15.1 數據文件結構
#### ARACPF (應收帳款客戶主檔)
主要欄位包括：
- AC01: 客戶代碼
- AC02: 客戶名稱
- AC03: 客戶地址
- AC04: 聯繫人
- AC05: 電話
- AC06: 傳真
- AC07: 信用額度
- AC10: 餘額

#### ARADPF (應收帳款明細檔)
主要欄位包括：
- AD01: 交易編號
- AD02: 客戶代碼
- AD03: 交易日期
- AD05: 交易金額
- AD06: 交易類型
- AD07: 備註
- AD10: 狀態

#### ARAFPF (應收帳款發票檔)
主要欄位包括：
- AF01: 發票編號
- AF02: 客戶代碼
- AF03: 發票日期
- AF04: 發票金額
- AF05: 到期日
- AF06: 狀態

### 15.2 程序調用關係
```
ARM000C
  |
  +-- S#S01 (權限檢查)
  |
  +-- ARA001 (客戶資料維護)
  |
  +-- CKA1D0 (支票處理)
  |
  +-- ARA003 (應收帳款處理)
  |
  +-- ARA004 (應收帳款查詢)
  |
  +-- ARA005 (應收帳款報表)
  |
  +-- ARA007 (應收帳款分析)
  |
  +-- ARA008 (應收帳款調整)
  |
  +-- ARA010C (系統維護)
  |
  +-- ARA013C (應收帳款統計)
  |
  +-- ARA013X (特殊功能)
  |
  +-- ARA014C (應收帳款對帳)
  |
  +-- ARA015C (應收帳款結算)
  |
  +-- ARA016 (應收帳款沖銷)
  |
  +-- ARB001C (批次處理)
  |
  +-- ARI021-ARI029 (各種查詢報表)
```

### 15.3 功能選項詳細說明
1. **客戶資料維護 (ARA001)**:
   - 新增、修改、刪除客戶資料
   - 設置客戶信用額度
   - 查詢客戶資料

2. **支票處理 (CKA1D0)**:
   - 登記收到的支票
   - 處理支票兌現
   - 處理支票退票

3. **應收帳款處理 (ARA003)**:
   - 登記應收帳款
   - 處理應收帳款收款
   - 處理應收帳款調整

4. **應收帳款查詢 (ARA004)**:
   - 查詢客戶應收帳款餘額
   - 查詢應收帳款交易明細
   - 查詢應收帳款發票狀態

5. **應收帳款報表 (ARA005)**:
   - 生成應收帳款餘額報表
   - 生成應收帳款賬齡分析報表
   - 生成應收帳款交易明細報表

7. **應收帳款分析 (ARA007)**:
   - 分析客戶付款行為
   - 分析應收帳款趨勢
   - 生成分析報表

8. **應收帳款調整 (ARA008)**:
   - 處理應收帳款調整
   - 處理壞帳沖銷
   - 處理其他特殊調整

10. **系統維護 (ARA010C)**:
    - 設置系統參數
    - 維護代碼表
    - 系統備份和恢復

12. **應收帳款統計 (ARA013C)**:
    - 生成應收帳款統計報表
    - 分析應收帳款統計數據
    - 生成圖表和趨勢分析

13. **特殊功能 (ARA013X)**:
    - 處理特殊情況
    - 執行特殊操作
    - 解決特殊問題

14. **應收帳款對帳 (ARA014C)**:
    - 生成對帳單
    - 處理對帳差異
    - 確認對帳結果

15. **應收帳款結算 (ARA015C)**:
    - 處理月末結算
    - 生成結算報表
    - 結轉餘額

16. **應收帳款沖銷 (ARA016)**:
    - 處理應收帳款沖銷
    - 處理預收款沖銷
    - 處理其他沖銷

17. **批次處理 (ARB001C)**:
    - 批次處理應收帳款交易
    - 批次生成報表
    - 批次執行其他操作

21-29. **各種查詢報表 (ARI021-ARI029)**:
    - 生成各種專門的查詢報表
    - 提供不同角度的數據分析
    - 滿足不同用戶的需求