# WDS011程序規格書

## 1. 基本信息

| 項目 | 內容 |
|------|------|
| 程序ID | WDS011 |
| 程序名稱 | 印表機資料查詢程序 |
| 所屬系統 | 西祺企業管理資訊系統 |
| 所屬子系統 | 系統工具 |
| 開發者 | A1134 JANE |
| 創建日期 | 81/01/08 (民國81年1月8日) |
| 最後更新 | 未指定 |
| 程序語言 | RPG |
| 程序位置 | QRPGSRC_REPLIB/WDS011.txt |

## 2. 程序概述

WDS011程序是西祺企業管理資訊系統中的一個視窗式查詢工具，主要用於查詢和選擇系統中的印表機資料。該程序以視窗(Window)形式顯示印表機清單，允許用戶瀏覽和選擇所需的印表機，為其他需要指定印表機的程序提供支持。程序採用彈出式視窗界面，提供友好的用戶交互體驗。

## 3. 系統架構

### 3.1 位置關係
WDS011程序位於系統工具模塊中，作為一個共用的印表機選擇工具，被多個其他模塊的程序調用。

### 3.2 調用關係
- **被調用方式**：作為子程序被其他程序通過CALL語句調用
- **調用其他程序**：無
- **相關文件**：
  - P68：印表機主檔
  - WDS011D：程序顯示文件

### 3.3 運行環境
- **操作系統**：IBM AS/400
- **運行庫**：REPLIB
- **所需資源**：P68印表機主檔

## 4. 程序流程

### 4.1 主要流程
1. 初始化程序環境和變數
2. 讀取印表機主檔(P68)數據
3. 以視窗形式顯示印表機清單
4. 處理用戶操作（上下翻頁、選擇）
5. 返回用戶選擇的印表機資料
6. 程序結束

### 4.2 流程圖
```
開始
  ↓
初始化程序環境
  ↓
讀取印表機主檔數據
  ↓
顯示印表機清單視窗
  ↓
處理用戶操作 ←→ 上下翻頁
  ↓
用戶選擇印表機
  ↓
返回選擇結果
  ↓
結束
```

## 5. 參數說明

| 參數名 | 類型 | 長度 | 說明 | 必填 | 預設值 |
|--------|------|------|------|------|--------|
| S011O1 | CHAR | 20 | 輸出參數，返回用戶選擇的印表機資料 | 輸出 | 無 |

## 6. 程序代碼說明

### 6.1 主要變數

| 變數名 | 類型 | 長度 | 說明 |
|--------|------|------|------|
| W01 | 陣列 | 8x1 | 操作碼陣列，用於存儲選擇標記 |
| W02 | 陣列 | 8x27 | 印表機資料陣列，包含印表機編號、名稱和位置 |
| P6801 | DEC | 1,0 | 印表機編號 |
| P6803 | CHAR | 10 | 輸出隊列(OUTQ) |
| P6805 | CHAR | 22 | 印表機位置描述 |
| WI | DEC | 1,0 | 循環計數器 |
| WJ | DEC | 1,0 | 選擇項目索引 |

### 6.2 子程序說明

#### 6.2.1 RTN010 - 初始化
- 清除頂部和底部鍵值變數(P6801T和P6801B)

#### 6.2.2 RTN100 - 讀取下一頁
- 清除顯示陣列
- 讀取印表機主檔數據
- 將數據填充到顯示陣列
- 處理頁面結束標誌

#### 6.2.3 RTN200 - 讀取上一頁
- 清除顯示陣列
- 反向讀取印表機主檔數據
- 將數據填充到顯示陣列
- 處理頁面開始標誌

#### 6.2.4 RTN300 - 處理選擇
- 檢查用戶選擇
- 如有選擇，返回選擇的印表機資料
- 如無選擇，重新讀取數據

#### 6.2.5 RTN810/RTN820 - 保存鍵值
- 保存當前頁面的頂部和底部鍵值，用於分頁導航

## 7. 錯誤處理

### 7.1 程序內部錯誤處理
- 處理文件讀取結束情況(*IN97)
- 處理文件讀取開始情況(*IN98)
- 處理無效選擇

### 7.2 可能的錯誤情況
- 印表機主檔為空
- 用戶未選擇任何印表機就退出

## 8. 安全考慮

### 8.1 訪問控制
- 程序僅提供查詢功能，不涉及數據修改，安全風險較低

### 8.2 數據安全
- 程序僅讀取印表機主檔，不修改系統數據

## 9. 性能考慮

### 9.1 執行效率
- 程序使用鍵值讀取，提高檢索效率
- 分頁顯示減少數據傳輸量

### 9.2 資源消耗
- CPU使用率：低
- 內存使用：低
- I/O操作：僅讀取P68文件

## 10. 測試要點

### 10.1 單元測試
- 測試印表機資料顯示
- 測試分頁功能
- 測試選擇功能
- 測試返回值

### 10.2 集成測試
- 與調用WDS011的程序進行集成測試
- 測試在不同系統環境下的運行情況

## 11. 維護建議

### 11.1 日常維護
- 定期檢查程序是否正常運行
- 監控印表機主檔數據的完整性

### 11.2 功能擴展建議
- 增加搜索功能，方便快速定位特定印表機
- 增加排序功能，按不同條件排序顯示
- 增加更多印表機相關信息的顯示

## 12. 相關文檔

### 12.1 系統文檔
- 西祺企業管理資訊系統技術手冊
- IBM AS/400 RPG編程指南
- 系統印表機管理文檔

### 12.2 技術參考
- AS/400顯示文件設計指南
- 系統印表機配置指南

## 13. 版本歷史

| 版本號 | 更新日期 | 更新內容 | 更新者 |
|--------|----------|----------|--------|
| 1.0 | 81/01/08 | 初始版本 | A1134 JANE |

## 14. 附錄

### 14.1 印表機主檔(P68)結構
| 欄位名 | 類型 | 長度 | 說明 |
|--------|------|------|------|
| P6801 | DEC | 1,0 | 印表機編號 |
| P6802 | CHAR | 10 | 印表機名稱 |
| P6803 | CHAR | 10 | 輸出隊列(OUTQ) |
| P6804 | CHAR | 10 | 印表機管理者 |

### 14.2 顯示文件(WDS011D)界面設計
- 視窗式設計，居中顯示
- 標題：「印表機資料查詢」
- 顯示8行印表機資料
- 每行前有選擇標記(/)
- 功能鍵：F3=退出，ROLLUP=下頁，ROLLDOWN=上頁

### 14.3 調用示例
```
C                     CALL 'WDS011'
C                     PARM           PRINTER  20
```

## 15. 結語

WDS011程序作為西祺企業管理資訊系統中的印表機選擇工具，提供了友好的用戶界面和高效的查詢功能。它被系統中多個模塊的程序廣泛調用，是系統中重要的共用組件。程序設計簡潔有效，採用視窗式界面提升了用戶體驗。建議在未來的系統升級中，考慮擴展其功能，增加更多的查詢和排序選項，以滿足不斷發展的業務需求。