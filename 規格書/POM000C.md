# POM000C 程式規格書

## 1. 基本資訊

- **程式名稱**：POM000C
- **程式類型**：CL程式（控制語言程式）
- **程式庫**：REPLIB
- **功能描述**：生產系統主選單控制程式
- **相關檔案**：POM000D（顯示檔案）
- **系統名稱**：西祺企業管理資訊系統
- **子系統**：生產系統
- **作者**：ROGER CHIEN（從POM000D推斷）
- **建立日期**：80/11/15（從POM000D推斷）

## 2. 程式概述

POM000C是西祺企業管理資訊系統中生產系統的主選單控制程式。此程式負責顯示生產系統的主選單介面，處理使用者的選擇，檢查使用者權限，並呼叫相應的生產功能模組程式。它是生產系統的中央控制點，提供了一個統一的入口點來訪問所有生產相關功能，包括工單的輸入、查詢、修改、刪除等操作。生產系統是製造企業的核心業務系統，負責管理和追蹤生產過程中的各項活動。

## 3. 程式流程

```
開始
  |
  ↓
宣告變數和檔案
  |
  ↓
覆蓋訊息檔
  |
  ↓
從LDA獲取使用者資訊和日期
  |
  ↓
設定使用者ID變數
  |
  ↓
START: 顯示生產系統主選單畫面
  |
  ↓
接收使用者選擇
  |
  ↓
根據選擇設定對應的程式名稱
  |
  ↓
檢查使用者權限 (CHKAUT)
  |
  ↓
呼叫選擇的程式或返回主選單
  |
  ↓
結束
```

## 4. 程式碼分析

### 4.1 變數宣告

```
DCL VAR(&WDATE) TYPE(*CHAR) LEN(6)
DCL VAR(&$USER) TYPE(*CHAR) LEN(10)
DCL VAR(&S0101I) TYPE(*CHAR) LEN(10)
DCL VAR(&S0102I) TYPE(*CHAR) LEN(10)
DCL VAR(&S0101O) TYPE(*CHAR) LEN(1)
DCLF FILE(*LIBL/POM000D) RCDFMT(DSPC1)
```
- 宣告日期變數&WDATE，長度為6字元，用於儲存系統日期（格式為YYMMDD）
- 宣告使用者ID變數&$USER，長度為10字元，用於儲存當前使用者ID
- 宣告程式參數變數&S0101I（使用者ID）、&S0102I（目標程式）和&S0101O（權限結果），用於權限檢查和程式呼叫
- 宣告POM000D顯示檔案，使用DSPC1記錄格式顯示主選單

### 4.2 系統初始化

```
OVRMSGF MSGF(QCPFMSG) TOMSGF(PTFLIB/PTMF)
RTVDTAARA DTAARA(*LDA (101 10)) RTNVAR(&$USER)
RTVDTAARA DTAARA(*LDA (119 6)) RTNVAR(&WDATE)
CHGVAR VAR(&$EGMDY) VALUE(&WDATE)
CHGVAR VAR(&S0101I) VALUE(&$USER)
```
- 覆蓋系統訊息檔QCPFMSG為自定義訊息檔PTFLIB/PTMF，提供本地化訊息
- 從本地資料區(LDA)位置101-110獲取使用者ID，儲存到&$USER
- 從本地資料區(LDA)位置119-124獲取系統日期，儲存到&WDATE
- 將日期值設定到顯示變數$EGMDY，用於在主選單上顯示
- 將使用者ID設定到參數變數S0101I，用於後續權限檢查

### 4.3 主選單顯示與處理

```
START:
SNDRCVF DEV(*FILE) RCDFMT(DSPC1)
CHGVAR VAR(&IN98) VALUE('0')
```
- 顯示生產系統主選單畫面並接收使用者輸入
- 使用DSPC1記錄格式，這是在POM000D中定義的主選單格式
- 重設錯誤指示器IN98為'0'，清除之前可能的錯誤狀態

### 4.4 選項處理

```
IF COND(&DOPID *EQ '01') THEN(DO)
   CHGVAR VAR(&S0102I) VALUE('POA001C')
ENDDO
...
IF COND(&DOPID *EQ '90') THEN(RETURN)
IF COND(&DOPID *EQ '  ') THEN(GOTO START)
```
- 根據使用者選擇的選項(DOPID)設定對應的程式名稱到&S0102I
- 系統包含15個生產相關功能，從POA001C到POA015C
- 如果選擇'90'，則返回上層選單（RETURN命令）
- 如果未選擇任何選項（空白），則重新顯示主選單（GOTO START）
- 所有程式名稱遵循命名規則：POA + 序號 + C（如POA001C）

### 4.5 權限檢查與程式呼叫

```
CHKAUT: CALL PGM(S#S01) PARM(&S0101I &S0102I &S0101O)
IF COND(&S0101O = 'Y') THEN(CALL PGM(&S0102I))
```
- 呼叫S#S01程式檢查使用者權限，傳入使用者ID(&S0101I)和目標程式(&S0102I)
- S#S01返回權限檢查結果到&S0101O，'Y'表示有權限
- 如果有權限(&S0101O = 'Y')，則呼叫選擇的程式(&S0102I)
- 如果無權限，程式會設定錯誤指示器（程式碼未完全顯示）

## 5. 功能模組對應表

根據POM000D顯示檔案的內容，以下是主要功能模組的對應表：

| 選項 | 程式名稱 | 功能描述 |
|------|----------|----------|
| 01 | POA001C | 工單輸入 |
| 02 | POA002C | 工單查詢 |
| 03 | POA003C | 工單處理 |
| 04 | POA004C | 工單處理 |
| 05 | POA005C | 工單處理 |
| 06 | POA006C | 工單處理 |
| 07 | POA007C | 工單處理 |
| 08 | POA008C | 工單處理 |
| 09 | POA009C | 工單刪除 |
| 10 | POA010C | 工單修改 |
| 11 | POA011C | 工單處理 |
| 12 | POA012C | 工單處理 |
| 13 | POA013C | 工單處理 |
| 14 | POA014C | 工單處理 |
| 15 | POA015C | 工單處理 |
| 90 | (RETURN) | 返回上層選單 |

## 6. 相關檔案分析

### 6.1 POM000D（生產系統主選單顯示檔案）

- **功能**：定義生產系統主選單的顯示格式
- **主要記錄格式**：DSPC1
- **主要欄位**：
  - $EGMDY：顯示日期，格式為YY/MM/DD
  - $USER：顯示使用者ID
  - DOPID：使用者選擇的選項，長度為2字元
  - ERR1：錯誤訊息欄位（由指示器98控制）

- **畫面布局**：
  - 顯示程式ID、系統標題、日期、時間和使用者資訊
  - 列出所有可用的生產功能選項，包括：
    - 工單的輸入、查詢、修改、刪除
    - 各種工單處理功能
  - 提供功能選擇輸入欄位
  - 底部顯示錯誤訊息區域

### 6.2 其他相關程式

- **S#S01**：使用者權限檢查程式，檢查使用者是否有權限執行特定功能
- **POA001C-POA015C**：各種生產功能模組程式，處理具體的生產業務邏輯
- **REM000C**：系統主選單程式，呼叫POM000C進入生產系統

## 7. 程式特點

1. **模組化設計**：將不同生產功能分離為獨立的模組程式（POA001C-POA015C）
2. **權限控制**：通過S#S01程式檢查使用者權限，確保生產資料安全性
3. **使用者友好**：提供清晰的選單介面，方便使用者導航
4. **標準化結構**：遵循系統中其他選單程式的標準結構和命名規範
5. **完整功能**：提供豐富的生產相關功能，滿足企業生產管理需求

## 8. 系統架構關係

POM000C在整個系統架構中的位置：

```
REM000C (系統主選單)
   |
   ↓
POM000C (生產系統主選單) ←→ POM000D (顯示檔案)
   |
   ↓
生產功能模組 (POA001C-POA015C)
```

## 9. 資料流分析

1. **輸入資料**：
   - 使用者選擇的選項(DOPID)
   - 本地資料區(LDA)中的使用者ID和日期

2. **處理邏輯**：
   - 根據選項確定要呼叫的程式
   - 檢查使用者權限
   - 呼叫相應的生產功能模組程式

3. **輸出資料**：
   - 生產系統主選單顯示
   - 錯誤訊息（如果有）
   - 生產功能模組程式的呼叫

## 10. 生產系統的重要性

生產系統在製造企業中扮演著核心角色：

1. **生產計劃**：管理和追蹤生產計劃的執行
2. **資源分配**：協助分配和管理生產資源
3. **進度追蹤**：監控生產進度和工單狀態
4. **品質控制**：支援生產過程中的品質控制活動
5. **成本控制**：協助追蹤和控制生產成本

## 11. 注意事項

1. 程式是生產系統的核心控制程式，修改時需謹慎
2. 程式依賴多個外部程式和檔案，如POM000D、S#S01等
3. 系統使用LDA（本地資料區）儲存使用者資訊和日期
4. 生產系統與其他系統（如庫存、採購等）緊密相連，變更可能影響其他模組

## 12. 建議與改進

1. 可考慮使用子程式結構或WHEN-CASE結構來簡化選項處理邏輯
2. 可增加更詳細的錯誤處理和日誌記錄
3. 可考慮增加生產進度報表和分析功能
4. 可考慮與庫存系統和採購系統的更緊密整合
5. 可考慮增加批次處理功能，支援大量工單的處理

---

此規格書基於POM000C.txt和POM000D.txt的分析。POM000C作為西祺企業管理資訊系統中生產系統的主選單控制程式，提供了一個統一的入口點來訪問所有生產相關功能。它與系統的其他模組（如採購、銷售、庫存等）共同構成了一個完整的企業資源規劃(ERP)系統，而生產管理則是製造企業ERP系統的核心組成部分。