# PA#A110 供應商資料維護程式規格說明書

## 1. 基本資訊

- **程式名稱**：PA#A110
- **程式類型**：RPG程式
- **程式庫**：REPLIB
- **功能描述**：供應商資料維護程式
- **相關檔案**：
  - PA#A110D（顯示檔案）
  - PA#APF（供應商基本資料檔案）
  - PA#FLF（供應商分類檔案）
  - S#SDPF（系統權限檔案）
- **系統名稱**：西祺企業經營管理資訊系統
- **子系統**：基礎資料管理系統
- **作者**：A1034 STEPHANIE
- **建立日期**：79/05/15
- **最後修改日期**：未明確標示
- **程式說明**：提供供應商基本資料的新增、修改、刪除和查詢功能

## 2. 程式概述

PA#A110是西祺企業經營管理資訊系統中基礎資料管理系統的重要組成部分，主要負責供應商基本資料的維護工作。此程式提供完整的供應商資料管理功能，包括新增供應商資料、修改現有供應商資料、刪除不再使用的供應商資料，以及查詢供應商資料等功能。

程式支援多種查詢方式，包括按供應商代碼、供應商名稱、供應商分類等條件進行查詢，方便使用者快速找到所需的供應商資料。同時，程式還提供供應商資料的列印功能，可以產生供應商資料清單報表，供管理人員參考。

PA#A110程式採用模組化設計，主程式負責使用者介面和功能控制，而資料處理則由子程序完成，確保程式結構清晰、易於維護和擴展。程式還實現了嚴格的權限控制，確保只有授權使用者才能執行特定的操作，保障資料的安全性和完整性。

## 3. 程式流程詳解

### 3.1 主要流程圖

```
開始
  |
  ↓
初始化系統環境
  |
  ↓
顯示主畫面
  |
  ↓
接收使用者輸入
  |
  ↓
根據使用者選擇執行相應功能
  |   ↙        ↓        ↘        ↘
新增供應商  修改供應商  刪除供應商  查詢供應商
  |           |           |           |
  ↓           ↓           ↓           ↓
顯示輸入畫面 讀取供應商資料 確認刪除  顯示查詢條件
  |           |           |           |
  ↓           ↓           ↓           ↓
接收資料輸入 顯示修改畫面 執行刪除   執行查詢
  |           |           |           |
  ↓           ↓           ↓           ↓
驗證輸入資料 接收修改輸入 更新畫面   顯示查詢結果
  |           |           |           |
  ↓           ↓           ↓           ↓
寫入資料庫   更新資料庫   返回主畫面  返回主畫面
  |           |           
  ↓           ↓           
返回主畫面   返回主畫面   
```

### 3.2 詳細流程說明

#### 3.2.1 初始化階段

```RPG
FLDS001D  CF  E                    WORKSTN
F                                              KINFDS DSPFDS
FPA#APF   UF  E           K        DISK
FPA#FLF   IF  E           K        DISK
FS#SDPF   IF  E           K        DISK
ILDA        UDS
I                                      101 110 $USER
I                                      119 1240$EGMDY
I                                      162 1620$EVR
```

1. **檔案宣告**：
   - `PA#A110D`：顯示檔案，工作站模式
   - `PA#APF`：供應商基本資料檔案，更新模式
   - `PA#FLF`：供應商分類檔案，輸入模式
   - `S#SDPF`：系統權限檔案，輸入模式

2. **變數宣告**：
   - 從LDA獲取使用者ID、日期和執行方式資訊
   - 定義供應商資料相關變數和控制變數

#### 3.2.2 主畫面處理

1. **初始化變數**：
   ```RPG
   C                     EXSR RTN010
   ```
   - 初始化控制變數
   - 設定預設值

2. **顯示主畫面**：
   ```RPG
   C                     EXSR RTN020
   ```
   - 顯示供應商資料維護主畫面
   - 處理使用者輸入

3. **功能選擇處理**：
   ```RPG
   C           DOPT      IFEQ '1'
   C                     EXSR RTN100
   C                     ELSE
   C           DOPT      IFEQ '2'
   C                     EXSR RTN200
   C                     ELSE
   C           DOPT      IFEQ '3'
   C                     EXSR RTN300
   C                     ELSE
   C           DOPT      IFEQ '4'
   C                     EXSR RTN400
   C                     ENDIF
   C                     ENDIF
   C                     ENDIF
   C                     ENDIF
   ```
   - `1`：新增供應商資料
   - `2`：修改供應商資料
   - `3`：刪除供應商資料
   - `4`：查詢供應商資料

#### 3.2.3 新增供應商資料處理

1. **權限檢查**：
   ```RPG
   C           RTN100    BEGSR
   C                     CALL 'S#S01'
   C                     PARM           $USER
   C                     PARM           'PA#A110'
   C                     PARM           AUTH
   C                     IF        AUTH = 'N' OR $ADD = 'N'
   C                     EXSR NOAUTH
   C                     RETURN
   C                     ENDIF
   ```
   - 呼叫S#S01檢查使用者權限
   - 如果無權限，顯示錯誤訊息並返回

2. **顯示輸入畫面**：
   ```RPG
   C                     EXSR RTN110
   ```
   - 顯示供應商資料輸入畫面
   - 初始化輸入欄位

3. **接收資料輸入**：
   ```RPG
   C                     EXSR RTN120
   ```
   - 接收使用者輸入的供應商資料
   - 處理功能鍵

4. **驗證輸入資料**：
   ```RPG
   C                     EXSR RTN130
   ```
   - 檢查供應商代碼是否已存在
   - 檢查必填欄位是否已填寫
   - 檢查資料格式是否正確

5. **寫入資料庫**：
   ```RPG
   C                     EXSR RTN140
   ```
   - 將供應商資料寫入PA#APF檔案
   - 記錄操作日誌

#### 3.2.4 修改供應商資料處理

1. **權限檢查**：
   ```RPG
   C           RTN200    BEGSR
   C                     CALL 'S#S01'
   C                     PARM           $USER
   C                     PARM           'PA#A110'
   C                     PARM           AUTH
   C                     IF        AUTH = 'N' OR $UPD = 'N'
   C                     EXSR NOAUTH
   C                     RETURN
   C                     ENDIF
   ```
   - 呼叫S#S01檢查使用者權限
   - 如果無權限，顯示錯誤訊息並返回

2. **讀取供應商資料**：
   ```RPG
   C                     EXSR RTN210
   ```
   - 根據供應商代碼讀取PA#APF檔案
   - 如果找不到資料，顯示錯誤訊息

3. **顯示修改畫面**：
   ```RPG
   C                     EXSR RTN220
   ```
   - 顯示供應商資料修改畫面
   - 顯示現有供應商資料

4. **接收修改輸入**：
   ```RPG
   C                     EXSR RTN230
   ```
   - 接收使用者修改的供應商資料
   - 處理功能鍵

5. **更新資料庫**：
   ```RPG
   C                     EXSR RTN240
   ```
   - 將修改後的供應商資料更新到PA#APF檔案
   - 記錄操作日誌

#### 3.2.5 刪除供應商資料處理

1. **權限檢查**：
   ```RPG
   C           RTN300    BEGSR
   C                     CALL 'S#S01'
   C                     PARM           $USER
   C                     PARM           'PA#A110'
   C                     PARM           AUTH
   C                     IF        AUTH = 'N' OR $DLT = 'N'
   C                     EXSR NOAUTH
   C                     RETURN
   C                     ENDIF
   ```
   - 呼叫S#S01檢查使用者權限
   - 如果無權限，顯示錯誤訊息並返回

2. **讀取供應商資料**：
   ```RPG
   C                     EXSR RTN310
   ```
   - 根據供應商代碼讀取PA#APF檔案
   - 如果找不到資料，顯示錯誤訊息

3. **確認刪除**：
   ```RPG
   C                     EXSR RTN320
   ```
   - 顯示確認刪除畫面
   - 接收使用者確認

4. **執行刪除**：
   ```RPG
   C                     EXSR RTN330
   ```
   - 從PA#APF檔案中刪除供應商資料
   - 記錄操作日誌

#### 3.2.6 查詢供應商資料處理

1. **權限檢查**：
   ```RPG
   C           RTN400    BEGSR
   C                     CALL 'S#S01'
   C                     PARM           $USER
   C                     PARM           'PA#A110'
   C                     PARM           AUTH
   C                     IF        AUTH = 'N' OR $INQ = 'N'
   C                     EXSR NOAUTH
   C                     RETURN
   C                     ENDIF
   ```
   - 呼叫S#S01檢查使用者權限
   - 如果無權限，顯示錯誤訊息並返回

2. **顯示查詢條件**：
   ```RPG
   C                     EXSR RTN410
   ```
   - 顯示供應商資料查詢條件畫面
   - 接收使用者輸入的查詢條件

3. **執行查詢**：
   ```RPG
   C                     EXSR RTN420
   ```
   - 根據查詢條件從PA#APF檔案中讀取供應商資料
   - 如果找不到資料，顯示提示訊息

4. **顯示查詢結果**：
   ```RPG
   C                     EXSR RTN430
   ```
   - 顯示查詢結果畫面
   - 支援分頁顯示

#### 3.2.7 功能鍵處理

```RPG
C                     IF        *IN03 = *ON
C                     MOVE *ON       *INLR
C                     ENDIF
C                     IF        *IN04 = *ON
C                     EXSR F4HELP
C                     ENDIF
C                     IF        *IN05 = *ON
C                     EXSR REFRESH
C                     ENDIF
```
- F3：結束程式
- F4：顯示代碼查詢視窗
- F5：重新整理畫面
