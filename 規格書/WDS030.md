# WDS030 視窗介面程式規格說明書

## 1. 基本資訊

- **程式名稱**：WDS030
- **程式類型**：RPG程式
- **程式庫**：REPLIB
- **功能說明**：視窗介面程式 - 業務員查詢視窗
- **相關檔案**：
  - WDS030D（顯示檔案）
  - MTMCPF（業務員主檔）
  - MTMDPF（部門主檔）
- **系統名稱**：西祺企業經營管理資訊系統
- **子系統**：基礎資料管理模組
- **作者**：A1546 VINCENT HO
- **建立日期**：97/10/05
- **最後修改日期**：100/03/10（A1492 TERRY）
- **功能說明**：本程式提供業務員查詢視窗功能，允許使用者根據不同條件查詢業務員資料，並將選擇的業務員資料返回給呼叫程式。

## 2. 程式概述

WDS030是西祺企業經營管理資訊系統中的視窗介面程式，專門用於提供業務員查詢功能。此程式通常被其他程式（如銷售訂單輸入、客戶資料維護等）呼叫，以便使用者可以方便地查詢和選擇業務員。

程式提供了靈活的查詢條件設定，包括業務員代碼、業務員姓名、部門代碼等。使用者可以輸入完整或部分的查詢條件，程式會顯示符合條件的業務員列表。使用者可以從列表中選擇所需的業務員，程式會將選擇的業務員資料返回給呼叫程式。

## 3. 程式流程詳細說明

### 3.1 主要流程圖

```
開始
  |
  v
初始化系統環境
  |
  v
接收呼叫程式傳入的參數
  |
  v
顯示查詢條件畫面
  |
  v
接收使用者輸入
  |
  v
< 使用者是否按F3? > --是--> 返回呼叫程式（無選擇）
  |
  否
  |
  v
< 使用者是否按F4? > --是--> 顯示部門查詢視窗
  |                         |
  否                        v
  |                     接收部門選擇
  v                         |
< 使用者是否按Enter? > --是--> 執行查詢
  |                             |
  否                            v
  v                         顯示查詢結果列表
檢查輸入資料                     |
  |                         v
  v                     < 使用者是否選擇業務員? > --是--> 返回呼叫程式（有選擇）
< 資料是否有效? > --否--> 顯示錯誤訊息
  |                         |
  是                        v
  |                     返回查詢條件畫面
  v
執行查詢
  |
  v
顯示查詢結果列表
  |
  v
結束
```

### 3.2 初始化階段

程式開始時進行以下初始化操作：

```RPG
C           *ENTRY    PLIST
C                     PARM           MTNO     30
C                     PARM           MTNM     300
C                     PARM           MTDP     20
C                     PARM           MTTP     10
C                     PARM           MTST     1
C           *IN03     PARM *IN03     IN03     1
C           *IN98     PARM *IN98     IN98     1
C           *IN97     PARM *IN97     IN97     1
C  N97N98             EXSR RTN010                     *INIT ENVIRM
```

- 宣告參數列表，包括返回值參數（業務員代碼、業務員姓名、部門代碼、業務員類型、業務員狀態）和功能鍵標誌
- 從本地資料區域(LDA)獲取使用者ID、日期等資訊
- 初始化查詢條件畫面的預設值

### 3.3 查詢條件處理

程式顯示查詢條件畫面，並處理使用者的選擇：

```RPG
C           *IN03     DOUEQ'1'
C           *IN99     OREQ '0'
C                     EXFMTDSPD1
C                     MOVEA*ALL'0'   *IN,60
C           *IN03     IFEQ '0'
C           *IN04     IFEQ '1'
C                     EXSR RTNF4
C                     ELSE
C           *IN05     IFEQ '1'
C                     EXSR RTN100
C                     END
C                     END
C                     END
C                     END
```

- 顯示查詢條件畫面並接收使用者輸入
- 處理功能鍵：F3（返回）、F4（部門查詢）、Enter（執行查詢）
- 檢查輸入資料的有效性

### 3.4 查詢執行

當使用者按下Enter鍵時，程式執行查詢：

```RPG
C           RTN100    BEGSR
C                     MOVELMTNO      WMTNO
C                     MOVELMTNM      WMTNM
C                     MOVELMTDP      WMTDP
C                     SETOF                     9899
C                     EXSR RTN110
C                     ENDSR
```

- 準備查詢條件（業務員代碼、業務員姓名、部門代碼等）
- 清除錯誤訊息標誌
- 執行查詢子程序

### 3.5 查詢結果處理

程式顯示查詢結果列表，並處理使用者的選擇：

```RPG
C           RTN110    BEGSR
C                     SETON                     40
C                     WRITE DSPREC
C                     SETOF                     40
C                     Z-ADD1         WRRN
C                     EXSR RTN120
C                     EXFMTDSPF2
C                     SETOF                     4142
C           *IN03     IFEQ '1'
C                     GOTO ENDSR1
C                     END
C           *IN41     IFEQ '1'
C                     EXSR RTN130
C                     END
C           *IN42     IFEQ '1'
C                     EXSR RTN140
C                     END
C                     GOTO ENDSR1
```

- 顯示查詢結果列表
- 處理使用者選擇：F3（返回）、Enter（選擇業務員）
- 如果使用者選擇業務員，程式將選擇的業務員資料返回給呼叫程式

### 3.6 返回呼叫程式

當使用者選擇業務員或按F3鍵時，程式返回呼叫程式：

```RPG
C           RTN200    BEGSR
C                     MOVELWMTNO     MTNO
C                     MOVELWMTNM     MTNM
C                     MOVELWMTDP     MTDP
C                     MOVELWMTTP     MTTP
C                     MOVELWMTST     MTST
C                     SETON                     03
C                     ENDSR
```

- 如果使用者選擇業務員，程式將選擇的業務員資料（業務員代碼、業務員姓名、部門代碼、業務員類型、業務員狀態）返回給呼叫程式
- 如果使用者按F3鍵，程式不返回任何資料
- 設置返回標誌，結束程式

## 4. 畫面說明

### 4.1 查詢條件畫面 (SCR001)

查詢條件畫面允許使用者設定業務員查詢的條件：

- **業務員代碼**：可輸入完整或部分的業務員代碼
- **業務員姓名**：可輸入完整或部分的業務員姓名
- **部門代碼**：可輸入部門代碼（可使用F4鍵查詢）

**功能鍵**：
- F3：返回呼叫程式（無選擇）
- F4：部門查詢
- Enter：執行查詢

### 4.2 查詢結果列表畫面 (SCR002)

查詢結果列表畫面顯示符合查詢條件的業務員列表：

- **序號**：業務員在列表中的序號
- **業務員代碼**：業務員的代碼
- **業務員姓名**：業務員的姓名
- **部門代碼**：業務員所屬的部門代碼
- **部門名稱**：業務員所屬的部門名稱
- **業務員類型**：業務員的類型（如正式、約聘等）
- **業務員狀態**：業務員的狀態（如在職、離職等）

使用者可以通過輸入序號或將游標移動到所需業務員行並按Enter鍵來選擇業務員。

**功能鍵**：
- F3：返回查詢條件畫面
- Enter：選擇業務員

## 5. 資料檔案說明

本程式主要使用以下檔案：

- **WDS030D**：顯示檔案，用於顯示查詢條件畫面和查詢結果列表畫面
- **MTMCPF**：業務員主檔，存儲業務員的基本資訊
- **MTMDPF**：部門主檔，存儲部門資訊
- **LDA（本地資料區域）**：存儲使用者ID、日期等系統環境資訊

## 6. 程式邏輯

### 6.1 查詢條件處理邏輯

1. 程式初始化時，設定查詢條件的預設值
2. 顯示查詢條件畫面，等待使用者輸入
3. 使用者輸入查詢條件後，程式檢查條件的有效性
4. 如果條件有效，程式準備執行查詢

### 6.2 業務員代碼查詢邏輯

1. 程式接收使用者輸入的業務員代碼（可以是完整或部分代碼）
2. 如果輸入的是完整代碼，程式使用等於條件查詢
3. 如果輸入的是部分代碼，程式使用開頭為條件查詢
4. 程式從業務員主檔（MTMCPF）中查詢符合條件的業務員

### 6.3 業務員姓名查詢邏輯

1. 程式接收使用者輸入的業務員姓名（可以是完整或部分姓名）
2. 如果輸入的是完整姓名，程式使用等於條件查詢
3. 如果輸入的是部分姓名，程式使用包含條件查詢
4. 程式從業務員主檔（MTMCPF）中查詢符合條件的業務員

### 6.4 部門代碼查詢邏輯

1. 程式接收使用者輸入的部門代碼
2. 如果使用者按F4鍵，程式顯示部門查詢視窗
3. 使用者從部門查詢視窗中選擇部門
4. 程式使用選擇的部門代碼作為查詢條件

### 6.5 查詢結果處理邏輯

1. 程式執行查詢，從業務員主檔（MTMCPF）中獲取符合條件的業務員資料
2. 程式將查詢結果顯示在查詢結果列表畫面上
3. 使用者可以從列表中選擇所需的業務員
4. 程式將選擇的業務員資料返回給呼叫程式

## 7. 錯誤處理

程式處理以下錯誤情況：

1. **無效查詢條件**：如果使用者輸入的查詢條件無效，程式顯示錯誤訊息
2. **查詢結果為空**：如果查詢結果為空，程式顯示"無符合條件的業務員"訊息
3. **無效選擇**：如果使用者在查詢結果列表中輸入無效的序號，程式顯示錯誤訊息

## 8. 維護歷史

| 日期 | 作者 | 修改內容 |
|------|------|----------|
| 97/10/05 | A1546 VINCENT HO | 程式初版建立 |
| 100/03/10 | A1492 TERRY | 程式更新，增加部門查詢功能 |

## 9. 系統整合

WDS030程式與以下系統或模組整合：

1. **銷售訂單管理模組**：被銷售訂單輸入程式呼叫，提供業務員查詢功能
2. **客戶管理模組**：被客戶資料維護程式呼叫，提供業務員查詢功能
3. **業務員管理模組**：被業務員資料維護程式呼叫，提供業務員查詢功能
4. **報表模組**：被各種報表程式呼叫，提供業務員查詢功能

## 10. 使用說明

### 10.1 呼叫程式

其他程式可以通過以下方式呼叫WDS030程式：

```RPG
C                     CALL 'WDS030'
C                     PARM           MTNO     30
C                     PARM           MTNM     300
C                     PARM           MTDP     20
C                     PARM           MTTP     10
C                     PARM           MTST     1
C                     PARM           IN03     1
```

- 呼叫程式需要提供參數列表，包括返回值參數（業務員代碼、業務員姓名、部門代碼、業務員類型、業務員狀態）和功能鍵標誌
- 呼叫程式可以在呼叫前設置部分參數的初始值，如部門代碼，以便限制查詢範圍

### 10.2 查詢業務員

1. 在查詢條件畫面上，輸入查詢條件（業務員代碼、業務員姓名、部門代碼等）
2. 按Enter鍵執行查詢
3. 系統顯示符合條件的業務員列表
4. 從列表中選擇所需的業務員（輸入序號或將游標移動到所需業務員行並按Enter鍵）
5. 系統返回選擇的業務員資料給呼叫程式

### 10.3 使用部門查詢

1. 在查詢條件畫面上，將游標移動到部門代碼欄位
2. 按F4鍵顯示部門查詢視窗
3. 從部門查詢視窗中選擇所需的部門
4. 系統將選擇的部門代碼填入查詢條件畫面
5. 按Enter鍵執行查詢

### 10.4 退出程式

1. 在查詢條件畫面或查詢結果列表畫面上，按F3鍵
2. 系統返回呼叫程式（無選擇）

## 11. 效能考量

1. **查詢效率**：程式使用索引欄位（如業務員代碼、業務員姓名）進行查詢，以提高查詢效率
2. **記憶體使用**：程式使用分頁顯示查詢結果，以減少記憶體使用
3. **響應時間**：程式優化查詢邏輯，以減少響應時間

## 12. 安全考量

1. **權限控制**：程式通過系統權限控制機制，確保只有授權使用者才能執行
2. **資料保護**：程式只顯示使用者有權限查看的業務員資料
3. **審計追蹤**：系統記錄業務員查詢的相關資訊，以便進行審計追蹤

## 13. 未來擴展建議

1. **查詢條件擴展**：可以增加更多的查詢條件，如業務員類型、業務員狀態等
2. **查詢結果排序**：可以增加查詢結果的排序功能，如按業務員代碼、業務員姓名排序等
3. **多重選擇**：可以增加多重選擇功能，允許使用者一次選擇多個業務員
4. **查詢結果匯出**：可以增加查詢結果匯出功能，如匯出到Excel等

## 14. 結論

WDS030程式作為視窗介面程式，提供了強大的業務員查詢功能。程式設計靈活，允許使用者根據不同的條件查詢業務員，並將選擇的業務員資料返回給呼叫程式。通過與其他模組的良好整合，程式成為西祺企業經營管理資訊系統中不可或缺的一部分，為使用者提供了便捷的業務員查詢體驗。 