# MTA001 程式規格說明文件

## 一、基本資訊

- **程式ID**：MTA001
- **程式名稱**：物料基本資料維護程式
- **系統歸屬**：西祺企業管理資訊系統 - 物料管理模組
- **開發者**：A1034 STEPHANIE
- **建立日期**：1981.01.13
- **最後更新**：2016.05.23 (修正BUG)

## 二、程式概述

MTA001是西祺企業管理資訊系統中物料管理模組的核心程式，負責物料基本資料的建立、查詢、修改和刪除。該程式提供完整的物料資料管理功能，包括物料代碼、名稱、規格、單位、成本、供應商等資訊的維護，是物料管理流程的基礎支援程式。程式經過多次更新，增加了條碼管理、物料分類、庫存管理等功能，以滿足企業日益增長的物料管理需求。

## 三、系統架構

MTA001程式在系統中的位置處於物料管理模組的基礎資料維護環節，與其他物料相關程式有密切的關聯。程式架構如下：

1. **主程式**：MTA001 - 負責物料資料維護的主要邏輯
2. **顯示檔案**：MTA001D - 提供使用者介面
3. **資料檔案**：
   - MTMAPF - 物料主檔案
   - MTMALF - 物料分類檔案
   - MTMHLF - 物料歷史檔案
   - MTMIPF - 物料索引檔案
   - MTMCPF - 物料成本檔案
   - MTMBLF - 代碼檔案

## 四、程式流程

1. **初始化階段**：
   - 從LDA(本地資料區)獲取使用者資訊和系統日期
   - 設定初始參數和環境變數

2. **主選單階段**：
   - 顯示物料資料清單
   - 提供功能選項（新增、修改、刪除、查詢）
   - 處理使用者功能鍵（F3退出、F6新增、翻頁等）

3. **資料維護階段**：
   - 新增：建立新物料資料記錄
   - 修改：更新現有物料資料
   - 刪除：移除物料資料
   - 查詢：顯示物料詳細資訊

4. **資料驗證階段**：
   - 檢查必填欄位
   - 驗證資料格式和有效性
   - 確認物料代碼唯一性
   - 檢查物料分類有效性

5. **關聯資料處理**：
   - 更新物料成本資訊
   - 記錄物料歷史變更
   - 處理物料與供應商關聯

## 五、介面設計

MTA001D顯示檔案是程式的主要使用者介面，包含以下元素：

1. **清單畫面(SFLSR/SFLCR)**：
   - 顯示物料代碼(MA01)
   - 物料名稱(MA03)
   - 物料規格(MA06)
   - 單位(MA12)
   - 標準成本(MA15)
   - 狀態(MA54)
   - 選項欄位(DOPT1)

2. **明細畫面**：
   - 物料基本資料（代碼、名稱、規格等）
   - 物料分類資訊
   - 成本與庫存資訊
   - 供應商資訊
   - 條碼資訊

3. **功能鍵**：
   - F3：退出程式
   - F6：新增資料
   - 翻頁：瀏覽更多記錄

## 六、資料處理

程式對物料相關檔案進行的主要操作包括：

1. **讀取操作**：
   - SETLL - 設定檔案位置
   - CHAIN - 直接讀取特定記錄
   - READ - 循序讀取記錄

2. **更新操作**：
   - WRITE - 寫入新記錄
   - UPDATE - 更新現有記錄
   - DELETE - 刪除記錄

3. **資料關聯**：
   - 與MTMALF檔案關聯，獲取物料分類資訊
   - 與PA#APF檔案關聯，處理供應商資訊
   - 與POPALF檔案關聯，處理採購資訊

## 七、檔案使用

程式使用的主要檔案包括：

1. **顯示檔案**：
   - MTA001D - 使用者介面顯示檔案

2. **資料檔案**：
   - MTMAPF - 物料主檔案，包含物料基本資料
   - MTMAPFX - 物料主檔案擴展
   - MTMALF - 物料分類檔案
   - MTMHLF - 物料歷史檔案
   - MTMIPF - 物料索引檔案
   - MTMCPF - 物料成本檔案
   - MTMBLF - 代碼檔案
   - PA#APF - 供應商基本資料檔案
   - POPALF04 - 採購訂單檔案
   - POPCLF01 - 採購合約檔案
   - BRBEPF - 條碼資料檔案 (2001年新增)

3. **欄位定義**：
   - MA01 - 物料代碼
   - MA03 - 物料名稱
   - MA06 - 物料規格
   - MA07 - 物料類別
   - MA12 - 單位
   - MA15 - 標準成本
   - MA54 - 狀態

## 八、安全與權限

1. **使用者驗證**：
   - 程式透過LDA獲取使用者資訊
   - 使用者權限控制透過系統模組管理

2. **資料安全**：
   - 記錄鎖定機制確保多用戶環境下的資料一致性
   - 檔案共享設定確保資料完整性
   - 錯誤處理子程序(ERRSR)處理檔案存取異常

## 九、效能考慮

1. **檔案存取最佳化**：
   - 使用鍵值存取提高查詢效率
   - 適當設定檔案共享參數提高並行效能

2. **畫面處理最佳化**：
   - 使用子檔控制提高畫面顯示效率
   - 分頁顯示減少資料傳輸量

## 十、維護歷史

程式經過多次更新和維護，主要包括：

1. **1998.11.04 (M001)**：
   - Y2K問題修正，調整日期欄位格式

2. **1999.06.02 (M002)**：
   - 複製記錄時重設特定欄位(MA31/MA32/MA33/MA34)

3. **1999.06.02 (M003)**：
   - 增加物料前導碼功能，新增欄位MA35/MA36/MA47

4. **2001.03.20 (M004)**：
   - 增加條碼管理功能，新增條碼欄位

5. **2001.05.25 (M005)**：
   - 新增輸入欄位和功能

6. **2001.07.26 (M006)**：
   - 增加查詢物料時需要輸入物料法定單位(MA07='K')的功能

7. **2001.12.18 (M007)**：
   - 開放庫存管理功能

8. **2016.05.23 (M008)**：
   - 修正程式BUG

## 十一、整合點

1. **上游系統**：
   - 物料管理模組主選單(MTM000)
   - 基礎代碼維護程式

2. **下游系統**：
   - 採購管理模組
   - 庫存管理模組
   - 生產管理模組
   - 銷售管理模組
   - 會計管理模組

## 十二、特殊功能

1. **條碼管理**：
   - 2001年新增功能，支援物料條碼的建立和管理
   - 與BRBEPF檔案整合，提供條碼掃描和識別功能

2. **物料分類管理**：
   - 支援多層次物料分類結構
   - 提供按分類查詢和統計功能

3. **供應商關聯**：
   - 管理物料與供應商的關聯關係
   - 記錄採購價格和交貨週期

4. **成本管理**：
   - 支援標準成本、平均成本、最後成本等多種成本計算方式
   - 提供成本歷史記錄和分析

## 十三、總結

MTA001程式是西祺企業管理資訊系統物料管理模組中的關鍵組件，負責物料基本資料的維護和管理。程式設計合理，提供完整的資料維護功能，能夠滿足企業日常物料管理的需求。透過與其他相關模組的協作，構成了完整的物料管理流程，為企業提供有效的物料管理工具。程式經過多年的更新和維護，不斷增加新功能和改進，以適應企業發展的需求。