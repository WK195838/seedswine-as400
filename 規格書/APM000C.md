# APM000C 應付帳款管理系統主選單程式規格說明書

## 1. 基本資訊

- **程式名稱**：APM000C
- **程式類型**：CL程式
- **程式庫**：SCPLIB
- **功能說明**：應付帳款管理系統主選單程式
- **相關檔案**：
  - APM000D（顯示檔案）
- **系統名稱**：西祺企業經營管理資訊系統
- **子系統**：應付帳款管理模組
- **作者**：A1546 VINCENT HO
- **建立日期**：97/09/16
- **最後修改日期**：100/01/31（A1492 TERRY）
- **功能說明**：本程式為應付帳款管理系統的主選單程式，提供使用者選擇各種應付帳款管理相關功能的介面。

## 2. 程式概述

APM000C是西祺企業經營管理資訊系統中應付帳款管理模組的主選單程式，作為應付帳款管理系統的入口點。此程式提供一個集中的選單介面，讓使用者可以方便地選擇和訪問各種應付帳款管理相關的功能，包括供應商資料維護、應付帳款交易處理、應付帳款查詢和應付帳款報表等。

程式採用模組化設計，主選單顯示各種功能選項，使用者選擇後，程式會檢查使用者權限，然後調用相應的子程式。這種設計使系統具有良好的可維護性和擴展性，便於日後新增或修改功能。

## 3. 程式流程詳細說明

### 3.1 主要流程圖

```
開始
  |
  v
初始化系統環境
  |
  v
顯示主選單畫面
  |
  v
接收使用者選擇
  |
  v
< 使用者是否按F3? > --是--> 返回上層選單
  |
  否
  |
  v
< 使用者是否選擇有效選項? > --否--> 顯示主選單畫面
  |
  是
  |
  v
檢查使用者權限
  |
  v
< 使用者是否有權限? > --否--> 顯示錯誤訊息 --> 顯示主選單畫面
  |
  是
  |
  v
調用相應子程式
  |
  v
返回主選單畫面
  |
  v
結束
```

### 3.2 初始化階段

程式開始時進行以下初始化操作：

```CL
PGM
DCL VAR(&WDATE) TYPE(*CHAR) LEN(6)
DCL VAR(&$USER) TYPE(*CHAR) LEN(10)
DCL VAR(&S0101I) TYPE(*CHAR) LEN(10)
DCL VAR(&S0102I) TYPE(*CHAR) LEN(10)
DCL VAR(&S0101O) TYPE(*CHAR) LEN(1)
DCL VAR(&WUSER) TYPE(*CHAR) LEN(3)
DCLF FILE(*LIBL/APM000D) RCDFMT(DSPC1)
RTVDTAARA DTAARA(*LDA (101 10)) RTNVAR(&$USER)
RTVDTAARA DTAARA(*LDA (119 6)) RTNVAR(&WDATE)
CHGVAR VAR(&$EGMDY) VALUE(&WDATE)
CHGVAR VAR(&S0101I) VALUE(&$USER)
CHGVAR VAR(&WUSER) VALUE(%SST(&$USER 1 3))
```

- 宣告變數：日期、使用者ID、程式名稱等
- 宣告顯示檔案APM000D
- 從本地資料區域(LDA)獲取使用者ID和日期
- 設置畫面顯示的日期和使用者ID

### 3.3 主選單處理

程式顯示主選單畫面，並處理使用者的選擇：

```CL
START:
SNDRCVF DEV(*FILE) RCDFMT(DSPC1)
CHGVAR VAR(&IN98) VALUE('0')
IF COND(&IN03 *EQ '1') THEN(RETURN)
```

- 顯示主選單畫面並接收使用者輸入
- 清除錯誤訊息標誌
- 如果使用者按F3，則返回上層選單

### 3.4 選項處理

根據使用者選擇的選項，設置要調用的子程式：

```CL
IF COND(&DOPID *EQ '01') THEN(DO)
CHGVAR VAR(&S0102I) VALUE('PA#A110')
ENDDO
IF COND(&DOPID *EQ '02') THEN(DO)
CHGVAR VAR(&S0102I) VALUE('APA001')
ENDDO
...
```

程式支持的主要功能選項包括：

1. **基本資料維護**：
   - 01：供應商資料維護（PA#A110）
   - 02：供應商類別維護（APA001）
   - 03：供應商付款條件維護（APA002）
   - 04：供應商銀行資料維護（APA003）

2. **應付帳款交易處理**：
   - 11：應付帳款輸入（APB001）
   - 12：應付帳款批次處理（APB002）
   - 13：應付帳款調整（APB003）
   - 14：應付帳款沖銷（APB004）
   - 15：應付帳款付款（APB005）
   - 16：應付帳款批次付款（APB006）

3. **應付帳款查詢**：
   - 21：供應商資料查詢（API001）
   - 22：應付帳款查詢（API002）
   - 23：應付帳款明細查詢（API003）
   - 24：應付帳款付款查詢（API004）
   - 25：應付帳款統計查詢（API005）

4. **應付帳款報表**：
   - 31：供應商資料報表（APR001）
   - 32：應付帳款報表（APR002）
   - 33：應付帳款明細報表（APR003）
   - 34：應付帳款付款報表（APR004）
   - 35：應付帳款統計報表（APR005）
   - 36：應付帳款帳齡分析報表（APR006）
   - 37：供應商對帳單（APR007）
   - 38：供應商付款通知單（APR008）

5. **系統維護**：
   - 41：應付帳款期末處理（APM001）
   - 42：應付帳款資料備份（APM002）
   - 43：應付帳款資料恢復（APM003）
   - 44：應付帳款系統參數設定（APM004）

### 3.5 權限檢查和程式調用

檢查使用者是否有權限執行所選功能，並調用相應的子程式：

```CL
CHKAUT: +
CALL PGM(S#S01) PARM(&S0101I &S0102I &S0101O)
IF COND(&S0101O = 'Y') THEN(CALL PGM(&S0102I))
ELSE CMD(CHGVAR VAR(&IN98) VALUE('1'))
GOTO CMDLBL(START)
```

- 調用S#S01程式檢查使用者權限
- 如果有權限（S0101O = 'Y'），則調用相應的子程式
- 如果沒有權限，則設置錯誤訊息標誌，並返回主選單畫面

## 4. 畫面說明

### 4.1 主選單畫面 (SCR001)

主選單畫面顯示應付帳款管理系統的所有可用功能，分為五個主要區域：

1. **基本資料維護**：包括供應商資料維護、供應商類別維護等基本資料功能
2. **應付帳款交易處理**：包括應付帳款輸入、批次處理、調整、沖銷、付款等交易功能
3. **應付帳款查詢**：包括供應商資料查詢、應付帳款查詢等查詢功能
4. **應付帳款報表**：包括各種應付帳款報表功能
5. **系統維護**：包括期末處理、資料備份等系統維護功能

畫面頂部顯示系統名稱、日期、時間和使用者ID。底部顯示功能鍵說明和錯誤訊息。

使用者可以通過輸入選項代碼（如"01"、"02"等）來選擇要執行的功能。

**功能鍵**：
- F3：返回上層選單

## 5. 資料檔案說明

本程式主要使用以下檔案：

- **APM000D**：顯示檔案，用於顯示主選單畫面
- **LDA（本地資料區域）**：存儲使用者ID、日期等系統環境資訊

## 6. 程式邏輯

### 6.1 主選單顯示邏輯

1. 程式初始化時，從LDA獲取使用者ID和日期
2. 顯示主選單畫面，等待使用者輸入
3. 使用者輸入選項後，程式檢查選項的有效性
4. 如果選項有效，程式設置要調用的子程式名稱

### 6.2 權限控制邏輯

1. 程式調用S#S01程式檢查使用者是否有權限執行所選功能
2. S#S01程式檢查使用者ID和程式名稱的組合是否在權限檔案中
3. 如果有權限，S#S01返回'Y'，程式調用相應的子程式
4. 如果沒有權限，S#S01返回'N'，程式顯示錯誤訊息

### 6.3 子程式調用邏輯

1. 程式根據使用者選擇的選項，設置要調用的子程式名稱
2. 檢查使用者權限後，程式使用CALL命令調用子程式
3. 子程式執行完成後，控制權返回主選單程式
4. 主選單程式再次顯示主選單畫面，等待使用者的下一個選擇

## 7. 錯誤處理

程式處理以下錯誤情況：

1. **無效選項**：如果使用者輸入的選項無效，程式會忽略該輸入，並重新顯示主選單畫面
2. **權限錯誤**：如果使用者沒有執行所選功能的權限，程式會顯示錯誤訊息"您無權執行此功能"
3. **子程式錯誤**：子程式的錯誤由子程式自行處理，主選單程式不處理子程式的錯誤

## 8. 維護歷史

| 日期 | 作者 | 修改內容 |
|------|------|----------|
| 97/09/16 | A1546 VINCENT HO | 程式初版建立 |
| 100/01/31 | A1492 TERRY | 程式更新 |

## 9. 系統整合

APM000C程式與以下系統或模組整合：

1. **權限管理系統**：通過S#S01程式檢查使用者權限
2. **供應商管理模組**：調用PA#A110等程式維護供應商資料
3. **應付帳款交易處理模組**：調用APB001、APB002等程式處理應付帳款交易
4. **應付帳款查詢模組**：調用API001、API002等程式進行應付帳款查詢
5. **應付帳款報表模組**：調用APR001、APR002等程式生成應付帳款報表
6. **系統維護模組**：調用APM001、APM002等程式進行系統維護

## 10. 使用說明

### 10.1 進入程式

1. 從系統主選單選擇"應付帳款管理系統"選項
2. 系統顯示APM000C主選單畫面

### 10.2 選擇功能

1. 在主選單畫面上，輸入要執行的功能的選項代碼（如"01"、"02"等）
2. 按Enter鍵確認選擇
3. 如果有權限，系統會調用相應的子程式
4. 子程式執行完成後，系統會返回主選單畫面

### 10.3 退出程式

1. 在主選單畫面上，按F3鍵
2. 系統返回上層選單

## 11. 效能考量

1. **記憶體使用**：程式使用的變數和資料結構較少，記憶體使用量較小
2. **處理速度**：主選單程式主要進行選單顯示和程式調用，處理速度較快
3. **資源使用**：程式不進行大量資料處理，資源使用較少

## 12. 安全考量

1. **權限控制**：程式通過S#S01程式檢查使用者權限，確保只有授權使用者才能執行特定功能
2. **資料保護**：程式不直接處理敏感資料，資料保護由子程式負責
3. **審計追蹤**：系統可以記錄使用者的操作，以便進行審計追蹤

## 13. 未來擴展建議

1. **功能擴展**：可以在主選單中增加更多應付帳款管理功能，如電子發票處理、供應商評估等
2. **介面優化**：可以優化主選單畫面，使其更加直觀和易用
3. **整合增強**：可以增強與其他系統的整合，如與採購系統、庫存系統的整合

## 14. 結論

APM000C程式作為應付帳款管理系統的主選單程式，提供了一個集中的入口點，讓使用者可以方便地訪問各種應付帳款管理功能。程式設計簡潔明了，功能完善，易於維護和擴展。通過權限控制機制，確保了系統的安全性。程式與其他系統和模組的良好整合，使其成為西祺企業經營管理資訊系統中不可或缺的一部分。 