# VTR010程序規格說明文檔

## 1. 基本資訊

- **程序名稱**：VTR010
- **系統**：西祺企業管理資訊系統 - 銷售模組
- **子系統**：銷售訂單
- **功能描述**：銷售訂單月報表列印程序
- **開發者**：MICHELLE
- **創建日期**：2002/10/15

## 2. 程序結構

VTR010程序是一個報表生成系統，作為銷售訂單月報表列印的主控程序，它調用了以下相關程序：
- VTR010：顯示報表參數輸入界面
- VTR010C：主控程序，負責協調各個子程序的調用
- VTR010C1：處理報表生成邏輯
- VTR0101/VTR0102/VTR0103：根據不同的報表類型處理數據

### 2.1 程序流程

1. 程序啟動後，調用VTR010顯示報表參數輸入界面
2. 用戶輸入報表參數，包括公司碼、辦事處、訂單年月範圍、報表類型等
3. 如果用戶按F3退出，則清除LDA區域並返回
4. 如果用戶未退出，則根據$EVR參數決定是直接調用VTR010C1還是提交作業調用
5. VTR010C1程序根據用戶選擇的報表類型(DOPT)調用相應的處理程序(VTR0101/VTR0102/VTR0103)
6. 處理程序從銷售訂單檔案中讀取數據，生成報表

## 3. 相關檔案

### 3.1 主要檔案

- **SOVQLF01**：銷售訂單明細檔案，用於提供報表數據
- **REWFD4**：報表工作檔案，用於臨時存儲報表數據
- **REWFD5**：報表工作檔案，用於臨時存儲報表數據

### 3.2 參數定義

主要參數：

| 參數名 | 描述 | 類型 | 備註 |
|-------|------|------|------|
| DVQ91 | 公司碼 | 字符(1) | 公司標識(W/R/K/S) |
| DVQ92 | 辦事處 | 字符(1) | 辦事處代碼(1/2/3) |
| DVQ04S | 起始年月 | 數字(4) | 格式：MM/YY |
| DVQ04E | 結束年月 | 數字(4) | 格式：MM/YY |
| DOPT | 報表類型 | 字符(1) | 1=進貨、2=銷售、3=庫存 |
| $EVR | 執行方式 | 數字(1) | 1=立即執行、2=批次執行 |
| $CPY | 列印份數 | 數字(3) | 報表列印份數 |
| $PRTID | 印表機ID | 字符(2) | 印表機識別碼 |

## 4. 程序功能詳細說明

### 4.1 VTR010 - 參數輸入界面

VTR010程序提供了報表參數輸入的用戶界面，允許用戶指定報表的各種條件。主要功能包括：
- 初始化界面參數(RTN010)
- 處理F4鍵的幫助功能(RTNF4)
- 驗證用戶輸入的參數(RTN100)，包括：
  - 檢查年月格式是否正確
  - 確保起始日期不大於結束日期
  - 轉換日期格式

### 4.2 VTR010C - 主控程序

VTR010C是整個報表生成流程的主控程序，負責協調各個子程序的調用。它根據用戶選擇的執行方式($EVR)決定是直接調用VTR010C1還是提交作業調用，提供了靈活的報表生成方式。

### 4.3 VTR010C1 - 報表生成控制

VTR010C1程序負責報表生成的主要邏輯，它首先準備工作檔案(REWFD4和REWFD5)，然後根據用戶選擇的報表類型(DOPT)調用相應的處理程序：
- DOPT=1：調用VTR0101處理進貨報表
- DOPT=2：調用VTR0102處理銷售報表
- DOPT=3：調用VTR0103處理庫存報表

### 4.4 VTR0101 - 進貨報表處理

VTR0101程序處理進貨報表的生成，它從SOVQLF01檔案讀取數據，根據用戶指定的條件(公司碼、辦事處、年月範圍)篩選數據，然後將處理後的數據寫入REWFD4和REWFD5工作檔案，最終生成進貨報表。

## 5. 業務規則

### 5.1 公司碼(DVQ91)

- 'W'、'R'、'K'、'S'：不同的公司代碼，用於篩選特定公司的數據

### 5.2 辦事處處理(DVQ92)

- '1'：台北辦事處
- '2'：台中辦事處
- '3'：高雄辦事處
- ' '：所有辦事處(會自動設置範圍為'1'到'9')

### 5.3 日期處理

程序會將用戶輸入的年月(MM/YY)轉換為完整的日期格式(YYMMDD)，並確保起始日期不大於結束日期。

## 6. 界面說明

VTR010D程序提供了報表參數輸入的用戶界面，主要包括：

1. 公司碼選擇(W/R/K/S)
2. 辦事處選擇(1/2/3)
3. 訂單年月範圍輸入(起始和結束年月)
4. 報表類型選擇(1=進貨、2=銷售、3=庫存)
5. 執行方式選擇(1=立即執行、2=批次執行)
6. 列印份數設定
7. 印表機ID選擇

## 7. 數據流向

1. 用戶輸入參數 → LDA區域
2. LDA區域 → VTR010C1程序
3. SOVQLF01銷售訂單明細檔案 → VTR0101/VTR0102/VTR0103處理程序
4. 處理程序 → REWFD4/REWFD5工作檔案
5. 工作檔案 → 報表輸出(VTR010P1/VTR010P2)

## 8. 安全與權限

程序沒有明確的安全控制機制，但可能依賴於系統級別的用戶權限控制。用戶ID記錄在$USER欄位中，可用於審計跟蹤。

## 9. 維護建議

1. 考慮增加更多的報表類型，以滿足不同的業務需求
2. 增強參數驗證邏輯，提高程序的健壯性
3. 考慮添加報表預覽功能，減少不必要的列印
4. 可以考慮將硬編碼的值(如印表機設置)改為配置參數，提高靈活性
5. 增加報表格式的自定義選項，以適應不同的報表需求

## 10. 總結

VTR010程序是西祺企業管理資訊系統銷售模組中的重要組成部分，負責銷售訂單月報表的生成和列印功能。它通過一系列相互關聯的程序和檔案，提供了靈活的報表生成方式，支持不同類型的報表(進貨、銷售、庫存)，並允許用戶指定各種報表參數。程序設計遵循了AS/400系統的典型架構，使用多個相互關聯的程序和檔案完成業務功能。