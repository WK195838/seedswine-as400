# PIM000C程序規格說明文檔

## 1. 基本資訊

- **程序名稱**：PIM000C
- **系統**：西祺企業管理資訊系統 - 庫存模組
- **子系統**：庫存管理
- **功能描述**：庫存管理系統主選單程序
- **開發者**：ROGER CHIEN
- **創建日期**：1980/11/15

## 2. 程序結構

PIM000C程序是庫存管理系統的主選單程序，作為整個庫存管理系統的入口點，它提供了一個選單界面，允許用戶選擇不同的庫存管理功能。

### 2.1 程序流程

1. 程序啟動後，調用P63程序進行初始化
2. 設置注意程序(SETATNPGM)為ATN01
3. 從LDA區域獲取用戶ID和日期資訊
4. 顯示主選單界面(PIM000D)
5. 用戶輸入選項代碼(DOPID)
6. 如果用戶按F3退出，則結束程序
7. 如果用戶輸入有效的選項代碼，程序會根據選項代碼設置相應的程序名稱(S0102I)
8. 調用權限檢查程序(S#S01)，檢查用戶是否有權限執行所選功能
9. 如果用戶有權限，則調用相應的子程序；否則顯示錯誤訊息
10. 返回主選單界面，等待用戶下一步操作

## 3. 相關檔案

### 3.1 主要檔案

- **PIM000D**：主選單顯示檔案，定義了選單界面的布局和選項
- **PIA001**、**PIA002**等：基本資料維護程序
- **PIB001**：庫存作業程序
- **PII021**、**PII022**等：查詢作業程序
- **PIR041C**、**PIR042C**等：報表列印程序

### 3.2 參數定義

主要參數：

| 參數名 | 描述 | 類型 | 備註 |
|-------|------|------|------|
| DOPID | 選項代碼 | 字符(2) | 用戶選擇的功能代碼 |
| S0101I | 用戶ID | 字符(10) | 當前用戶的識別碼 |
| S0102I | 程序名稱 | 字符(10) | 要調用的子程序名稱 |
| S0101O | 權限標誌 | 字符(1) | 'Y'表示有權限，其他值表示無權限 |

## 4. 程序功能詳細說明

### 4.1 主選單界面

PIM000D顯示檔案定義了庫存管理系統的主選單界面，包含以下主要功能區域：

1. **基本資料維護**：
   - 01 - 庫存基本資料
   - 02 - 庫存資料輸入
   - 03 - 庫存資料修改
   - 04 - 庫存資料清除
   - 05 - 庫存單價批次調整

2. **庫存作業**：
   - 06 - 年度結轉庫存數量

3. **查詢作業**：
   - 21 - 最低庫存量查詢
   - 22 - 年度結轉數量查詢
   - 23 - 庫存異動查詢

4. **報表列印**：
   - 41 - 庫存表
   - 42 - 庫存明細表
   - 43 - 庫存盤點表
   - 44 - 各部門庫存異動表
   - 45 - 庫存已存貨查詢表
   - 46 - 年度結轉數量列印
   - 47 - 物料成本異動彙總表
   - 48 - 新舊料對照表
   - 49 - 年度結轉差異金額表
   - 50 - 年度庫存異動金額表

### 4.2 選項處理

PIM000C程序根據用戶選擇的選項代碼(DOPID)，設置相應的子程序名稱(S0102I)：

- DOPID='01' → S0102I='PIA001'（庫存基本資料）
- DOPID='02' → S0102I='PIA002'（庫存資料輸入）
- DOPID='03' → S0102I='PIA003'（庫存資料修改）
- 以此類推...

### 4.3 權限檢查

程序調用S#S01程序檢查用戶是否有權限執行所選功能：

```
CALL PGM(S#S01) PARM(&S0101I &S0102I &S0101O)
```

如果S0101O返回'Y'，則用戶有權限執行該功能，程序會調用相應的子程序；否則，程序會設置錯誤標誌(IN98)並返回主選單界面。

### 4.4 子程序結構

以PIA001（庫存基本資料）為例，子程序通常包含以下組件：

1. 界面程序：提供用戶交互界面
2. 處理程序：負責實際的數據處理和維護
3. 檔案定義：包括IMIOPF（庫存主檔）、IMITLF01（庫存明細檔）等

## 5. 業務規則

### 5.1 庫存基本資料維護

庫存基本資料維護功能允許用戶管理庫存項目的基本資訊，包括：

- 新增庫存項目
- 修改庫存項目資訊
- 刪除庫存項目
- 查詢庫存項目

### 5.2 庫存作業

庫存作業功能處理庫存的日常操作，包括：

- 年度結轉：將當年度的庫存數量結轉到下一年度
- 庫存調整：調整庫存數量和單價

### 5.3 報表列印

報表列印功能提供各種庫存報表，包括：

- 庫存表：顯示當前庫存狀況
- 庫存明細表：顯示庫存的詳細資訊
- 庫存盤點表：用於庫存盤點
- 各部門庫存異動表：顯示各部門的庫存變動
- 年度結轉報表：顯示年度結轉的結果

## 6. 界面說明

PIM000D顯示檔案定義了庫存管理系統的主選單界面，主要包括：

1. 標題區域：顯示系統名稱、日期、時間和用戶ID
2. 選項區域：列出所有可用的功能選項，分為基本資料維護、庫存作業、查詢作業和報表列印四個部分
3. 輸入區域：用戶輸入選項代碼(DOPID)
4. 功能鍵區域：顯示可用的功能鍵（如F3=返回主選單）
5. 訊息區域：顯示錯誤訊息或提示訊息

## 7. 數據流向

1. 用戶輸入選項代碼(DOPID) → PIM000C程序
2. PIM000C程序 → 權限檢查程序(S#S01)
3. 權限檢查結果 → PIM000C程序
4. PIM000C程序 → 子程序(PIA001等)
5. 子程序 → 庫存檔案(IMIOPF等)

## 8. 安全與權限

程序使用S#S01程序進行權限檢查，確保用戶只能訪問其有權限的功能。權限檢查基於用戶ID(S0101I)和程序名稱(S0102I)，返回權限標誌(S0101O)。

此外，程序還設置了注意程序(ATN01)，可能用於處理系統中斷或特殊情況。

## 9. 維護建議

1. 考慮更新界面設計，提高用戶體驗
2. 增強錯誤處理機制，提供更詳細的錯誤訊息
3. 考慮添加日誌記錄功能，便於問題追蹤
4. 可以考慮將硬編碼的程序名稱改為配置參數，提高靈活性
5. 增加更多的選項說明和幫助功能，幫助用戶更好地理解和使用系統
6. 注意M001註釋中提到的PIB0XX不再使用的情況，可能需要進一步清理相關代碼

## 10. 總結

PIM000C程序是西祺企業管理資訊系統庫存模組中的重要組成部分，作為庫存管理系統的入口點，它提供了一個統一的界面，允許用戶訪問各種庫存管理功能。程序設計遵循了AS/400系統的典型架構，使用多個相互關聯的程序和檔案完成業務功能。通過權限檢查機制，確保了系統的安全性和數據的完整性。

庫存管理系統涵蓋了庫存基本資料維護、庫存作業、查詢作業和報表列印等功能，為企業提供了全面的庫存管理解決方案。系統的模塊化設計使得各個功能可以獨立運行，同時又能通過主選單程序進行統一管理。