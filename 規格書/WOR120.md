# WOR120 工單查詢程式規格說明書

## 1. 基本資訊

- **程式名稱**：WOR120
- **程式類型**：RPG程式
- **程式庫**：REPLIB
- **功能說明**：工單查詢
- **相關檔案**：
  - WOR120D（顯示檔案）
  - WOR120P（印表檔案）
  - WOR1201（子程式）
- **系統名稱**：西祺企業經營管理資訊系統
- **子系統**：工單管理
- **作者**：未指定
- **建立日期**：85/08/20
- **修改日期**：未指定
- **備註**：工單查詢

## 2. 程式概述

WOR120是西祺企業經營管理資訊系統中工單管理模組的查詢程式，專門用於處理工單的查詢功能。此程式提供多種查詢條件，包括工單號碼、客戶代碼、產品代碼、工單狀態、日期範圍等，使用者可以根據實際需求選擇適合的條件組合，快速查詢工單資訊。

程式採用模組化設計，主程式負責處理用戶輸入的查詢條件，子程式負責實際的查詢處理和結果顯示，確保程式結構清晰、易於維護和擴展。

## 3. 程式流程

### 3.1 流程圖

```
開始
  |
  v
初始化畫面
  |
  v
顯示查詢條件畫面
  |
  v
使用者輸入查詢條件
  |
  v
驗證查詢條件
  |
  v
執行查詢
  |
  v
顯示查詢結果
  |
  v
使用者選擇操作（查看詳細資訊/列印/返回）
  |
  v
結束
```

### 3.2 初始化階段

```RPG
C           RTN010    BEGSR
C                     IN   LDA
C                     MOVEL$USER     AUT     3
C           AUT       IFNE 'D91'
C           AUT       ANDNE'REP'
C                     SETON                     31
C                     END
C                     MOVE *BLANK    DWE07S
C                     MOVE *BLANK    DWE07E
C                     MOVE *BLANK    DWE15S
C                     MOVE *BLANK    DWE15E
C                     MOVE *BLANK    DWE18S
C                     MOVE *BLANK    DWE18E
C                     MOVE *BLANK    DWE1S
C                     MOVE *BLANK    DWE1E
C                     ENDSR
```

初始化階段主要完成以下工作：
1. 讀取LDA（Local Data Area）資料
2. 設置使用者權限
3. 初始化查詢條件欄位
4. 設置預設值

### 3.3 查詢條件處理

程式提供多種查詢條件，包括：
1. 工單號碼範圍
2. 客戶代碼範圍
3. 產品代碼範圍
4. 工單狀態選擇（未完成、已完成、全部）
5. 工單日期範圍
6. 預計完成日期範圍

使用者可以根據需要填寫一個或多個條件，系統會根據這些條件組合查詢符合的工單。

### 3.4 查詢執行

當使用者輸入查詢條件並按下確認鍵後，程式會執行以下步驟：
1. 驗證查詢條件的有效性
2. 根據查詢條件從工單主檔中讀取符合的記錄
3. 將查詢結果顯示在結果列表畫面上

### 3.5 結果處理

查詢結果顯示後，使用者可以：
1. 選擇特定工單查看詳細資訊
2. 列印查詢結果
3. 返回查詢條件畫面修改條件
4. 退出程式

## 4. 畫面說明

### 4.1 查詢條件畫面（SCR001）

查詢條件畫面包含以下主要欄位：
- 工單號碼範圍（起始/結束）
- 客戶代碼範圍（起始/結束）
- 產品代碼範圍（起始/結束）
- 工單狀態選擇（複選框）
  - 未完成
  - 已完成
  - 已取消
  - 全部
- 工單日期範圍（起始/結束）
- 預計完成日期範圍（起始/結束）

功能鍵：
- F3：退出
- F4：提示（用於選擇客戶或產品）
- Enter：執行查詢

### 4.2 查詢結果列表畫面（SCR002）

查詢結果列表畫面顯示符合條件的工單列表，包含以下資訊：
- 工單號碼
- 工單日期
- 客戶代碼
- 客戶名稱
- 產品代碼
- 產品名稱
- 訂單數量
- 完成數量
- 工單狀態
- 預計完成日期

功能鍵：
- F3：退出
- F4：返回查詢條件畫面
- F6：列印查詢結果
- 5=顯示：查看工單詳細資訊

### 4.3 工單詳細資訊畫面（SCR003）

工單詳細資訊畫面顯示選定工單的詳細資訊，包含：
- 工單基本資訊（工單號碼、日期、狀態等）
- 客戶資訊
- 產品資訊
- 數量資訊
- 生產進度資訊
- 相關備註

功能鍵：
- F3：退出
- F12：返回查詢結果列表

## 5. 資料檔案說明

程式使用以下主要資料檔案：

### 5.1 WOMAPF（工單主檔）

包含工單的基本資訊，如工單號碼、日期、客戶代碼、產品代碼、數量、狀態等。

主要欄位：
- WONO：工單號碼
- WODT：工單日期
- WOCM：客戶代碼
- WOPT：產品代碼
- WOQT：訂單數量
- WOFQ：完成數量
- WOST：工單狀態
- WOET：預計完成日期

### 5.2 WODAPF（工單明細檔）

包含工單的詳細資訊，如生產步驟、材料使用、工時記錄等。

主要欄位：
- WDNO：工單號碼
- WDSQ：序號
- WDPT：產品代碼
- WDQT：數量
- WDST：狀態

### 5.3 CTMAPF（客戶主檔）

包含客戶的基本資訊，用於顯示客戶名稱等資訊。

### 5.4 PTMAPF（產品主檔）

包含產品的基本資訊，用於顯示產品名稱等資訊。

## 6. 程式邏輯

### 6.1 查詢條件處理邏輯

1. 當使用者未輸入特定範圍的起始值時，系統自動設置為最小值
2. 當使用者未輸入特定範圍的結束值時，系統自動設置為最大值
3. 系統檢查起始值不得大於結束值
4. 當使用者未選擇工單狀態時，系統預設查詢所有狀態

```RPG
C           RTN100    BEGSR
C           DWE07S    IFEQ *BLANKS
C                     MOVE *LOVAL    DWE07S
C                     END
C           DWE07E    IFEQ *BLANKS
C                     MOVE *HIVAL    DWE07E
C                     END
C           DWE07S    IFGT DWE07E
C                     SETON                     666799
C                     END
C           DWE18S    IFEQ *BLANKS
C                     MOVE *LOVAL    DWE18S
C                     END
C                     ENDSR
```

### 6.2 查詢執行邏輯

1. 系統根據使用者輸入的條件組合SQL查詢語句
2. 執行查詢並將結果存入暫存檔
3. 讀取暫存檔並顯示結果

### 6.3 結果處理邏輯

1. 當查詢結果為空時，系統顯示「無符合條件的記錄」訊息
2. 當查詢結果超過一頁時，系統支援分頁顯示
3. 使用者可以選擇特定工單查看詳細資訊
4. 使用者可以選擇列印查詢結果

## 7. 錯誤處理

程式包含以下錯誤處理機制：

1. **無效的查詢條件**：
   - 當起始值大於結束值時，系統顯示錯誤訊息並要求使用者修正
   - 當日期格式不正確時，系統顯示錯誤訊息

2. **查詢結果為空**：
   - 當沒有符合條件的記錄時，系統顯示「無符合條件的記錄」訊息

3. **系統錯誤**：
   - 當發生系統錯誤時，程式顯示錯誤代碼和訊息，並記錄錯誤日誌

## 8. 維護歷史

| 日期 | 作者 | 修改內容 |
|------|------|----------|
| 85/08/20 | 未指定 | 程式建立 |

## 9. 系統整合

WOR120程式與以下系統或模組整合：

1. **工單管理模組**：
   - 與工單輸入程式(WOA001)整合，提供工單查詢功能
   - 與工單報表程式(WOR110)整合，提供查詢後列印功能

2. **庫存管理模組**：
   - 與庫存管理程式整合，顯示產品庫存資訊

3. **客戶管理模組**：
   - 與客戶管理程式整合，顯示客戶資訊

4. **產品管理模組**：
   - 與產品管理程式整合，顯示產品資訊

## 10. 使用說明

### 10.1 程式調用

程式可以通過以下方式調用：
1. 從工單管理主選單選擇「工單查詢」選項
2. 直接執行命令：CALL WOR120

### 10.2 查詢工單

1. 在查詢條件畫面輸入所需的查詢條件
2. 按Enter鍵執行查詢
3. 系統顯示符合條件的工單列表
4. 使用上下鍵瀏覽查詢結果

### 10.3 查看工單詳細資訊

1. 在查詢結果列表中，在所需工單前輸入「5」
2. 按Enter鍵顯示工單詳細資訊
3. 查看完畢後，按F12鍵返回查詢結果列表

### 10.4 列印查詢結果

1. 在查詢結果列表畫面按F6鍵
2. 系統將查詢結果列印到指定的印表機

### 10.5 退出程式

在任何畫面按F3鍵退出程式

## 11. 效能考量

1. **查詢效率**：
   - 程式使用索引鍵進行查詢，確保查詢效率
   - 當查詢結果數量過大時，系統會提示使用者縮小查詢範圍

2. **記憶體使用**：
   - 程式使用暫存檔存儲查詢結果，避免過度佔用記憶體
   - 查詢結果分頁顯示，減少記憶體使用

3. **回應時間**：
   - 一般查詢回應時間控制在3秒以內
   - 複雜條件查詢可能需要更長時間

## 12. 安全考量

1. **權限控制**：
   - 程式檢查使用者權限，只有具有適當權限的使用者才能執行查詢
   - 特定功能（如列印）可能需要額外權限

2. **資料保護**：
   - 程式只顯示使用者有權查看的工單資訊
   - 敏感資訊（如成本資料）只對有權限的使用者顯示

3. **審計追蹤**：
   - 系統記錄查詢操作，包括查詢條件和時間
   - 管理者可以查看查詢日誌

## 13. 未來擴展建議

1. **增加查詢條件**：
   - 增加更多查詢條件，如負責人、優先級等
   - 支援更複雜的條件組合

2. **結果排序**：
   - 增加結果排序功能，允許使用者按不同欄位排序
   - 支援多欄位排序

3. **資料匯出**：
   - 增加查詢結果匯出功能，支援CSV、Excel等格式
   - 提供電子郵件發送功能

4. **圖形化顯示**：
   - 增加工單狀態的圖形化顯示
   - 提供工單進度的圖表顯示

## 14. 結論

WOR120工單查詢程式是西祺企業經營管理資訊系統中工單管理模組的重要組成部分，提供了全面的工單查詢功能。程式設計靈活，允許使用者根據不同的條件查詢工單資訊，並提供詳細資訊查看和列印功能。

通過與其他模組的良好整合，WOR120成為連接工單管理、庫存管理、客戶管理和產品管理的重要橋樑，為企業的生產管理提供了強大的支持。隨著系統的不斷發展，WOR120可以進一步擴展功能，提供更全面、更靈活的工單查詢解決方案。 