# JLB011C 程式規格說明文件

## 一、基本資訊

- **程式ID**：JLB011C
- **程式名稱**：憑證列印主控程式
- **系統歸屬**：西祺企業管理資訊系統 - 會計憑證模組
- **開發者**：D910121 CHARLES
- **建立日期**：1993.05.22
- **最後更新**：1998.11.17 (Y2K修改)

## 二、程式概述

JLB011C 是西祺企業管理資訊系統中會計憑證模組的主控程式，負責協調憑證列印相關的各個子程式。該程式透過使用者介面收集列印參數，然後呼叫相應的子程式執行憑證列印任務。程式支援批次處理模式和互動式處理模式，可根據系統環境自動選擇適當的執行方式。

## 三、系統架構

JLB011C 程式在系統中的位置處於會計憑證模組的列印處理環節，是連接使用者介面和實際列印處理的中間控制層。程式架構如下：

1. **主控程式**：JLB011C - 負責流程控制和子程式呼叫
2. **介面程式**：JLB0111 - 負責使用者互動和參數收集
3. **處理程式**：JLB011C1 - 負責實際的列印處理邏輯
4. **列印程式**：
   - JLB0112 - 資料準備和處理
   - JLB0113 - 憑證列印程式
   - JLB0114 - 憑證彙總列印程式

## 四、程式流程

1. **初始化階段**：
   - 從 LDA (本地資料區) 獲取使用者資訊和系統日期
   - 設定初始參數和環境變數

2. **使用者互動階段**：
   - 呼叫 JLB0111 顯示使用者介面
   - 收集使用者輸入的列印參數（包括帳期區間、處理方式等）
   - 處理使用者功能鍵（F3 退出、F14 處理作業）

3. **處理控制階段**：
   - 根據系統環境變數($EVR)判斷執行模式
   - 批次處理模式：提交後台作業(SBMJOB)執行 JLB011C1
   - 互動式模式：直接呼叫 JLB011C1 程式

4. **循環控制**：
   - 程式執行完成後返回使用者互動階段，等待下一次操作

## 五、介面設計

JLB011D 顯示檔案是程式的主要使用者介面，包含以下元素：

1. **標題區**：
   - 程式標識和系統名稱
   - 當前使用者和系統日期

2. **參數輸入區**：
   - 帳期區間選擇（D01-D02）
   - 處理方式選擇（D03-D04）

3. **功能鍵**：
   - F3：退出程式
   - F4：說明資訊
   - F14：處理作業

## 六、資料處理

JLB011C1 子程式負責實際的資料處理，主要流程包括：

1. **資料準備**：
   - 從 LDA 獲取使用者選擇的參數
   - 建立臨時檔案和工作檔案
   - 設定檔案覆蓋和共享參數

2. **資料處理**：
   - 呼叫 JLB0112 程式處理憑證資料
   - 根據使用者選擇的參數篩選和整理資料

3. **報表產生**：
   - 呼叫 JLB0113 程式產生憑證明細報表
   - 呼叫 JLB0114 程式產生憑證彙總報表
   - 設定列印參數和輸出格式

## 七、檔案使用

程式使用的主要檔案包括：

1. **顯示檔案**：
   - JLB011D - 使用者介面顯示檔案

2. **資料檔案**：
   - WF#GPF - 工作檔案
   - WFJL10PF - 憑證主檔案
   - WFJL10LF - 憑證邏輯檔案
   - WFJL11PF - 憑證明細檔案

3. **列印檔案**：
   - JLB0113P - 憑證明細列印格式
   - JLB0114P - 憑證彙總列印格式

## 八、安全與權限

1. **使用者驗證**：
   - 程式透過 LDA 獲取使用者資訊
   - 使用者權限控制透過系統模組管理

2. **資料安全**：
   - 使用臨時檔案和工作檔案處理資料，避免直接修改原始資料
   - 檔案共享設定確保多使用者環境下的資料一致性

## 九、效能考慮

1. **批次處理最佳化**：
   - 透過環境變數判斷是否使用批次處理模式
   - 大量資料處理時自動切換到後台作業處理

2. **檔案最佳化**：
   - 使用臨時庫(QTEMP)儲存中間資料
   - 適當設定檔案共享參數提高並行效能

## 十、維護建議

1. **程式碼最佳化**：
   - 統一錯誤處理機制
   - 增強參數驗證邏輯

2. **功能增強**：
   - 增加更靈活的列印參數選項
   - 提供預覽功能
   - 支援電子憑證輸出

3. **相容性改進**：
   - 確保與新版系統的相容性
   - 最佳化 Y2K 相關程式碼

## 十一、整合點

1. **上游系統**：
   - 會計憑證錄入模組
   - 會計科目管理模組

2. **下游系統**：
   - 財務報表系統
   - 帳簿管理系統

## 十二、總結

JLB011C 程式是西祺企業管理資訊系統會計憑證模組中的關鍵組件，負責憑證列印的控制和協調。程式設計合理，支援批次處理和互動式處理，能夠滿足企業日常憑證列印的需求。透過與其他子程式的協作，實現了從使用者參數輸入到最終報表輸出的完整流程。