# REM000C.txt 程式規格書

## 1. 基本資訊

- **程式名稱**：REM000C
- **程式類型**：CL程式（控制語言程式）
- **程式庫**：REPLIB
- **功能描述**：系統主選單控制程式
- **相關檔案**：REM000D（顯示檔案）
- **系統名稱**：西祺企業管理資訊系統

## 2. 程式概述

REM000C是西祺企業管理資訊系統的主選單控制程式，作為整個系統的導航中心。此程式負責顯示主選單介面，處理使用者的選擇，檢查使用者權限，並呼叫相應的功能模組程式。它是使用者與系統各功能模組之間的橋樑，提供了一個統一的入口點來訪問系統的所有主要功能。

## 3. 程式流程

```
開始
  |
  ↓
宣告變數和檔案
  |
  ↓
覆蓋訊息檔
  |
  ↓
呼叫初始化程式 (P63, NOM000R)
  |
  ↓
從LDA獲取使用者資訊和日期
  |
  ↓
設定注意程式 (SETATNPGM)
  |
  ↓
設定使用者ID變數
  |
  ↓
START: 顯示主選單畫面
  |
  ↓
接收使用者選擇
  |
  ↓
根據選擇設定對應的程式名稱
  |
  ↓
檢查使用者權限 (CHKAUT)
  |
  ↓
呼叫選擇的程式或返回主選單
  |
  ↓
結束
```

## 4. 程式碼分析

### 4.1 變數宣告

```
DCL VAR(&WDATE) TYPE(*CHAR) LEN(6)
DCL VAR(&$USER) TYPE(*CHAR) LEN(10)
DCL VAR(&S0101I) TYPE(*CHAR) LEN(10)
DCL VAR(&S0102I) TYPE(*CHAR) LEN(10)
DCL VAR(&S0101O) TYPE(*CHAR) LEN(1)
DCLF FILE(*LIBL/REM000D) RCDFMT(DSPC1)
```
- 宣告日期、使用者ID和程式名稱等變數
- 宣告REM000D顯示檔案，使用DSPC1記錄格式

### 4.2 系統初始化

```
OVRMSGF MSGF(QCPFMSG) TOMSGF(PTFLIB/PTMF)
CALL PGM(P63)
CALL PGM(NOM000R)
```
- 覆蓋系統訊息檔為自定義訊息檔
- 呼叫P63程式進行系統初始化
- 呼叫NOM000R程式（可能是通知或記錄程式）

### 4.3 使用者資訊獲取

```
RTVDTAARA DTAARA(*LDA (101 10)) RTNVAR(&$USER)
RTVDTAARA DTAARA(*LDA (119 6)) RTNVAR(&WDATE)
CHGVAR VAR(&$EGMDY) VALUE(&WDATE)
```
- 從本地資料區(LDA)獲取使用者ID和日期
- 將日期值設定到顯示變數$EGMDY

### 4.4 注意程式設定

```
SETATNPGM PGM(*LIBL/ATN01)
```
- 設定系統注意程式為ATN01
- 當使用者按下注意鍵時，系統會呼叫此程式

### 4.5 主選單顯示與處理

```
START:
SNDRCVF DEV(*FILE) RCDFMT(DSPC1)
CHGVAR VAR(&IN98) VALUE('0')
```
- 顯示主選單畫面並接收使用者輸入
- 重設錯誤指示器IN98

### 4.6 選項處理

```
IF COND(&DOPID *EQ '01') THEN(DO)
   CHGVAR VAR(&S0102I) VALUE('PAM000C')
ENDDO
...
```
- 根據使用者選擇的選項(DOPID)設定對應的程式名稱
- 系統包含多個功能模組，每個都有對應的程式

### 4.7 權限檢查與程式呼叫

```
CHKAUT: CALL PGM(S#S01) PARM(&S0101I &S0102I &S0101O)
IF COND(&S0101O = 'Y') THEN(CALL PGM(&S0102I))
ELSE CMD(CHGVAR VAR(&IN98) VALUE('1'))
GOTO START
```
- 呼叫S#S01程式檢查使用者權限
- 如果有權限(&S0101O = 'Y')，則呼叫選擇的程式
- 如果無權限，設定錯誤指示器並返回主選單

## 5. 功能模組對應表

| 選項 | 功能描述 | 程式名稱 |
|------|----------|----------|
| 01 | 採購作業 | PAM000C |
| 02 | 主檔作業 | MTM000C |
| 03 | 生產系統作業 | POM000C |
| 04 | 銷售訂單作業 | SOM000C |
| 05 | 銷售分析作業 | SAM000C |
| 06 | 庫存系統作業 | IMM000C |
| 07 | 配送系統作業 | PIM000C |
| 08 | 應收帳款作業 | ARM000C |
| 09 | 製造系統作業 | MSOM00C |
| 11 | 系統設定作業 | SSM000C |
| 13 | 生產系統報表 | POM001C |
| 14 | 銷售訂單報表 | SOM001C |
| 15 | 銷售分析報表 | SAM001C |
| 16 | 庫存系統報表 | IMM001C |
| 18 | 應收帳款報表 | ARM001C |
| 19 | 每日交易主選單 | VTM000C |
| 21 | 資料維護作業 | JLM000C |
| 1A | 應付帳款系統 | NPM300C |
| 80 | 系統管理作業 | S#M000 |
| 90 | 結束系統作業 | (RETURN) |

## 6. 相關檔案分析

### 6.1 REM000D（主選單顯示檔案）

- **功能**：定義系統主選單的顯示格式
- **主要記錄格式**：DSPC1
- **主要欄位**：
  - $EGMDY：顯示日期
  - $USER：顯示使用者ID
  - DOPID：使用者選擇的選項
  - ERR1：錯誤訊息

- **畫面布局**：
  - 顯示系統標題「西祺企業管理資訊系統」
  - 顯示日期、時間和使用者資訊
  - 列出所有可用的系統功能模組
  - 提供功能選擇輸入欄位

### 6.2 其他相關程式

- **P63**：系統初始化程式
- **NOM000R**：可能是通知或記錄程式
- **ATN01**：注意鍵處理程式
- **S#S01**：使用者權限檢查程式
- **各功能模組程式**：PAM000C, MTM000C, SOM000C等

## 7. 程式特點

1. **中央控制**：作為系統的中央控制點，管理所有功能模組的訪問
2. **模組化設計**：將不同功能分離為獨立的模組程式
3. **權限控制**：通過S#S01程式檢查使用者權限
4. **使用者友好**：提供清晰的選單介面，方便使用者導航
5. **錯誤處理**：使用指示器IN98處理錯誤情況

## 8. 系統架構關係

REM000C在整個系統架構中的位置：

```
INL01 (初始化程式)
   |
   ↓
REM000C (主選單控制程式) ←→ REM000D (顯示檔案)
   |
   ↓
功能模組 (PAM000C, MTM000C, SOM000C等)
```

## 9. 資料流分析

1. **輸入資料**：
   - 使用者選擇的選項(DOPID)
   - 本地資料區(LDA)中的使用者ID和日期

2. **處理邏輯**：
   - 根據選項確定要呼叫的程式
   - 檢查使用者權限
   - 呼叫相應的功能模組程式

3. **輸出資料**：
   - 主選單顯示
   - 錯誤訊息（如果有）
   - 功能模組程式的呼叫

## 10. 注意事項

1. 程式是系統的核心控制程式，修改時需謹慎
2. 程式依賴多個外部程式和檔案，如REM000D、P63、S#S01等
3. 系統使用LDA（本地資料區）儲存使用者資訊和日期
4. 程式中有一些被註解掉的功能（如選項10和31），可能是已棄用的功能

## 11. 建議與改進

1. 可考慮使用子程式結構來簡化選項處理邏輯
2. 可增加更詳細的錯誤處理和日誌記錄
3. 可考慮增加線上幫助功能
4. 可考慮使用參數檔案來管理功能模組對應，使系統更具彈性

---

此規格書基於REM000C.txt和相關檔案的分析。REM000C作為西祺企業管理資訊系統的主選單控制程式，是整個系統的核心組件，負責協調和管理所有功能模組的訪問。它提供了一個統一的使用者介面，使使用者能夠方便地訪問系統的各種功能。