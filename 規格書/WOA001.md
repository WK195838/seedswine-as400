# WOA001 工作訂單基本資料維護程式規格說明書

## 1. 基本資訊

- **程式名稱**：WOA001
- **程式類型**：RPG程式
- **程式庫**：REPLIB
- **功能描述**：工作訂單基本資料維護程式
- **相關檔案**：
  - WOA001D（顯示檔案）
  - WOWCPF（工作訂單主檔）
  - WOWDPF（工作訂單明細檔）
  - WOWCLF（工作訂單邏輯檔）
  - MTMAPF（產品主檔）
  - MTMEPF（產品明細檔）
- **系統名稱**：西祺企業經營管理資訊系統
- **子系統**：工作訂單管理系統
- **作者**：未明確標示
- **建立日期**：約1993年（根據顯示檔案時間戳記）
- **最後修改日期**：98/11/03（MICHELLE，Y2K修改）
- **程式說明**：工作訂單基本資料維護，提供工作訂單的新增、修改、刪除和查詢功能

## 2. 程式概述

WOA001是西祺企業經營管理資訊系統中工作訂單管理系統的基本資料維護程式。此程式負責工作訂單基本資料的維護，包括工作訂單的新增、修改、刪除和查詢功能。它是工作訂單管理系統的核心程式之一，為企業提供了完整的工作訂單生命週期管理。

工作訂單管理系統是企業資訊系統的重要組成部分，負責管理企業的工作訂單流程，包括工作訂單的創建、處理、跟蹤和完成。它與庫存管理系統、生產管理系統等緊密相連，確保企業生產業務的順利進行。

WOA001作為工作訂單管理系統的基礎程式，其設計遵循了AS/400系統的標準程式設計規範，採用子檔（Subfile）技術實現多筆資料的顯示和處理，確保系統的可維護性和擴展性。

## 3. 程式流程詳解

### 3.1 主要流程圖

```
開始
  |
  ↓
宣告變數和檔案
  |
  ↓
初始化系統環境
  |
  ↓
顯示主畫面（SCR001）
  |
  ↓
處理使用者選擇
  |   ↙        ↓        ↘        ↓
  新增      修改      刪除      查詢
  |          |          |          |
  ↓          ↓          ↓          ↓
資料驗證   資料驗證   確認刪除   顯示資料
  |          |          |          |
  ↓          ↓          ↓          ↓
更新檔案   更新檔案   更新檔案   返回主畫面
  |          |          |          |
  ↘        ↓        ↙        ↓
       返回主畫面或結束程式
```

### 3.2 詳細流程說明

#### 3.2.1 初始化階段

```RPG
FWOWCPF  UF  E           K        DISK                      A
FWOWDPF  UF  E           K        DISK                      A
FWOWCLF  IF  E           K        DISK
F            WC0                               KRENAMEWC0L
FMTMAPF  IF  E           K        DISK
FMTMEPF  IF  E           K        DISK
FWOA001D CF  E                    WORKSTN
```

1. **檔案宣告**：
   - `WOWCPF`：工作訂單主檔，更新模式
   - `WOWDPF`：工作訂單明細檔，更新模式
   - `WOWCLF`：工作訂單邏輯檔，輸入模式
   - `MTMAPF`：產品主檔，輸入模式
   - `MTMEPF`：產品明細檔，輸入模式
   - `WOA001D`：顯示檔案，工作站模式

2. **變數宣告**：
   ```RPG
   I           UDS
   I                                      101 110 $USER
   I                                      119 1240$EGMDY
   I                                      152 161 $USERN
   I                                      111 1160$CHYMD
   I                                      135 135 $ADD
   I                                      136 136 $UPD
   I                                      137 137 $DLT
   I                                      138 138 $INQ
   ```
   - 從LDA獲取使用者ID、日期和權限資訊
   - 定義子檔控制變數和鍵值列表

#### 3.2.2 主畫面處理

1. **子檔初始化**：
   ```RPG
   C                     EXSR R0100
   C                     EXSR R0200
   ```
   - `R0100`：初始化變數和權限
   - `R0200`：初始化子檔頭部

2. **主畫面顯示**：
   ```RPG
   C                     EXSR R1000
   ```
   - `R1000`：顯示主畫面SCR001，處理使用者輸入

3. **選項處理**：
   ```RPG
   C           DOPT1     CASEQ'2'     R2000
   C           DOPT1     CASEQ'3'     R3000
   C           DOPT1     CASEQ'5'     R5000
   ```
   - `2`：修改工作訂單
   - `3`：刪除工作訂單
   - `5`：查詢工作訂單詳細資料

#### 3.2.3 資料處理

1. **新增處理**：
   ```RPG
   C                     EXSR R2100
   ```
   - 驗證輸入資料
   - 檢查產品代碼是否存在
   - 新增工作訂單記錄

2. **修改處理**：
   ```RPG
   C                     EXSR R2200
   ```
   - 讀取現有工作訂單資料
   - 驗證修改後的資料
   - 更新工作訂單記錄

3. **刪除處理**：
   ```RPG
   C                     EXSR R3100
   ```
   - 確認刪除操作
   - 刪除工作訂單記錄

4. **查詢處理**：
   ```RPG
   C                     EXSR R5100
   ```
   - 顯示工作訂單詳細資料
   - 提供瀏覽功能

#### 3.2.4 子檔處理

1. **子檔載入**：
   ```RPG
   C                     EXSR R1100
   ```
   - 從工作訂單主檔讀取資料
   - 將資料載入子檔

2. **子檔顯示**：
   ```RPG
   C                     EXSR R1200
   ```
   - 設置子檔控制指示器
   - 顯示子檔資料

3. **子檔翻頁**：
   ```RPG
   C                     EXSR R1300
   ```
   - 處理ROLLUP/ROLLDOWN功能鍵
   - 更新子檔顯示範圍

## 4. 畫面說明

### 4.1 主畫面（SCR001）

主畫面採用子檔技術，顯示工作訂單列表，並提供功能鍵進行各種操作。

```
WOA001                      工作訂單基本資料維護                 日期: YY/MM/DD
SCR001                                                          時間: HH:MM:SS

選項: 2=修改 3=刪除 5=查詢

選項  訂單編號  訂單描述
 _    XXXXXX   XXXXXXXXXXXXXXXXXXXX
 _    XXXXXX   XXXXXXXXXXXXXXXXXXXX
 _    XXXXXX   XXXXXXXXXXXXXXXXXXXX
 _    XXXXXX   XXXXXXXXXXXXXXXXXXXX
 _    XXXXXX   XXXXXXXXXXXXXXXXXXXX
 _    XXXXXX   XXXXXXXXXXXXXXXXXXXX
 _    XXXXXX   XXXXXXXXXXXXXXXXXXXX
 _    XXXXXX   XXXXXXXXXXXXXXXXXXXX
 _    XXXXXX   XXXXXXXXXXXXXXXXXXXX
 _    XXXXXX   XXXXXXXXXXXXXXXXXXXX
 _    XXXXXX   XXXXXXXXXXXXXXXXXXXX
 _    XXXXXX   XXXXXXXXXXXXXXXXXXXX

F3=結束 F6=新增 ROLL=翻頁
```

### 4.2 詳細資料畫面（SCR002）

詳細資料畫面用於顯示和編輯工作訂單的詳細資訊。

```
WOA001                      工作訂單詳細資料                     日期: YY/MM/DD
SCR002                                                          時間: HH:MM:SS

訂單編號: XXXXXX
訂單日期: YY/MM/DD
客戶代碼: XXXXXX
客戶名稱: XXXXXXXXXXXXXXXXXXXX
訂單描述: XXXXXXXXXXXXXXXXXXXX
預計完成日期: YY/MM/DD
實際完成日期: YY/MM/DD
訂單狀態: X
備註: XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

產品明細:
產品代碼  產品名稱                數量    單價     金額     備註
XXXXXX    XXXXXXXXXXXXXXXXXXXX   9999   9999.99  9999.99  XXXXXXXXXX
XXXXXX    XXXXXXXXXXXXXXXXXXXX   9999   9999.99  9999.99  XXXXXXXXXX
XXXXXX    XXXXXXXXXXXXXXXXXXXX   9999   9999.99  9999.99  XXXXXXXXXX

F3=結束 F12=返回
```

### 4.3 功能鍵說明

| 功能鍵 | 功能描述 | 處理子程序 |
|--------|---------|-----------|
| F3 | 結束程式 | 返回上層選單 |
| F6 | 新增工作訂單 | R2100 |
| F12 | 返回 | 返回上一畫面 |
| ROLL UP | 向下翻頁 | R1300 |
| ROLL DOWN | 向上翻頁 | R1300 |

## 5. 資料檔案說明

### 5.1 WOWCPF（工作訂單主檔）

工作訂單主檔存儲工作訂單的基本資訊。

| 欄位名稱 | 資料類型 | 長度 | 說明 | 範例值 |
|---------|---------|------|------|--------|
| WC01 | 字元 | 6 | 工作訂單編號，主鍵 | 'W00001' |
| WC02 | 數值 | 6,0 | 訂單日期（YYMMDD） | 931203 |
| WC03 | 字元 | 6 | 客戶代碼 | 'C00123' |
| WC04 | 字元 | 20 | 訂單描述 | '設備維修訂單' |
| WC05 | 數值 | 6,0 | 預計完成日期 | 931220 |
| WC06 | 數值 | 6,0 | 實際完成日期 | 931218 |
| WC07 | 字元 | 1 | 訂單狀態（1=新建, 2=處理中, 3=完成, 4=取消） | '2' |
| WC08 | 字元 | 30 | 備註 | '緊急處理' |
| WCXX | 數值 | 6,0 | 建立日期 | 931203 |
| WCYY | 數值 | 6,0 | 建立時間 | 143025 |
| WCZZ | 字元 | 10 | 建立用戶 | 'A1062' |

### 5.2 WOWDPF（工作訂單明細檔）

工作訂單明細檔存儲工作訂單的產品明細資訊。

| 欄位名稱 | 資料類型 | 長度 | 說明 | 範例值 |
|---------|---------|------|------|--------|
| WD01 | 字元 | 6 | 工作訂單編號，主鍵之一 | 'W00001' |
| WD02 | 數值 | 3,0 | 明細序號，主鍵之一 | 1 |
| WD03 | 字元 | 6 | 產品代碼 | 'P00456' |
| WD04 | 數值 | 5,0 | 數量 | 10 |
| WD05 | 數值 | 7,2 | 單價 | 1250.00 |
| WD06 | 數值 | 9,2 | 金額（數量×單價） | 12500.00 |
| WD07 | 字元 | 20 | 備註 | '標準配置' |
| WDXX | 數值 | 6,0 | 建立日期 | 931203 |
| WDYY | 數值 | 6,0 | 建立時間 | 143025 |
| WDZZ | 字元 | 10 | 建立用戶 | 'A1062' |

### 5.3 MTMAPF（產品主檔）

產品主檔存儲產品的基本資訊。

| 欄位名稱 | 資料類型 | 長度 | 說明 | 範例值 |
|---------|---------|------|------|--------|
| MA01 | 字元 | 6 | 產品代碼，主鍵 | 'P00456' |
| MA02 | 字元 | 1 | 產品類型 | '1' |
| MA03 | 字元 | 20 | 產品名稱 | '電動馬達' |
| MA04 | 數值 | 7,2 | 標準單價 | 1250.00 |
| MA05 | 字元 | 6 | 庫存單位 | '個' |
| MAXX | 數值 | 6,0 | 建立日期 | 930615 |
| MAYY | 數值 | 6,0 | 建立時間 | 093045 |
| MAZZ | 字元 | 10 | 建立用戶 | 'A1045' |

## 6. 程式邏輯說明

### 6.1 新增工作訂單流程

1. 使用者按下F6功能鍵
2. 系統顯示SCR002畫面，所有欄位為空
3. 使用者輸入工作訂單資料
4. 系統驗證輸入資料：
   - 檢查必填欄位（訂單編號、訂單日期、客戶代碼）
   - 檢查日期格式
   - 檢查客戶代碼是否存在
   - 檢查產品代碼是否存在
5. 如果驗證通過，系統將資料寫入工作訂單主檔和明細檔
6. 系統返回主畫面，並更新子檔顯示

### 6.2 修改工作訂單流程

1. 使用者在子檔中選擇一筆記錄，輸入選項'2'
2. 系統讀取該工作訂單資料，顯示在SCR002畫面
3. 使用者修改工作訂單資料
4. 系統驗證修改後的資料
5. 如果驗證通過，系統更新工作訂單主檔和明細檔
6. 系統返回主畫面，並更新子檔顯示

### 6.3 刪除工作訂單流程

1. 使用者在子檔中選擇一筆記錄，輸入選項'3'
2. 系統顯示確認訊息
3. 如果使用者確認刪除，系統從工作訂單主檔和明細檔中刪除該記錄
4. 系統返回主畫面，並更新子檔顯示

### 6.4 查詢工作訂單流程

1. 使用者在子檔中選擇一筆記錄，輸入選項'5'
2. 系統讀取該工作訂單資料，顯示在SCR002畫面
3. 所有欄位為唯讀模式
4. 使用者按下F12返回主畫面

## 7. 錯誤處理

### 7.1 檔案錯誤處理

程式使用INFSR子程序處理檔案操作錯誤：

```RPG
C           ERRSR     BEGSR
C                     MOVE *ON       *INLR
C                     ENDSR
```

### 7.2 資料驗證錯誤

| 錯誤代碼 | 錯誤訊息 | 處理方式 |
|---------|---------|---------|
| ERR001 | 訂單編號不能為空 | 顯示錯誤訊息，游標定位到訂單編號欄位 |
| ERR002 | 訂單日期格式錯誤 | 顯示錯誤訊息，游標定位到訂單日期欄位 |
| ERR003 | 客戶代碼不存在 | 顯示錯誤訊息，游標定位到客戶代碼欄位 |
| ERR004 | 產品代碼不存在 | 顯示錯誤訊息，游標定位到產品代碼欄位 |
| ERR005 | 數量必須大於零 | 顯示錯誤訊息，游標定位到數量欄位 |
| ERR006 | 訂單編號已存在 | 顯示錯誤訊息，游標定位到訂單編號欄位 |

### 7.3 權限錯誤

如果使用者沒有相應的權限（新增、修改、刪除），系統會顯示錯誤訊息，並禁止相應操作。

## 8. 程式維護歷史

| 修改日期 | 修改者 | 修改內容 |
|---------|-------|---------|
| 約1993年 | 未知 | 程式初版建立 |
| 98/11/03 | MICHELLE | Y2K問題修正，日期格式調整 |

## 9. 系統整合

WOA001作為工作訂單管理系統的基礎程式，與以下系統模組有緊密的整合關係：

1. **工作訂單處理系統**（WOA1001-WOA1005）：處理工作訂單的各個階段
2. **工作訂單報表系統**（WOR100-WOR120）：生成工作訂單相關報表
3. **庫存管理系統**（IMM000C）：工作訂單會影響庫存水平
4. **客戶管理系統**：工作訂單涉及客戶資料
5. **產品管理系統**（MTM000C）：工作訂單涉及產品資料

## 10. 使用說明

### 10.1 進入程式

從工作訂單管理系統主選單選擇「工作訂單基本資料維護」選項進入本程式。

### 10.2 新增工作訂單

1. 在主畫面按下F6功能鍵
2. 在SCR002畫面輸入工作訂單資料
3. 按下Enter鍵保存資料

### 10.3 修改工作訂單

1. 在主畫面的子檔中，在要修改的工作訂單前輸入選項'2'
2. 在SCR002畫面修改工作訂單資料
3. 按下Enter鍵保存修改

### 10.4 刪除工作訂單

1. 在主畫面的子檔中，在要刪除的工作訂單前輸入選項'3'
2. 確認刪除操作

### 10.5 查詢工作訂單

1. 在主畫面的子檔中，在要查詢的工作訂單前輸入選項'5'
2. 查看工作訂單詳細資料
3. 按下F12返回主畫面

## 11. 效能考量

### 11.1 子檔處理

程式使用子檔技術顯示工作訂單列表，每頁顯示12筆記錄，支援翻頁功能。為了提高效能，程式採用以下策略：

1. 只讀取需要顯示的記錄
2. 使用邏輯檔案（WOWCLF）加速查詢
3. 使用鍵值存取方式提高檔案讀取效率

### 11.2 記憶體使用

程式使用多個工作變數和資料結構，但總體記憶體使用量較小，不會對系統造成明顯負擔。

## 12. 安全考量

### 12.1 權限控制

程式從LDA獲取使用者權限資訊（$ADD、$UPD、$DLT、$INQ），根據使用者的權限控制可執行的操作：

- 只有具有新增權限（$ADD='1'）的使用者才能新增工作訂單
- 只有具有修改權限（$UPD='1'）的使用者才能修改工作訂單
- 只有具有刪除權限（$DLT='1'）的使用者才能刪除工作訂單
- 所有使用者都可以查詢工作訂單（$INQ='1'）

### 12.2 資料完整性

程式實施嚴格的資料驗證，確保資料的完整性和一致性：

1. 檢查必填欄位
2. 驗證日期格式
3. 檢查參照完整性（客戶代碼、產品代碼）
4. 防止重複記錄

## 13. 未來擴展建議

### 13.1 功能擴展

1. **批次處理**：增加批次新增和修改工作訂單的功能
2. **搜尋功能**：增加按多種條件搜尋工作訂單的功能
3. **匯出功能**：增加將工作訂單資料匯出到其他格式的功能

### 13.2 技術改進

1. **使用者介面**：改善畫面布局和使用者體驗
2. **效能優化**：優化檔案存取和子檔處理邏輯
3. **錯誤處理**：增強錯誤處理和日誌記錄功能

## 14. 結論

WOA001是西祺企業經營管理資訊系統中工作訂單管理系統的核心程式之一，提供了完整的工作訂單基本資料維護功能。它採用子檔技術實現多筆資料的顯示和處理，支援工作訂單的新增、修改、刪除和查詢操作。

程式設計遵循AS/400系統的標準規範，具有良好的結構和可維護性。通過嚴格的資料驗證和權限控制，確保了系統的安全性和資料的完整性。

作為工作訂單管理系統的基礎，WOA001與其他系統模組緊密整合，為企業提供了高效的工作訂單管理解決方案，幫助企業提高生產效率和管理水平。 